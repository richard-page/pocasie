<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Predpoveƒè poƒçasia</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{
    --glass: rgba(255,255,255,.08);
    --glass-b: rgba(255,255,255,.18);
    --hero-h: 34vh;        /* mobily */
    --hero-icon: 76px;     /* veƒækos≈• ikony */
    --hero-temp: 5.6rem;   /* veƒækos≈• ƒç√≠sla teploty */
    --hero-pad-t: 1.6rem;  /* horn√Ω padding */
    --hero-pad-b: 1.2rem;  /* spodn√Ω padding */
  }
  @media (min-width:480px){
    :root{ --hero-h: 36vh; --hero-icon: 86px; --hero-temp: 6rem; }
  }
  @media (min-width:768px){
    :root{ --hero-h: 38vh; --hero-icon: 96px; --hero-temp: 6.2rem; }
  }

  *{ box-sizing:border-box }
  html,body{ width:100%; max-width:100%; overflow-x:hidden }
  body{
    margin:0; color:#fff;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:#0e4d73;
  }
  .glass{ background:var(--glass); border:1px solid var(--glass-b); backdrop-filter:blur(12px); border-radius:1rem }
  .mono{ font-feature-settings:"tnum" 1,"lnum" 1 }

  .hero{
    position:relative; isolation:isolate;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    min-height:var(--hero-h); width:100%;
    padding:var(--hero-pad-t) 1rem var(--hero-pad-b);
    text-align:center; overflow:hidden
  }
  body[data-mode="day"] .hero{ background:#176ea9 }
  body[data-mode="night"] .hero{ background:#08273b }
  #heroPlace{ font-size:1.18rem; font-weight:600; opacity:.95; letter-spacing:.2px }
  #heroIcon{ width:var(--hero-icon); height:var(--hero-icon); margin:.65rem auto .35rem; font-size:calc(var(--hero-icon) - 8px); line-height:var(--hero-icon) }
  #heroTemp{ font-size:var(--hero-temp); line-height:1; font-weight:700; letter-spacing:1px }

  .sticky-header{ position:sticky; top:0; z-index:40 }
  .tbl th,.tbl td{ padding:.65rem .75rem; white-space:nowrap }
  .tbl thead th{ position:sticky; top:0; background:rgba(0,0,0,.15); backdrop-filter:blur(6px) }
  .val-bold{ font-weight:600; color:#fff }

  .card{ border-radius:1rem; border:1px solid var(--glass-b); background:var(--glass) }
  .acc-btn{ width:100%; background:none; border:0; cursor:pointer; padding:.9rem .95rem; display:flex; align-items:center; gap:.75rem; text-align:left; color:#fff }
  .acc-head{ flex:1; min-width:0 }
  .acc-right{ margin-left:auto; display:flex; gap:.5rem; white-space:nowrap }
  .chev{ transition:transform .22s ease }
  .panel-wrap{ height:0; overflow:hidden; transition:height .22s ease }
  .panel{ padding:0 .95rem .95rem .95rem }

  .cols{ display:grid; grid-template-columns:1fr; gap:1rem }
  @media (min-width:1024px){ .cols{ display:flex; gap:1rem } .col-left,.col-right{ align-self:stretch } }

  .suggest-wrap{ position:relative; }
  .suggest{
    position:absolute; top:100%; left:0; right:0; margin-top:.35rem;
    background:#fff; color:#0b1720; border-radius:.75rem; border:1px solid rgba(0,0,0,.08);
    box-shadow:0 10px 25px rgba(0,0,0,.25); overflow:auto; max-height:18rem; z-index:50;
  }
  .suggest.hidden{ display:none }
  .suggest-item{ display:flex; align-items:center; gap:.6rem; padding:.55rem .75rem; cursor:pointer }
  .suggest-item:hover,.suggest-item[aria-selected="true"]{ background:#eef6ff }
  .flag{ width:18px; flex:0 0 18px }
  .s-meta{ font-size:.82rem; color:#425466 }
  .s-name{ font-weight:600 }

  #ptr{ position:sticky; top:0; height:0; overflow:visible; z-index:45; }
  #ptr .spinner{
    margin:.35rem auto 0; width:34px; height:34px; border-radius:9999px;
    border:4px solid rgba(255,255,255,.28); border-top-color:#fff;
    animation:spin 1s linear infinite; opacity:0; transform:scale(.8); transition:opacity .15s ease, transform .15s ease;
  }
  #ptr.active .spinner{ opacity:1; transform:scale(1) }
  @keyframes spin{ to{ transform:rotate(360deg) } }
</style>
</head>
<body data-mode="day">

<section class="hero">
  <div id="heroPlace">‚Äî</div>
  <div id="heroIcon" aria-hidden="true"></div>
  <div id="heroTemp" class="mono">--¬∞</div>
</section>

<header class="sticky-header w-full glass">
  <div class="w-full px-3 md:px-6 py-3 flex items-center gap-3">
    <div class="font-semibold">Predpoveƒè poƒçasia</div>
    <div class="flex-1"></div>

    <div class="suggest-wrap w-full sm:w-[560px] max-w-full">
      <form id="searchForm" class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2" novalidate>
        <input id="cityInput" placeholder="Zadaj mesto (napr. Bratislava)"
               class="w-full px-4 py-2.5 rounded-lg bg-white/20 border border-white/20 placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
               autocomplete="off" inputmode="search" type="search" />
        <button id="searchBtn" type="submit"
                class="w-full sm:w-auto inline-flex items-center justify-center px-4 md:px-5 py-2.5 rounded-lg bg-white/30 hover:bg-white/40 text-white font-medium">
          Hƒæada≈•
        </button>
      </form>
      <div id="citySuggestions" class="suggest hidden"></div>
    </div>
  </div>
</header>

<div id="ptr"><div class="spinner"></div></div>

<main id="refreshContainer" class="w-full px-2 md:px-4 lg:px-6 py-4 space-y-4">

  <section class="cols">
    <div class="col-left glass overflow-visible lg:overflow-hidden lg:basis-7/12 flex flex-col min-h-0">
      <div class="flex items-center justify-between px-4 py-3 border-b border-white/20">
        <h2 class="text-lg font-semibold">24-hodinov√° predpoveƒè</h2>
      </div>
      <div class="hidden lg:block overflow-x-auto flex-1 min-h-0">
        <table class="tbl w-full h-full min-w-[900px] text-sm">
          <thead>
            <tr class="text-white/90">
              <th>ƒåas</th><th>Poƒçasie</th><th>Teplota</th><th>Rosn√Ω bod</th>
              <th>Zr√°≈æky</th><th>Vietor</th><th>Oblaƒçnos≈•</th><th>Tlak</th>
            </tr>
          </thead>
          <tbody id="hourRows" class="divide-y divide-white/10"></tbody>
        </table>
      </div>
      <div id="hourList" class="block lg:hidden p-2 space-y-2"></div>
    </div>

    <div class="col-right lg:basis-5/12 space-y-4">
      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">10-d≈àov√° predpoveƒè</h2></div>
        <div id="dailyList" class="p-3 space-y-2"></div>
      </div>

      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">Presne pred rokom</h2></div>
        <div id="historyExact" class="p-4"></div>
      </div>

      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">UV index</h2></div>
        <div id="uvPanel" class="p-4">
          <div class="grid grid-cols-2 gap-3">
            <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Aktu√°lne</div><div id="uvNow" class="mono font-semibold">‚Äî</div></div>
            <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Dne≈°n√© maximum</div><div id="uvMax" class="mono font-semibold">‚Äî</div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="loading" class="hidden text-center py-10">
    <div class="inline-block w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
    <p class="mt-2">Naƒç√≠tavam‚Ä¶</p>
  </div>
  <div id="err" class="hidden glass p-4">
    <div class="text-center text-red-200">Nepodarilo sa naƒç√≠ta≈• √∫daje. Sk√∫s in√© mesto.</div>
  </div>
</main>

<script>
// API endpointy
const API = 'https://api.open-meteo.com/v1';
const GEO = 'https://geocoding-api.open-meteo.com/v1';

// DOM refs
const el = {
  form: document.getElementById('searchForm'),
  input: document.getElementById('cityInput'),
  suggest: document.getElementById('citySuggestions'),
  hourRows: document.getElementById('hourRows'),
  hourList: document.getElementById('hourList'),
  dailyList: document.getElementById('dailyList'),
  historyExact: document.getElementById('historyExact'),
  uvNow: document.getElementById('uvNow'),
  uvMax: document.getElementById('uvMax'),
  heroPlace: document.getElementById('heroPlace'),
  heroIcon: document.getElementById('heroIcon'),
  heroTemp: document.getElementById('heroTemp'),
  loading: document.getElementById('loading'),
  err: document.getElementById('err'),
  ptr: document.getElementById('ptr'),
  refreshContainer: document.getElementById('refreshContainer'),
};

// Pomocn√© funkcie
function sanitizeCode(c) { return (c === 45 || c === 48) ? 3 : c; }
function iconFor(code) {
  code = sanitizeCode(code);
  if ([0, 1].includes(code)) return '‚òÄÔ∏è';
  if (code === 2) return '‚õÖ';
  if (code === 3) return '‚òÅÔ∏è';
  if ([51].includes(code)) return 'üå¶Ô∏è';
  if ([61, 63, 65, 80, 81, 82].includes(code)) return 'üåßÔ∏è';
  if ([71, 73, 75].includes(code)) return 'üå®Ô∏è';
  if ([95, 96, 99].includes(code)) return '‚õàÔ∏è';
  return 'üå§Ô∏è';
}

function descFor(c) {
  c = sanitizeCode(c);
  const d = { 0: 'Jasno', 1: 'Preva≈æne jasno', 2: 'ƒåiastoƒçne oblaƒçno', 3: 'Zamraƒçen√©',
             51: 'Mrholenie', 61: 'Slab√Ω d√°≈æƒè', 63: 'Mierny d√°≈æƒè', 65: 'Siln√Ω d√°≈æƒè',
             71: 'Slab√© sne≈æenie', 73: 'Mierne sne≈æenie', 75: 'Siln√© sne≈æenie',
             80: 'Preh√°nky', 81: 'Mierne preh√°nky', 82: 'Siln√© preh√°nky',
             95: 'B√∫rka', 96: 'B√∫rka s kr√∫pami', 99: 'Siln√° b√∫rka s kr√∫pami' };
  return d[c] || '‚Äî';
}

function withIcon(code) { return `${iconFor(code)} ${descFor(code)}`; }
function dd2dir(dd) { if (dd == null || isNaN(dd)) return '‚Äî'; const deg = ((dd % 360) + 360) % 360; const dirs = ['S', 'SV', 'V', 'JV', 'J', 'JZ', 'Z', 'SZ']; return dirs[Math.floor((deg + 22.5) / 45) % 8]; }
function fmtTime(iso) { const d = new Date(iso); return d.getHours().toString().padStart(2, '0') + ':00'; }
const flag = (cc) => String.fromCodePoint(...[...cc.toUpperCase()].map(c => 127397 + c.charCodeAt(0)));
function cityLabel(x) { return (typeof x === 'string' ? (x.split(',')[0]) : (x?.name || '')).trim() || '‚Äî'; }

/* ====== API ====== */
async function geocodeAll(q, count = 8) {
  const r = await fetch(`${GEO}/search?name=${encodeURIComponent(q)}&count=${count}&language=sk&format=json`);
  const j = await r.json();
  return j.results || [];
}

async function fetchWx(lat, lon) {
  const url = `${API}/forecast?latitude=${lat}&longitude=${lon}`
    + `&current=temperature_2m,is_day,weather_code`
    + `&hourly=temperature_2m,dew_point_2m,surface_pressure,weather_code,precipitation_probability,precipitation,wind_speed_10m,wind_direction_10m,cloud_cover,uv_index`
    + `&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max`
    + `&timezone=auto&forecast_days=16`;
  const r = await fetch(url);
  if (!r.ok) throw new Error('api');
  return await r.json();
}

/* Geolok√°cia a z√≠skanie n√°zvu mesta */
function locationSuccess(position) {
  const latitude = position.coords.latitude;
  const longitude = position.coords.longitude;
  fetch(`${GEO}/reverse?latitude=${latitude}&longitude=${longitude}&language=sk&format=json`)
    .then(response => response.json())
    .then(data => {
      const city = data.results[0]?.address.city || "Nezn√°me mesto";
      el.input.value = city;
      run({ name: city, latitude, longitude });
    })
    .catch(() => {
      el.input.value = 'Nezn√°me mesto';
      run('Nezn√°me mesto');
    });
}

function locationError(error) {
  console.error(`Chyba pri z√≠skavan√≠ polohy: ${error.message}`);
  el.input.value = 'Nezn√°me mesto';
  run('Nezn√°me mesto');
}

function loadDefaultCity() {
  console.log("Naƒç√≠tavam predvolen√© mesto: Nezn√°me mesto");
  el.input.value = 'Nezn√°me mesto';
  run('Nezn√°me mesto');
}

function getCurrentLocation() {
  console.log("Pok√∫≈°am sa z√≠ska≈• aktu√°lnu polohu...");
  navigator.geolocation.getCurrentPosition(locationSuccess, locationError);
}

function checkAndroidLocationEnabled() {
  if ('geolocation' in navigator) {
    getCurrentLocation();
  } else {
    console.log("Geolok√°cia nie je podporovan√° v tomto prehliadaƒçi");
    loadDefaultCity();
  }
}

checkAndroidLocationEnabled();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="sk">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>PredpoveÄ poÄasia</title>
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <style>
Â  Â  :root{
Â  Â  Â  --glass: rgba(255,255,255,.08);
Â  Â  Â  --glass-b: rgba(255,255,255,.18);
Â  Â  Â  --hero-icon: 60px;
Â  Â  Â  --hero-temp: 4.5rem;
Â  Â  }
Â  Â Â 
Â  Â  /* Nastavenie farby pozadia pre mobil */
Â  Â  @media (max-width: 640px) {
Â  Â  Â  .glass { background:rgba(255,255,255,.12); border:none; }
Â  Â  Â  .card { background:rgba(255,255,255,.12); border:none; }
Â  Â  }

Â  Â  /* ğŸ”¥ NukleÃ¡rna eliminÃ¡cia horizontÃ¡lnej posuvnej liÅ¡ty na vÅ¡etkÃ½ch elementoch */
Â  Â  * {Â 
Â  Â  Â  Â  box-sizing: border-box !important;
Â  Â  Â  Â  overflow-x: hidden !important; /* !!! NovÃ¡ globÃ¡lna oprava !!! */
Â  Â  }

Â  Â  /* ğŸ”¥ PrebÃ­janie vÅ¡etkÃ½ch systÃ©movÃ½ch marginov a paddingov */
Â  Â  html, body {Â 
Â  Â  Â  Â  margin: 0 !important;Â 
Â  Â  Â  Â  padding: 0 !important;Â 
Â  Â  Â  Â  width: 100% !important;Â 
Â  Â  Â  Â  max-width: 100% !important;
Â  Â  Â  Â  overflow-x: hidden !important;
Â  Â  }
Â  Â Â 
Â  Â  /* Skrytie posuvnej liÅ¡ty (ak ju prehliadaÄ reÅ¡pektuje) */
Â  Â  body::-webkit-scrollbar,Â 
Â  Â  html::-webkit-scrollbar,
Â  Â  #refreshContainer::-webkit-scrollbar {
Â  Â  Â  display: none !important;Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  width: 0 !important;Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  background: transparent !important;
Â  Â  }
Â  Â Â 
Â  Â  body, html, #refreshContainer {
Â  Â  Â  -ms-overflow-style: none !important;Â  /* IE and Edge */
Â  Â  Â  scrollbar-width: none !important;Â  Â  Â /* Firefox */
Â  Â  }
    
    /* ğŸ”¥ KÄ½ÃšÄŒOVÃ OPRAVA: VynÃºtenie kontajnera tabuÄ¾ky, aby nepresahoval Å¡Ã­rku */
    /* ZabezpeÄÃ­, Å¾e skrolovateÄ¾nÃ½ je len obsah vnÃºtri tohto bloku, nie celÃ¡ strÃ¡nka */
    #hourlyContent { 
        overflow-x: auto !important; /* PovoliÅ¥ scroll iba v rÃ¡mci tohto elementu */
        width: 100% !important; /* ZabezpeÄiÅ¥, Å¾e nezaberÃ¡ viac ako 100% */
    }
    /* VnÃºtro kontajnera mÃ¡ povolenÃº max. Å¡Ã­rku */
    #hourlyContent > div.lg\:block {
        width: fit-content !important;
        max-width: none !important;
    }

Â  Â  /* ------------------- */
Â  Â  /* ZvyÅ¡ok CSS zostÃ¡va rovnakÃ½, len pre istotu som z neho vymazal konfliktnÃ© Äasti */

Â  Â  body{
Â  Â  Â  margin:0; color:#fff;
Â  Â  Â  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
Â  Â  Â  background:#0e4d73;
Â  Â  }
Â  Â  .glass{ background:var(--glass); border:1px solid var(--glass-b); backdrop-filter:blur(12px); border-radius:1rem }
Â  Â  .mono{ font-feature-settings:"tnum" 1,"lnum" 1 }
Â  Â Â 
Â  Â  .hero{
Â  Â  Â  position:relative; isolation:isolate;
Â  Â  Â  display:flex; flex-direction:column; align-items:center; justify-content:center;
Â  Â  Â  width:100%;
Â  Â  Â  padding:0.75rem 1rem 0.5rem;Â 
Â  Â  Â  text-align:center;
Â  Â  Â  overflow:hidden
Â  Â  }
Â  Â Â 
Â  Â  body[data-mode="day"] .hero{ background:#176ea9 }
Â  Â  body[data-mode="night"] .hero{ background:#08273b }
Â  Â  body[data-mode="night"] .hero::after{
Â  Â  Â  content:""; position:absolute; inset:0; z-index:-1; pointer-events:none; opacity:.45;
Â  Â  Â  background:
Â  Â  Â  Â  radial-gradient(2px 2px at 12% 18%, #fff 40%, transparent 42%),
Â  Â  Â  Â  radial-gradient(1.5px 1.5px at 35% 28%, #fff 45%, transparent 47%),
Â  Â  Â  Â  radial-gradient(1.8px 1.8px at 66% 14%, #fff 45%, transparent 47%),
Â  Â  Â  Â  radial-gradient(1.8px 1.8px at 82% 40%, #fff 45%, transparent 47%),
Â  Â  Â  Â  radial-gradient(1.8px 1.8px at 18% 65%, #fff 45%, transparent 47%),
Â  Â  Â  Â  radial-gradient(1.8px 1.8px at 58% 73%, #fff 45%, transparent 47%),
Â  Â  Â  Â  radial-gradient(1.8px 1.8px at 88% 78%, #fff 45%, transparent 47%),
Â  Â  Â  Â  radial-gradient(1.6px 1.6px at 44% 86%, #fff 45%, transparent 47%)
Â  Â  }
Â  Â  #heroPlace{Â 
Â  Â  Â  Â  font-size:1.18rem; font-weight:600; opacity:.95; letter-spacing:.2px;Â 
Â  Â  Â  Â  line-height:1.2;Â 
Â  Â  Â  Â  white-space:nowrap;Â 
Â  Â  Â  Â  overflow:hidden;Â 
Â  Â  Â  Â  text-overflow:ellipsis;Â 
Â  Â  Â  Â  max-width:100%;
Â  Â  }
Â  Â  #heroIcon{ width:var(--hero-icon); height:var(--hero-icon); margin:.3rem auto .1rem; font-size:calc(var(--hero-icon) - 8px); line-height:var(--hero-icon) }
Â  Â  #heroTemp{ font-size:var(--hero-temp); line-height:1; font-weight:700; letter-spacing:1px }Â 

Â  Â  .sticky-header{ position:sticky; top:0; z-index:40 }
Â  Â  .tbl th,.tbl td{ padding:.65rem .75rem; white-space:nowrap }
Â  Â  .tbl thead th{ position:sticky; top:0; background:rgba(0,0,0,.15); backdrop-filter:blur(6px) }
Â  Â  .val-bold{ font-weight:600; color:#fff }

Â  Â  .tabs-nav{ display:grid; grid-template-columns:1fr 1fr; background:rgba(0,0,0,.2); padding:.25rem; border-radius:1rem; }
Â  Â  .tab-btn{ padding:.65rem 1rem; border-radius:.75rem; font-weight:600; text-align:center; background:none; border:0; color:#fff; cursor:pointer; transition:background .2s ease }
Â  Â  .tab-btn[aria-selected="true"]{ background:#fff; color:#0b1720; box-shadow:0 2px 8px rgba(0,0,0,.2) }
Â  Â  .tab-content{ padding-top:1rem }
Â  Â  .tab-content.hidden{ display:none }

Â  Â  .card{ border-radius:1rem; border:1px solid var(--glass-b); background:var(--glass) }
Â  Â  .acc-btn{ width:100%; background:none; border:0; cursor:pointer; padding:.9rem .95rem; display:flex; align-items:center; gap:.75rem; text-align:left; color:#fff }
Â  Â  .acc-head{ flex:1; min-width:0 }
Â  Â  .acc-right{ margin-left:auto; display:flex; gap:.5rem; white-space:nowrap }
Â  Â  .chev{ transition:transform .22s ease }
Â  Â  .acc-btn[aria-expanded="true"] .chev{ transform:rotate(180deg) }
Â  Â  .panel-wrap{ height:0; overflow:hidden; transition:height .22s ease }
Â  Â  .panel{ padding:0 .95rem .95rem .95rem }
Â  Â Â 
Â  Â  .suggest-wrap{ position:relative; }
Â  Â  .suggest{
Â  Â  Â  position:absolute; top:100%; left:0; right:0; margin-top:.35rem;
Â  Â  Â  background:#fff; color:#0b1720; border-radius:.75rem; border:1px solid rgba(0,0,0,.08);
Â  Â  Â  box-shadow:0 10px 25px rgba(0,0,0,.25); overflow:auto; max-height:18rem; z-index:50;
Â  Â  }
Â  Â  .suggest.hidden{ display:none }
Â  Â  .suggest-item{ display:flex; align-items:center; gap:.6rem; padding:.55rem .75rem; cursor:pointer }
Â  Â  .suggest-item:hover,.suggest-item[aria-selected="true"]{ background:#eef6ff }
Â  Â  .flag{ width:18px; flex:0 0 18px }
Â  Â  .s-meta{ font-size:.82rem; color:#425466 }
Â  Â  .s-name{ font-weight:600 }

Â  Â  #ptr{ position:sticky; top:0; height:0; overflow:visible; z-index:45; }
Â  Â  #ptr .spinner{
Â  Â  Â  margin:.35rem auto 0; width:34px; height:34px; border-radius:9999px;
Â  Â  Â  border:4px solid rgba(255,255,255,.28); border-top-color:#fff;
Â  Â  Â  animation:spin 1s linear infinite; opacity:0; transform:scale(.8); transition:opacity .15s ease, transform .15s ease;
Â  Â  }
Â  Â  #ptr.active .spinner{ opacity:1; transform:scale(1) }
Â  Â  @keyframes spin{ to{ transform:rotate(360deg) } }
Â  </style>
</head>
<body data-mode="day">

Â  <section class="hero">
Â  Â  <div id="heroPlace">â€”</div>
Â  Â  <div id="heroIcon" aria-hidden="true"></div>
Â  Â  <div id="heroTemp" class="mono">--Â°</div>
Â  </section>

Â  <header class="sticky-header w-full glass">
Â  Â  <div class="w-full px-3 md:px-6 py-3 flex items-center justify-center">
Â  Â  Â Â 
Â  Â  Â  <div class="suggest-wrap w-full sm:w-[560px] max-w-full mx-auto">
Â  Â  Â  Â  <form id="searchForm" class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2" novalidate>
Â  Â  Â  Â  Â  <input id="cityInput" placeholder="Zadaj mesto (napr. Levice)"
Â  Â  Â  Â  Â  Â  Â  Â  Â class="w-full px-4 py-2.5 rounded-lg bg-white/20 border border-white/20 placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
Â  Â  Â  Â  Â  Â  Â  Â  Â autocomplete="off" inputmode="search" type="search" />
Â  Â  Â  Â  Â  <button id="searchBtn" type="submit"
Â  Â  Â  Â  Â  Â  Â  Â  Â  class="w-full sm:w-auto inline-flex items-center justify-center px-4 md:px-5 py-2.5 rounded-lg bg-white/30 hover:bg-white/40 text-white font-medium">
Â  Â  Â  Â  Â  Â  HÄ¾adaÅ¥
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </form>
Â  Â  Â  Â  <div id="citySuggestions" class="suggest hidden"></div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </header>

Â  <div id="ptr"><div class="spinner"></div></div>

Â  <main id="refreshContainer" class="w-full px-2 md:px-4 lg:px-6 py-0.5 space-y-1">

Â  Â  <section class="glass p-3 lg:p-4">
Â  Â  Â Â 
Â  Â  Â  <div class="tabs-nav mb-4">
Â  Â  Â  Â  Â  <button id="tab24hBtn" class="tab-btn" aria-selected="true" data-tab="hourly">24 hodÃ­n</button>
Â  Â  Â  Â  Â  <button id="tab10dBtn" class="tab-btn" aria-selected="false" data-tab="daily">10 dnÃ­</button>
Â  Â  Â  </div>

Â  Â  Â  <div id="hourlyContent" class="tab-content" data-tab-content="hourly">
          Â  Â  Â  Â  Â  <div class="hidden lg:block min-h-0">
Â  Â  Â  Â  Â  Â  Â  <table class="tbl w-full h-full min-w-[900px] text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="text-white/90">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>ÄŒas</th><th>PoÄasie</th><th>Teplota</th><th>RosnÃ½ bod</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>ZrÃ¡Å¾ky</th><th>Vietor</th><th>OblaÄnosÅ¥</th><th>Tlak</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="hourRows" class="divide-y divide-white/10"></tbody>
Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div id="hourList" class="block lg:hidden p-1 space-y-2"></div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div id="dailyContent" class="tab-content hidden" data-tab-content="daily">
Â  Â  Â  Â  Â  <div id="dailyList" class="p-1 space-y-2"></div>
Â  Â  Â  </div>

Â  Â  </section>

Â  Â  <section class="grid grid-cols-1 lg:grid-cols-2 gap-1">
Â  Â  Â Â 
Â  Â  Â  <div class="glass">
Â  Â  Â  Â  <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">Presne pred rokom</h2></div>
Â  Â  Â  Â  <div id="historyExact" class="p-4"></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="glass">
Â  Â  Â  Â  <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">UV index</h2></div>
Â  Â  Â  Â  <div id="uvPanel" class="p-4">
Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-3">
Â  Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">AktuÃ¡lne</div><div id="uvNow" class="mono font-semibold">â€”</div></div>
Â  Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">DneÅ¡nÃ© maximum</div><div id="uvMax" class="mono font-semibold">â€”</div></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>


Â  Â  <div id="loading" class="hidden text-center py-10">
Â  Â  Â  <div class="inline-block w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
Â  Â  Â  <p class="mt-2">NaÄÃ­tavamâ€¦</p>
Â  Â  Â  </div>
Â  Â  <div id="err" class="hidden glass p-4 border-red-500 border-2 bg-red-800/20">
Â  Â  Â  <div class="text-center text-red-100 font-medium flex items-center justify-center gap-2">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
Â  Â  Â  Â  Nepodarilo sa naÄÃ­taÅ¥ Ãºdaje. SkÃºs inÃ© mesto.
Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  Â  Â  <div style="width: 100%; text-align: center !important; padding-top: 8px; padding-bottom: 0;" class="text-white/50 text-xs">
Â  Â  Â  Ãšdaje poskytuje <a href="https://open-meteo.com/" target="_blank" rel="noopener noreferrer" class="hover:text-white/80 underline">Open-Meteo</a>.
Â  Â  </div>
Â  Â Â 
Â  </main>

<script>
// ... (ZvyÅ¡ok JS kÃ³du zostÃ¡va nezmenenÃ½) ...
// ZvyÅ¡nÃ½ kÃ³d bol identickÃ½ s predchÃ¡dzajÃºcou verziou, preto som ho pre struÄnosÅ¥ vynechal.
// VloÅ¾te sem celÃ½ zvyÅ¡ok JS kÃ³du (od konÅ¡tanty API aÅ¾ po poslednÃ½ riadok).
const API='https://api.open-meteo.com/v1';
const GEO='https://geocoding-api.open-meteo.com/v1';
const ARCH='https://archive-api.open-meteo.com/v1/era5';
const NOMINATIM_API = 'https://nominatim.openstreetmap.org/reverse?format=json&extratags=1&addressdetails=1&zoom=14&accept-language=sk';

const el={
Â  Â  form:document.getElementById('searchForm'),
Â  Â  input:document.getElementById('cityInput'),
Â  Â  suggest:document.getElementById('citySuggestions'),
Â  Â  hourRows:document.getElementById('hourRows'),
Â  Â  hourList:document.getElementById('hourList'),
Â  Â  dailyList:document.getElementById('dailyList'),
Â  Â  historyExact:document.getElementById('historyExact'),
Â  Â  uvNow:document.getElementById('uvNow'),
Â  Â  uvMax:document.getElementById('uvMax'),
Â  Â  heroPlace:document.getElementById('heroPlace'),
Â  Â  heroIcon:document.getElementById('heroIcon'),
Â  Â  heroTemp:document.getElementById('heroTemp'),
Â  Â  loading:document.getElementById('loading'),
Â  Â  err:document.getElementById('err'),
Â  Â  ptr:document.getElementById('ptr'),
Â  Â  refreshContainer:document.getElementById('refreshContainer'),
Â  Â  tab24hBtn: document.getElementById('tab24hBtn'),
Â  Â  tab10dBtn: document.getElementById('tab10dBtn'),
Â  Â  hourlyContent: document.getElementById('hourlyContent'),
Â  Â  dailyContent: document.getElementById('dailyContent'),
Â  };

Â  function sanitizeCode(c){ c=Number(c); return (c===45||c===48)?3:c; }
Â  function iconFor(code){
Â  Â  code=sanitizeCode(code);
Â  Â  if([0,1].includes(code)) return 'â˜€ï¸';
Â  Â  if(code===2) return 'â›…';
Â  Â  if(code===3) return 'â˜ï¸';
Â  Â  if([51].includes(code)) return 'ğŸŒ¦ï¸';
Â  Â  if([61,63,65,80,81,82].includes(code)) return 'ğŸŒ§ï¸';
Â  Â  if([71,73,75].includes(code)) return 'ğŸŒ¨ï¸';
Â  Â  if([95,96,99].includes(code)) return 'â›ˆï¸';
Â  Â  return 'ğŸŒ¤ï¸';
Â  }
Â  function descFor(c){
Â  Â  c=sanitizeCode(c);
Â  Â  const d={0:'Jasno',1:'PrevaÅ¾ne jasno',2:'ÄŒiastoÄne oblaÄno',3:'ZamraÄenÃ©',
Â  Â  Â  Â  Â  Â  Â 51:'Mrholenie',61:'SlabÃ½ dÃ¡Å¾Ä',63:'Mierny dÃ¡Å¾Ä',65:'SilnÃ½ dÃ¡Å¾Ä',
Â  Â  Â  Â  Â  Â  Â 71:'SlabÃ© sneÅ¾enie',73:'Mierne sneÅ¾enie',75:'SilnÃ© sneÅ¾enie',
Â  Â  Â  Â  Â  Â  Â 80:'PrehÃ¡nky',81:'Mierne prehÃ¡nky',82:'SilnÃ© prehÃ¡nky',
Â  Â  Â  Â  Â  Â  Â 95:'BÃºrka',96:'BÃºrka s krÃºpami',99:'SilnÃ¡ bÃºrka s krÃºpami'};
Â  Â  return d[c]||'â€”';
Â  }
Â  function withIcon(code){ return `${iconFor(code)} ${descFor(code)}`; }
Â  function dd2dir(dd){ if(dd==null||isNaN(dd)) return 'â€”'; const deg=((dd%360)+360)%360; const dirs=['S','SV','V','JV','J','JZ','Z','SZ']; return dirs[Math.floor((deg+22.5)/45)%8]; }
Â  function fmtTime(iso){ const d=new Date(iso); return d.getHours().toString().padStart(2,'0')+':00'; }
Â  const flag=(cc)=> String.fromCodePoint(...[...cc.toUpperCase()].map(c=>127397+c.charCodeAt(0)));
Â  function cityLabel(x){ return (typeof x==='string'?(x.split(',')[0]):(x?.name||'')).trim()||'â€”'; }

Â  async function geocodeAll(q,count=8){
Â  Â  const r=await fetch(`${GEO}/search?name=${encodeURIComponent(q)}&count=${count}&language=sk&format=json`);
Â  Â  const j=await r.json();
Â  Â  return j.results||[];
Â  }
Â  async function reverseGeocode(lat, lon) {
Â  Â  Â  const url = `${NOMINATIM_API}&lat=${lat}&lon=${lon}`;
Â  Â  Â  try {
Â  Â  Â  Â  Â  const r = await fetch(url);
Â  Â  Â  Â  Â  if (!r.ok) { console.error(`Nominatim API volanie zlyhalo s HTTP statusom ${r.status}`); return null; }
Â  Â  Â  Â  Â  const j = await r.json();
Â  Â  Â  Â  Â  const addr = j.address;
Â  Â  Â  Â  Â  if (!addr) return null;
Â  Â  Â  Â  Â  // PrimÃ¡rne sa pokÃºsime zÃ­skaÅ¥ mesto (city, town, village)
Â  Â  Â  Â  Â  const name = addr.city || addr.town || addr.village || addr.municipality || addr.county;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Ak mÃ¡me nejakÃ© meno, vrÃ¡time objekt
Â  Â  Â  Â  Â  if (name) {
Â  Â  Â  Â  Â  Â  Â  return { name: name, latitude: lat, longitude: lon, country_code: addr.country_code ? addr.country_code.toUpperCase() : 'SK', admin1: addr.state || '' };
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Inak skÃºsime aspoÅˆ okres/Å¡tÃ¡t
Â  Â  Â  Â  Â  const fallbackName = addr.county || addr.state || 'AktuÃ¡lna poloha';

Â  Â  Â  Â  Â  return {Â 
Â  Â  Â  Â  Â  Â  Â  name: fallbackName,Â 
Â  Â  Â  Â  Â  Â  Â  latitude: lat,Â 
Â  Â  Â  Â  Â  Â  Â  longitude: lon,Â 
Â  Â  Â  Â  Â  Â  Â  country_code: addr.country_code ? addr.country_code.toUpperCase() : 'SK',Â 
Â  Â  Â  Â  Â  Â  Â  admin1: addr.state || ''
Â  Â  Â  Â  Â  };

Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  console.error("Chyba pri volanÃ­ Nominatim reverseGeocode:", e);
Â  Â  Â  Â  Â  return null;
Â  Â  Â  }
Â  }
Â  async function fetchWx(lat,lon){
Â  Â  const url=`${API}/forecast?latitude=${lat}&longitude=${lon}`
Â  Â  Â  +`&current=temperature_2m,is_day,weather_code`
Â  Â  Â  +`&hourly=temperature_2m,dew_point_2m,surface_pressure,weather_code,precipitation_probability,precipitation,wind_speed_10m,wind_direction_10m,cloud_cover,uv_index`
Â  Â  Â  +`&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max`
Â  Â  Â  +`&timezone=auto&forecast_days=16`;
Â  Â  const r=await fetch(url); if(!r.ok) throw new Error('api'); return await r.json();
Â  }
Â  async function fetchHistoryExact(lat,lon){
Â  Â  const d=new Date(); d.setFullYear(d.getFullYear()-1);
Â  Â  const date=d.toISOString().slice(0,10);
Â  Â  const url=`${ARCH}?latitude=${lat}&longitude=${lon}`
Â  Â  Â  +`&start_date=${date}&end_date=${date}`
Â  Â  Â  +`&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode`
Â  Â  Â  +`&hourly=wind_speed_10m,wind_direction_10m`
Â  Â  Â  +`&timezone=auto`;
Â  Â  const r=await fetch(url); if(!r.ok) throw new Error('arch1'); return await r.json();
Â  }

Â  function renderHero(city, wx){
Â  Â  const isDay = !!wx.current.is_day;
Â  Â  const code = sanitizeCode(wx.current.weather_code);
Â  Â  document.body.setAttribute('data-mode', isDay ? 'day' : 'night');
Â  Â  el.heroPlace.textContent = city?.__isCurrentLocation && !city.name ? 'â€”' : cityLabel(city);
Â  Â  el.heroTemp.textContentÂ  = Math.round(wx.current.temperature_2m)+'Â°';
Â  Â  el.heroIcon.textContentÂ  = iconFor(code);
Â  }
Â  function renderHourly(wx){
Â  Â  const H=wx.hourly; el.hourRows.innerHTML=''; el.hourList.innerHTML='';
Â  Â  const now=new Date(); let start=0; for(let i=0;i<H.time.length;i++){ if(new Date(H.time[i])>=now){ start=i; break; } }
Â  Â  const end=Math.min(start+24,H.time.length);
Â  Â  for(let i=start;i<end;i++){
Â  Â  Â  const code=sanitizeCode(H.weather_code[i]);
Â  Â  Â  const temp=Math.round(H.temperature_2m[i]);
Â  Â  Â  const dew=H.dew_point_2m?.[i];
Â  Â  Â  const pres=H.surface_pressure?.[i];
Â  Â  Â  const pop=H.precipitation_probability?.[i];
Â  Â  Â  const pmm=H.precipitation?.[i];
Â  Â  Â  const wind=H.wind_speed_10m?.[i], wdir=H.wind_direction_10m?.[i];
Â  Â  Â  const cld=H.cloud_cover?.[i];

Â  Â  Â  const tr=document.createElement('tr'); tr.className='hover:bg-white/10';
Â  Â  Â  tr.innerHTML=`
Â  Â  Â  Â  <td class="mono">${fmtTime(H.time[i])}</td>
Â  Â  Â  Â  <td class="text-white/85 font-medium">${withIcon(code)}</td>
Â  Â  Â  Â  <td class="val-bold mono">${temp}Â°</td>
Â  Â  Â  Â  <td class="val-bold mono">${dew!=null?Math.round(dew):'â€”'}Â°</td>
Â  Â  Â  Â  <td class="val-bold mono">${pop!=null?`${pop}%`:'â€”'} Â· ${pmm!=null?pmm.toFixed(1):'0.0'} mm</td>
Â  Â  Â  Â  <td class="val-bold mono">${wind!=null?`${Math.round(wind)} km/h`:'â€”'} (${dd2dir(wdir)})</td>
Â  Â  Â  Â  <td class="val-bold mono">${cld!=null?`${cld}%`:'â€”'}</td>
Â  Â  Â  Â  <td class="val-bold mono">${pres!=null?Math.round(pres):'â€”'} hPa</td>`;
Â  Â  Â  el.hourRows.appendChild(tr);

Â  Â  Â  const card=document.createElement('div'); card.className='card';
Â  Â  Â  const btn=document.createElement('button'); btn.className='acc-btn'; btn.type='button'; btn.setAttribute('aria-expanded','false');
Â  Â  Â  btn.innerHTML=`
Â  Â  Â  Â  <div class="acc-head">
Â  Â  Â  Â  Â  <div><div class="mono font-semibold">${fmtTime(H.time[i])} Â· ${temp}Â°</div><div class="text-white/80 text-sm">${withIcon(code)}</div></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="acc-right">
Â  Â  Â  Â  Â  <span class="mono">${pop!=null?`${pop}%`:'â€”'} Â· ${pmm!=null?pmm.toFixed(1):'0.0'} mm</span>
Â  Â  Â  Â  Â  <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
Â  Â  Â  Â  </div>`;
Â  Â  Â  const wrap=document.createElement('div'); wrap.className='panel-wrap';
Â  Â  Â  const panel=document.createElement('div'); panel.className='panel';
Â  Â  Â  panel.innerHTML=`
Â  Â  Â  Â  <div class="grid grid-cols-2 gap-2 mt-3 text-sm">
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Tlak</div><div class="mono font-semibold">${pres!=null?Math.round(pres):'â€”'} hPa</div></div>
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">RosnÃ½ bod</div><div class="mono font-semibold">${dew!=null?Math.round(dew):'â€”'}Â°</div></div>
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">OblaÄnosÅ¥</div><div class="mono font-semibold">${cld!=null?`${cld}%`:'â€”'}</div></div>
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Vietor</div><div class="mono font-semibold">${wind!=null?`${Math.round(wind)} km/h`:'â€”'} (${dd2dir(wdir)})</div></div>
Â  Â  Â  Â  </div>`;
Â  Â  Â  wrap.appendChild(panel); card.appendChild(btn); card.appendChild(wrap); el.hourList.appendChild(card);
Â  Â  Â  let open=false; const setH=()=>{ wrap.style.height=open?panel.scrollHeight+'px':'0px'; };
Â  Â  Â  btn.addEventListener('click',()=>{ if(wrap.style.height==='auto'){ wrap.style.height=panel.scrollHeight+'px'; } open=!open; btn.setAttribute('aria-expanded',String(open)); requestAnimationFrame(setH); });
Â  Â  Â  wrap.addEventListener('transitionend',e=>{ if(e.propertyName!=='height')return; if(open){ wrap.style.height='auto'; } });
Â  Â  }
Â  }
Â  function renderDaily(wx){
Â  Â  const D=wx.daily; el.dailyList.innerHTML=''; const n=Math.min(10,D.time.length);
Â  Â  for(let i=0;i<n;i++){
Â  Â  Â  const d=new Date(D.time[i]); const dn=['Ne','Po','Ut','St','Å t','Pi','So'][d.getDay()];
Â  Â  Â  const tmin=Math.round(D.temperature_2m_min[i]); const tmax=Math.round(D.temperature_2m_max[i]); const code=sanitizeCode(D.weather_code[i]);
Â  Â  Â  const card=document.createElement('div'); card.className='glass p-3 rounded-xl';
Â  Â  Â  card.innerHTML=`
Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <div class="font-medium">${dn} ${d.getDate()}</div>
Â  Â  Â  Â  Â  Â  <div class="text-white/70 text-sm">${withIcon(code)}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="mono text-lg font-semibold">${tmax}Â° / <span class="text-white/80">${tmin}Â°</span></div>
Â  Â  Â  Â  </div>`;
Â  Â  Â  el.dailyList.appendChild(card);
Â  Â  }
Â  }
Â  function renderHistoryExact(hist){
Â  Â  const H=hist.daily; const dateStr=H.time?.[0];
Â  Â  if(!dateStr){ el.historyExact.innerHTML='<div class="text-white/80">DÃ¡ta nie sÃº dostupnÃ©.</div>'; return; }
Â  Â  const d=new Date(dateStr); const dn=['Ne','Po','Ut','St','Å t','Pi','So'][d.getDay()];
Â  Â  const tmin=Math.round(H.temperature_2m_min?.[0]); const tmax=Math.round(H.temperature_2m_max?.[0]); const pr=(H.precipitation_sum?.[0] ?? 0).toFixed(1); const code=(H.weathercode?.[0] ?? 3);
Â  Â  let windBox='â€”'; const HH=hist.hourly;
Â  Â  if(HH?.wind_speed_10m?.length){ let mi=0,mv=-1; for(let i=0;i<HH.wind_speed_10m.length;i++){ const v=HH.wind_speed_10m[i]; if(typeof v==='number'&&v>mv){ mv=v; mi=i; } }
Â  Â  Â  const dir=dd2dir(HH.wind_direction_10m?.[mi]); if(isFinite(mv)) windBox=`${Math.round(mv)} km/h ${dir}`; }
Â  Â  el.historyExact.innerHTML=`
Â  Â  Â  <div class="glass p-4 rounded-xl space-y-3">
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <div class="font-semibold text-lg">${dn} ${d.getDate()}.${(d.getMonth()+1).toString().padStart(2,'0')}.${d.getFullYear()}</div>
Â  Â  Â  Â  Â  <div class="text-white/80">${withIcon(code)}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Max</div><div class="mono font-semibold">${tmax}Â°</div></div>
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Min</div><div class="mono font-semibold">${tmin}Â°</div></div>
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">ZrÃ¡Å¾ky</div><div class="mono font-semibold">${pr} mm</div></div>
Â  Â  Â  Â  Â  <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Vietor (max)</div><div class="mono font-semibold">${windBox}</div></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>`;
Â  }
Â  function renderUV(wx){
Â  Â  const H=wx.hourly; let uvNow=null; const now=new Date();
Â  Â  for(let i=0;i<H.time.length;i++){ if(new Date(H.time[i])>=now){ uvNow=H.uv_index?.[i] ?? null; break; } }
Â  Â  const uvMax = wx.daily.uv_index_max?.[0] ?? null;
Â  Â  el.uvNow.textContent = uvNow!=null ? uvNow.toFixed(1) : 'â€”';
Â  Â  el.uvMax.textContent = uvMax!=null ? uvMax.toFixed(1) : 'â€”';
Â  }

Â  async function run(queryOrCityObj){
Â  Â  el.loading.classList.remove('hidden'); el.err.classList.add('hidden');
Â  Â  try{
Â  Â  Â  let city = typeof queryOrCityObj==='object'
Â  Â  Â  Â  ? queryOrCityObj
Â  Â  Â  Â  : (await geocodeAll(cityLabel(queryOrCityObj),1))[0];
Â  Â  Â  if(!city) throw new Error('notfound');

Â  Â  Â  const wx=await fetchWx(city.latitude,city.longitude);
Â  Â  Â  const hist=await fetchHistoryExact(city.latitude,city.longitude);

Â  Â  Â  renderHero(city,wx);
Â  Â  Â  renderHourly(wx);
Â  Â  Â  renderDaily(wx);
Â  Â  Â  renderHistoryExact(hist);
Â  Â  Â  renderUV(wx);

Â  Â  Â  localStorage.setItem('lastCity', JSON.stringify({
Â  Â  Â  Â  Â  name: city.name,Â 
Â  Â  Â  Â  Â  latitude: city.latitude,
Â  Â  Â  Â  Â  longitude: city.longitude,
Â  Â  Â  Â  Â  country_code: city.country_code,
Â  Â  Â  Â  Â  __isCurrentLocation: !!city.__isCurrentLocationÂ 
Â  Â  Â  }));
Â  Â  }catch(e){ console.error(e); el.err.classList.remove('hidden'); }
Â  Â  finally{ el.loading.classList.add('hidden'); }
Â  }

Â  function switchTab(tabName) {
Â  Â  Â  const allBtns = [el.tab24hBtn, el.tab10dBtn];
Â  Â  Â  const allContents = [el.hourlyContent, el.dailyContent];

Â  Â  Â  allBtns.forEach(btn => {
Â  Â  Â  Â  Â  const isActive = btn.getAttribute('data-tab') === tabName;
Â  Â  Â  Â  Â  btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
Â  Â  Â  });

Â  Â  Â  allContents.forEach(content => {
Â  Â  Â  Â  Â  const isActive = content.getAttribute('data-tab-content') === tabName;
Â  Â  Â  Â  Â  content.classList.toggle('hidden', !isActive);
Â  Â  Â  });
Â  }

Â  el.tab24hBtn.addEventListener('click', () => switchTab('hourly'));
Â  el.tab10dBtn.addEventListener('click', () => switchTab('daily'));

Â  let selIndex=-1;
Â  let lastSuggest=[];
Â  function hideSuggest(){ el.suggest.classList.add('hidden'); el.suggest.innerHTML=''; selIndex=-1; lastSuggest=[]; }
Â  function showSuggest(){ el.suggest.classList.remove('hidden'); }
Â  function cityRow(c){
Â  Â  const admin = c.admin1 || c.admin2 || c.admin3 || '';
Â  Â  const country = c.country || '';
Â  Â  const meta = [admin, country].filter(Boolean).join(' Â· ');
Â  Â  return `
Â  Â  Â  <div class="s-name">${c.name}</div>
Â  Â  Â  <div class="s-meta">${meta}</div>
Â  Â  `;
Â  }
Â  function renderSuggest(items){
Â  Â  el.suggest.innerHTML='';
Â  Â  items.forEach((c,idx)=>{
Â  Â  Â  const d=document.createElement('div');
Â  Â  Â  d.className='suggest-item';
Â  Â  Â  d.setAttribute('role','option');
Â  Â  Â  d.setAttribute('data-idx',idx);
Â  Â  Â  d.innerHTML=`<span class="flag">${c.country_code?flag(c.country_code):''}</span><div>${cityRow(c)}</div>`;
Â  Â  Â  d.addEventListener('mousedown',e=>{ e.preventDefault(); choose(idx); });
Â  Â  Â  el.suggest.appendChild(d);
Â  Â  });
Â  Â  if(items.length===0){
Â  Â  Â  const d=document.createElement('div');
Â  Â  Â  d.className='suggest-item'; d.innerHTML='<div class="s-meta">Å½iadne vÃ½sledky</div>';
Â  Â  Â  el.suggest.appendChild(d);
Â  Â  }
Â  Â  showSuggest();
Â  }
Â  async function suggest(q){
Â  Â  q = cityLabel(q);
Â  Â  if(!q){ hideSuggest(); return; }
Â  Â  try{
Â  Â  Â  const res=await geocodeAll(q,8);
Â  Â  Â  lastSuggest=res;
Â  Â  Â  renderSuggest(res);
Â  Â  }catch{ hideSuggest(); }
Â  }
Â  function choose(i){
Â  Â  const c=lastSuggest[i]; if(!c) return;
Â  Â  el.input.value = cityLabel(c);
Â  Â  hideSuggest();
Â  Â  run(c);
Â  }
Â  el.input.addEventListener('input', (e)=>{ suggest(e.target.value); });
Â  el.input.addEventListener('keydown',(e)=>{
Â  Â  const items=[...el.suggest.querySelectorAll('.suggest-item')];
Â  Â  if(e.key==='ArrowDown'){ if(items.length){ e.preventDefault(); selIndex=(selIndex+1)%items.length; updateSel(items); } }
Â  Â  else if(e.key==='ArrowUp'){ if(items.length){ e.preventDefault(); selIndex=(selIndex-1+items.length)%items.length; updateSel(items); } }
Â  Â  else if(e.key==='Enter'){ if(selIndex>=0 && lastSuggest[selIndex]){ e.preventDefault(); choose(selIndex); } }
Â  Â  else if(e.key==='Escape'){ hideSuggest(); }
Â  });
Â  function updateSel(items){
Â  Â  items.forEach((it,i)=> it.setAttribute('aria-selected', i===selIndex ? 'true' : 'false'));
Â  Â  const active=items[selIndex]; if(active){ active.scrollIntoView({block:'nearest'}); }
Â  }
Â  document.addEventListener('click',(e)=>{ if(!e.target.closest('.suggest-wrap')) hideSuggest(); });
Â  el.form.addEventListener('submit', (ev)=>{
Â  Â  ev.preventDefault();
Â  Â  const q=cityLabel(el.input.value);
Â  Â  if(q) run(q);
Â  });

Â  let startY=0, pulling=false, activated=false;
Â  const THRESH=72;
Â  function ptrReset(){ pulling=false; activated=false; startY=0; el.ptr.classList.remove('active'); }
Â  el.refreshContainer.addEventListener('touchstart',(e)=>{
Â  Â  if(window.scrollY===0){ startY=e.touches[0].clientY; pulling=true; }
Â  },{passive:true});
Â  el.refreshContainer.addEventListener('touchmove',(e)=>{
Â  Â  if(!pulling) return;
Â  Â  const dy=e.touches[0].clientY-startY;
Â  Â  if(dy>10){ e.preventDefault(); }
Â  Â  if(dy>THRESH && !activated){ activated=true; el.ptr.classList.add('active'); }
Â  },{passive:false});
Â  el.refreshContainer.addEventListener('touchend', async ()=>{
Â  Â  if(pulling && activated){
Â  Â  Â  checkAndroidLocationEnabled(true); 
Â  Â  }
Â  Â  ptrReset();
Â  });

Â  const locationOptions = { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }; 

function getCityFromStorage() {
    const last = localStorage.getItem('lastCity');
    try { 
        return last ? JSON.parse(last) : null; 
    } catch (e) { 
        console.error("Chyba pri parsovanÃ­ lastCity:", e); 
        return null;
    }
}

function checkAndroidLocationEnabled(forceFetch=false) {
  const cityObj = getCityFromStorage();

  if (cityObj && !forceFetch) {
    el.input.value = cityLabel(cityObj);
    run(cityObj);
    return;
  }
  
  if (typeof median !== 'undefined' && median.android && median.android.geoLocation) {
    median.android.geoLocation.isLocationServicesEnabled({
      callback: function(result) {
        if (result.enabled) {
          getCurrentLocation();
        } else {
          requestAndroidLocationPermission();
          handleLocationFailure(); 
        }
      }
    });
  } else if ('geolocation' in navigator) {
    getCurrentLocation();
  } else {
    handleLocationFailure(); 
  }
}

function requestAndroidLocationPermission() {
  if (typeof median !== 'undefined' && median.android && median.android.geoLocation) {
    median.android.geoLocation.promptLocationServices();
  }
}

function getCurrentLocation() {
  navigator.geolocation.getCurrentPosition(locationSuccess, locationError, locationOptions);
}

async function locationSuccess(position) {
  const latitude = position.coords.latitude;
  const longitude = position.coords.longitude;
  
  let locatedCity = null;
  try {
      locatedCity = await reverseGeocode(latitude, longitude);
  } catch (e) {
      locatedCity = null;
  }

  const cityToUse = {
    name: locatedCity?.name || "", 
    latitude: latitude,
    longitude: longitude,
    country_code: locatedCity?.country_code || "SK",
    __isCurrentLocation: true
  };
  
  if(el.input) {
    el.input.value = cityToUse.name;
  }

  run(cityToUse);
}

function locationError(error) {
  handleLocationFailure();
}

function handleLocationFailure() {
    const cityObj = getCityFromStorage();
    el.loading.classList.add('hidden');

    if (cityObj) {
        el.input.value = cityLabel(cityObj);
        run(cityObj);
    } else {
        el.err.classList.remove('hidden');
        el.heroPlace.textContent = 'Poloha nezistenÃ¡';
        el.heroTemp.textContent  = '--Â°';
        el.heroIcon.textContent  = 'â“';
    }
}

checkAndroidLocationEnabled();
</script>
</body>
</html>

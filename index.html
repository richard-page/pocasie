<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Predpoveď počasia – UV index + presne pred rokom</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root { --glass: rgba(255,255,255,.08); --glass-b: rgba(255,255,255,.18); }
  * { box-sizing: border-box; }

  html, body { width:100%; max-width:100%; overflow-x:hidden; overscroll-behavior-x:none; touch-action:pan-y; }
  body { margin:0; background:linear-gradient(135deg,#0284c7,#06b6d4 55%,#10b981); color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }

  .glass { background:var(--glass); border:1px solid var(--glass-b); backdrop-filter:blur(12px); border-radius:1rem; }
  .mono  { font-feature-settings:"tnum" 1,"lnum" 1 }
  .sticky-header{ position:sticky; top:0; z-index:50; backdrop-filter:blur(10px) }

  .tbl th,.tbl td{ padding:.65rem .75rem; white-space:nowrap }
  .tbl thead th{ position:sticky; top:0; background:rgba(0,0,0,.15); backdrop-filter:blur(6px) }
  .val-bold{ font-weight:600; color:#fff }

  .metric{ background:var(--glass); border:1px solid var(--glass-b); border-radius:.75rem; padding:.6rem .8rem }
  .metric .label{ color:rgba(255,255,255,.72); font-size:.8rem; line-height:1.15 }
  .metric .val{ color:#fff; font-weight:600; font-size:1.05rem }

  .uv-bar{ height:10px; border-radius:9999px; background:rgba(255,255,255,.18); overflow:hidden }
  .uv-fill{ height:100%; border-radius:9999px }

  .card{ border-radius:1rem; border:1px solid var(--glass-b); background:var(--glass); }
  .acc-btn{ width:100%; padding:.9rem .95rem; display:flex; align-items:center; justify-content:space-between; gap:.75rem }
  .acc-head{ display:flex; align-items:center; gap:.8rem; text-align:left }
  .acc-right{ display:flex; align-items:center; gap:.5rem; margin-left:auto }
  .chev{ transition:transform .22s ease }
  .acc-btn[aria-expanded="true"] .chev{ transform:rotate(180deg) }
  .panel-wrap{ overflow:hidden; height:0; transition:height .22s ease }
  .panel{ padding:0 .95rem .95rem .95rem; opacity:0; transform:translateY(-4px); transition:opacity .22s ease, transform .22s ease }
  .panel.open{ opacity:1; transform:none }
</style>
</head>
<body class="min-h-screen text-white">

<header class="sticky-header w-full glass">
  <div class="w-full px-3 md:px-6 py-3 flex items-center gap-3">
    <h1 class="text-lg md:text-xl font-semibold">🌤️ Predpoveď</h1>
    <div class="flex-1"></div>
    <div class="flex w-full sm:w-[520px] max-w-full gap-2">
      <input id="cityInput" placeholder="Zadaj mesto (napr. Hlohovec)"
             class="flex-1 px-4 py-2.5 rounded-lg bg-white/20 border border-white/20 placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50">
      <button id="searchBtn" class="px-4 md:px-5 py-2.5 rounded-lg bg-white/30 hover:bg-white/40">Hľadať</button>
    </div>
  </div>
</header>

<main class="w-full px-2 md:px-4 lg:px-6 py-4 space-y-4">
  <section id="current" class="hidden glass p-4">
    <div class="text-sm text-white/80">📍 <span id="placeName">—</span></div>
    <div class="mt-2 flex flex-wrap items-center gap-4">
      <div class="flex items-end gap-3">
        <div class="text-6xl font-bold mono" id="curTemp">--°</div>
        <div class="text-6xl leading-none" id="curIcon">⛅</div>
      </div>
      <div>
        <div id="curDesc" class="text-white/90 text-lg font-semibold">—</div>
        <div id="sunInfo" class="text-white/70 text-sm">—</div>
      </div>
    </div>
    <div class="grid gap-2 mt-3 text-white/90 md:grid-cols-4 sm:grid-cols-2">
      <div class="metric"><div class="label">Vietor</div><div id="curWind" class="val mono">—</div></div>
      <div class="metric"><div class="label">Nárazy</div><div id="curGust" class="val mono">—</div></div>
      <div class="metric"><div class="label">Vlhkosť</div><div id="curHum" class="val mono">—</div></div>
      <div class="metric"><div class="label">Pocitovo</div><div id="curFeels" class="val mono">—</div></div>
    </div>
  </section>

  <section class="grid grid-cols-1 lg:grid-cols-12 gap-4">
    <div class="lg:col-span-7 glass overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 border-b border-white/20">
        <h2 class="text-lg font-semibold">24-hodinová predpoveď</h2>
        <div id="tzInfo" class="text-white/70 text-sm"></div>
      </div>
      <div class="hidden lg:block overflow-x-auto">
        <table class="tbl w-full min-w-[600px] text-sm">
          <thead>
            <tr class="text-white/90">
              <th>Čas</th><th>Počasie</th><th>Teplota</th><th>Zrážky</th><th>Vietor</th><th>Oblačnosť</th>
            </tr>
          </thead>
          <tbody id="hourRows" class="divide-y divide-white/10"></tbody>
        </table>
      </div>
      <div id="hourList" class="block lg:hidden p-2 space-y-2"></div>
    </div>

    <div class="lg:col-span-5 space-y-4">
      <div class="glass"><div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">10-dňová predpoveď</h2></div><div id="dailyList" class="p-3 space-y-2"></div></div>
      <div class="glass"><div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">Presne pred rokom</h2></div><div id="historyExact" class="p-4"></div></div>
      <div class="glass"><div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">UV index</h2></div>
        <div id="uvPanel" class="p-4 space-y-3">
          <div class="grid grid-cols-2 gap-3">
            <div class="metric"><div class="label">Aktuálne</div><div id="uvNow" class="val mono">—</div></div>
            <div class="metric"><div class="label">Maximálne</div><div id="uvMax" class="val mono">—</div></div>
          </div>
          <div><div class="uv-bar"><div id="uvFill" class="uv-fill" style="width:0%"></div></div></div>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
const API='https://api.open-meteo.com/v1';
const GEO='https://geocoding-api.open-meteo.com/v1';

const el={
  input:cityInput, btn:searchBtn, tzInfo, hourRows, hourList, dailyList,
  historyExact, uvNow, uvMax, uvFill, place:placeName, curTemp, curDesc,
  curIcon, curWind, curGust, curHum, curFeels, sunInfo
};

function sanitizeCode(c){ c=Number(c); return (c===45||c===48)?3:c; }
function iconFor(c,day=true){
  c=sanitizeCode(c);
  const m={0:'☀️',1:'🌤️',2:'⛅',3:'☁️',61:'🌧️',63:'🌧️',65:'🌧️',80:'🌦️',81:'🌧️',82:'⛈️',95:'⛈️'};
  return m[c]||'☁️';
}
function descFor(c){
  const d={0:'Jasno',1:'Prevažne jasno',2:'Oblačno',3:'Zamračené',61:'Slabý dážď',63:'Dážď',65:'Silný dážď',80:'Prehánky',81:'Mierne prehánky',82:'Silné prehánky',95:'Búrka'};
  return d[sanitizeCode(c)]||'—';
}
function fmtTime(t){return new Date(t).getHours().toString().padStart(2,'0')+':00';}
function dd2dir(dd){
  if(dd==null||isNaN(dd))return '—';
  const k=['S','SV','V','JV','J','JZ','Z','SZ'];
  const i=Math.round(dd/45)%8;
  return k[i];
}

async function geocode(q){
  const r=await fetch(`${GEO}/search?name=${encodeURIComponent(q)}&count=1&language=sk`);
  const j=await r.json();return j.results[0];
}
async function fetchWx(lat,lon){
  const url=`${API}/forecast?latitude=${lat}&longitude=${lon}`
  +`&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,weather_code,wind_speed_10m,wind_direction_10m`
  +`&hourly=temperature_2m,dew_point_2m,surface_pressure,weather_code,precipitation_probability,precipitation,wind_speed_10m,wind_direction_10m,cloud_cover`
  +`&daily=temperature_2m_max,temperature_2m_min,weather_code,sunrise,sunset&timezone=auto&forecast_days=10`;
  const r=await fetch(url);return r.json();
}

function renderCurrent(city,wx){
  const c=wx.current;
  placeName.textContent=`${city.name}, ${city.country}`;
  curTemp.textContent=Math.round(c.temperature_2m)+'°';
  curDesc.textContent=descFor(c.weather_code);
  curIcon.textContent=iconFor(c.weather_code,!!c.is_day);
  curWind.textContent=`${Math.round(c.wind_speed_10m)} km/h ${dd2dir(c.wind_direction_10m)}`;
  curHum.textContent=c.relative_humidity_2m+' %';
  curFeels.textContent=Math.round(c.apparent_temperature)+'°';
}

function renderHourly(wx){
  const H=wx.hourly;
  hourRows.innerHTML=''; hourList.innerHTML='';
  const now=new Date(); let start=0;
  for(let i=0;i<H.time.length;i++){ if(new Date(H.time[i])>=now){start=i;break;} }
  const end=Math.min(start+24,H.time.length);

  for(let i=start;i<end;i++){
    const code=sanitizeCode(H.weather_code[i]);
    const temp=Math.round(H.temperature_2m[i]);
    const pop=H.precipitation_probability?.[i];
    const pmm=H.precipitation?.[i];
    const wind=H.wind_speed_10m?.[i],wdir=H.wind_direction_10m?.[i];
    const pres=H.surface_pressure?.[i];
    const dew=H.dew_point_2m?.[i];
    const cld=H.cloud_cover?.[i];
    const time=fmtTime(H.time[i]);

    // PC
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${time}</td><td>${iconFor(code,true)} ${descFor(code)}</td><td>${temp}°</td>
    <td>${pop??0}% · ${(pmm??0).toFixed(1)} mm</td><td>${Math.round(wind)} km/h ${dd2dir(wdir)}</td><td>${cld??0}%</td>`;
    hourRows.appendChild(tr);

    // Mobil
    const card=document.createElement('div');card.className='card';
    const btn=document.createElement('button');btn.className='acc-btn';btn.innerHTML=`
      <div class="acc-head"><div class="text-2xl">${iconFor(code,true)}</div>
      <div><div class="mono font-semibold">${time} · ${temp}°</div><div class="text-white/80 text-sm">${descFor(code)}</div></div></div>
      <div class="acc-right text-sm">${pop??0}% · ${(pmm??0).toFixed(1)} mm
      <svg class="chev" width="18" height="18" viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg></div>`;
    const wrap=document.createElement('div');wrap.className='panel-wrap';
    const panel=document.createElement('div');panel.className='panel';
    panel.innerHTML=`<div class="grid grid-cols-2 gap-2 mt-3 text-sm">
      <div class="metric"><div class="label">Tlak</div><div class="val mono">${pres?Math.round(pres):'—'} hPa</div></div>
      <div class="metric"><div class="label">Rosný bod</div><div class="val mono">${dew?Math.round(dew):'—'}°</div></div>
      <div class="metric"><div class="label">Oblačnosť</div><div class="val mono">${cld??0}%</div></div>
      <div class="metric"><div class="label">Vietor</div><div class="val mono">${Math.round(wind)} km/h ${dd2dir(wdir)}</div></div>
    </div>`;
    wrap.appendChild(panel);card.appendChild(btn);card.appendChild(wrap);hourList.appendChild(card);
    let open=false;const toggle=()=>{wrap.style.height=open?panel.scrollHeight+'px':'0';panel.classList.toggle('open',open)};
    btn.onclick=()=>{open=!open;toggle();};wrap.addEventListener('transitionend',()=>{if(open)wrap.style.height='auto';});
  }
}

async function run(q){
  const city=await geocode(q);
  const wx=await fetchWx(city.latitude,city.longitude);
  renderCurrent(city,wx);
  renderHourly(wx);
}
searchBtn.onclick=()=>{if(cityInput.value.trim())run(cityInput.value.trim())};
cityInput.value='Hlohovec';run('Hlohovec');
</script>
</body>
</html>

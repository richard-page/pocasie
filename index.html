<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Predpoveƒè poƒçasia</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  *{ box-sizing:border-box !important; }
  html,body{
      width:100% !important;
      max-width:100% !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
      scrollbar-width: none;
      -ms-overflow-style: none;
  }

  html::-webkit-scrollbar,
  body::-webkit-scrollbar {
      display: none;
  }

  body{
    margin:0; color:#1f2937;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:#f8fafc;
  }

  .glass{ 
    background:rgba(255,255,255,0.9); 
    backdrop-filter:blur(12px); 
    border-radius:1rem;
    border: 1px solid rgba(255,255,255,0.8);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .hero{
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    width:100%;
    padding: 2rem 1rem 1rem;
    text-align:center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  #heroPlace{ 
      font-size:1.5rem;
      font-weight:600;
      margin-bottom: 0.5rem;
  }

  #heroIcon{ 
    font-size: 4rem;
    margin: 0.5rem 0;
  }

  #heroTemp{ 
    font-size: 4rem;
    font-weight:300;
    line-height: 1;
  }

  .search-section {
    background: white;
    padding: 1rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .tabs-nav{ 
    display:grid;
    grid-template-columns:1fr 1fr;
    background:#f1f5f9;
    padding:0.25rem;
    border-radius:0.75rem;
    margin: 1rem 0;
  }

  .tab-btn{ 
    padding:0.75rem 1rem;
    border-radius:0.5rem;
    font-weight:600;
    text-align:center;
    background:none;
    border:0;
    color:#64748b;
    cursor:pointer;
    transition:all 0.2s ease;
    font-size:0.9rem;
  }

  .tab-btn[aria-selected="true"]{ 
    background:white;
    color:#1e293b;
    box-shadow:0 2px 4px rgba(0,0,0,0.1);
  }

  .tab-content{ 
    padding: 0.5rem 0;
  }

  .tab-content.hidden{ display:none }

  .hour-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: white;
    border-radius: 0.75rem;
    margin-bottom: 0.5rem;
    border: 1px solid #f1f5f9;
  }

  .hour-time {
    font-weight: 600;
    font-size: 1rem;
    min-width: 60px;
  }

  .hour-temp {
    font-size: 1.25rem;
    font-weight: 600;
    min-width: 50px;
    text-align: center;
  }

  .hour-details {
    flex: 1;
    margin: 0 1rem;
  }

  .hour-precipitation {
    font-size: 0.875rem;
    color: #64748b;
    margin-bottom: 0.25rem;
  }

  .hour-wind {
    font-size: 0.875rem;
    color: #64748b;
  }

  .daily-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: white;
    border-radius: 0.75rem;
    margin-bottom: 0.5rem;
    border: 1px solid #f1f5f9;
  }

  .day-name {
    font-weight: 600;
    min-width: 80px;
  }

  .day-weather {
    flex: 1;
    margin: 0 1rem;
    font-size: 0.9rem;
    color: #64748b;
  }

  .day-temp {
    font-weight: 600;
    min-width: 80px;
    text-align: right;
  }

  .suggest-wrap{ position:relative; }
  .suggest{
    position:absolute;
    top:100%;
    left:0;
    right:0;
    margin-top:0.25rem;
    background:#fff;
    color:#1f2937;
    border-radius:0.75rem;
    border:1px solid #e5e7eb;
    box-shadow:0 10px 25px rgba(0,0,0,0.15);
    overflow:auto;
    max-height:16rem;
    z-index:50;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .suggest::-webkit-scrollbar { display: none; }
  .suggest.hidden{ display:none }
  .suggest-item{
    display:flex;
    align-items:center;
    gap:0.5rem;
    padding:0.75rem;
    cursor:pointer;
    border-bottom: 1px solid #f1f5f9;
  }

  .suggest-item:last-child {
    border-bottom: none;
  }

  .suggest-item:hover,
  .suggest-item[aria-selected="true"]{
    background:#f8fafc;
  }

  .flag{ width:20px; flex:0 0 20px; }
  .s-meta{ font-size:0.75rem; color:#64748b }
  .s-name{ font-weight:600; }

  #loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem 1rem;
  }

  #err {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #dc2626;
    padding: 1rem;
    border-radius: 0.75rem;
    margin: 1rem;
    text-align: center;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin: 1rem 0;
  }

  .stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 0.75rem;
    border: 1px solid #f1f5f9;
    text-align: center;
  }

  .stat-value {
    font-size: 1.5rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    font-size: 0.875rem;
    color: #64748b;
  }

  @media (max-width: 640px) {
    .hero {
      padding: 1.5rem 1rem 1rem;
    }
    
    #heroPlace {
      font-size: 1.25rem;
    }
    
    #heroTemp {
      font-size: 3rem;
    }
    
    #heroIcon {
      font-size: 3rem;
    }
    
    .hour-card,
    .daily-card {
      padding: 0.75rem;
    }
  }
</style>
</head>
<body>

<!-- Hero sekcia -->
<section class="hero">
  <div id="heroPlace">‚Äî</div>
  <div id="heroIcon">‚õÖ</div>
  <div id="heroTemp">--¬∞</div>
</section>

<!-- Vyhƒæad√°vanie -->
<section class="search-section">
  <div class="suggest-wrap w-full max-w-full mx-auto">
    <form id="searchForm" class="flex gap-2" novalidate>
      <input id="cityInput" placeholder="Zadaj n√°zov mesta"
             class="flex-1 px-4 py-3 rounded-lg bg-gray-50 border border-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
             autocomplete="off" inputmode="search" type="search" />
      <button id="searchBtn" type="submit"
              class="px-6 py-3 rounded-lg bg-blue-500 hover:bg-blue-600 text-white font-medium transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
    </form>
    <div id="citySuggestions" class="suggest hidden"></div>
  </div>
</section>

<!-- Hlavn√Ω obsah -->
<main id="refreshContainer" class="w-full px-4 pb-8">

  <!-- Tab sekcia -->
  <section class="py-4">
    <div class="tabs-nav">
      <button id="tab24hBtn" class="tab-btn" aria-selected="true" data-tab="hourly">24 hod√≠n</button>
      <button id="tab10dBtn" class="tab-btn" aria-selected="false" data-tab="daily">10 dn√≠</button>
    </div>

    <div id="hourlyContent" class="tab-content" data-tab-content="hourly">
      <div id="hourList" class="space-y-2"></div>
    </div>
    
    <div id="dailyContent" class="tab-content hidden" data-tab-content="daily">
      <div id="dailyList" class="space-y-2"></div>
    </div>
  </section>

  <!-- ≈†tatistiky -->
  <section class="stats-grid">
    <div class="stat-card">
      <div class="stat-value" id="uvNow">‚Äî</div>
      <div class="stat-label">UV index</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="historyTemp">‚Äî</div>
      <div class="stat-label">Pred rokom</div>
    </div>
  </section>

  <!-- Naƒç√≠tavanie a chyby -->
  <div id="loading" class="hidden">
    <div class="inline-block w-8 h-8 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin"></div>
    <p class="mt-2 text-gray-600">Naƒç√≠tavam √∫daje‚Ä¶</p>
  </div>
  
  <div id="err" class="hidden">
    <div class="flex items-center justify-center gap-2 text-red-600">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      Nepodarilo sa naƒç√≠ta≈• √∫daje
    </div>
  </div>
  
  <!-- P√§ta -->
  <div class="pt-6 text-gray-400 text-xs text-center">
    √ödaje poskytuje <a href="https://open-meteo.com/" target="_blank" rel="noopener noreferrer" class="hover:text-gray-600 underline">Open-Meteo</a>
  </div>
  
</main>

<script>
const API='https://api.open-meteo.com/v1';
const GEO='https://geocoding-api.open-meteo.com/v1';
const ARCH='https://archive-api.open-meteo.com/v1/era5';
const NOMINATIM_API = 'https://nominatim.openstreetmap.org/reverse?format=json&extratags=1&addressdetails=1&zoom=14&accept-language=sk';

const el={
  form:document.getElementById('searchForm'),
  input:document.getElementById('cityInput'),
  suggest:document.getElementById('citySuggestions'),
  hourList:document.getElementById('hourList'),
  dailyList:document.getElementById('dailyList'),
  historyTemp:document.getElementById('historyTemp'),
  uvNow:document.getElementById('uvNow'),
  heroPlace:document.getElementById('heroPlace'),
  heroIcon:document.getElementById('heroIcon'),
  heroTemp:document.getElementById('heroTemp'),
  loading:document.getElementById('loading'),
  err:document.getElementById('err'),
  refreshContainer:document.getElementById('refreshContainer'),
  tab24hBtn: document.getElementById('tab24hBtn'),
  tab10dBtn: document.getElementById('tab10dBtn'),
  hourlyContent: document.getElementById('hourlyContent'),
  dailyContent: document.getElementById('dailyContent'),
};

function sanitizeCode(c){ c=Number(c); return (c===45||c===48)?3:c; }

function iconFor(code){
  code=sanitizeCode(code);
  if([0,1].includes(code)) return '‚òÄÔ∏è';
  if(code===2) return '‚õÖ';
  if(code===3) return '‚òÅÔ∏è';
  if([51,53,55].includes(code)) return 'üå¶Ô∏è';
  if([61,63,65,80,81,82].includes(code)) return 'üåßÔ∏è';
  if([71,73,75,77].includes(code)) return 'üå®Ô∏è';
  if([95,96,99].includes(code)) return '‚õàÔ∏è';
  return 'üå§Ô∏è';
}

function descFor(c){
  c=sanitizeCode(c);
  const d={
    0:'Jasno',1:'Preva≈æne jasno',2:'ƒåiastoƒçne oblaƒçno',3:'Zamraƒçen√©',
    51:'Mrholenie',53:'Mrholenie',55:'Mrholenie',
    61:'Slab√Ω d√°≈æƒè',63:'D√°≈æƒè',65:'Siln√Ω d√°≈æƒè',
    71:'Sne≈æenie',73:'Sne≈æenie',75:'Siln√© sne≈æenie',77:'Snehov√© zrn√°',
    80:'Preh√°nky',81:'Preh√°nky',82:'Siln√© preh√°nky',
    95:'B√∫rka',96:'B√∫rka',99:'Siln√° b√∫rka'
  };
  return d[c]||'‚Äî';
}

function withIcon(code){ return `${iconFor(code)} ${descFor(code)}`; }

function dd2dir(dd){ 
  if(dd==null||isNaN(dd)) return '‚Äî'; 
  const deg=((dd%360)+360)%360; 
  const dirs=['S','SV','V','JV','J','JZ','Z','SZ']; 
  return dirs[Math.floor((deg+22.5)/45)%8]; 
}

function fmtTime(iso){ 
  const d=new Date(iso); 
  return d.getHours().toString().padStart(2,'0')+':00'; 
}

function fmtDay(iso){ 
  const d=new Date(iso); 
  const days=['Ne','Po','Ut','St','≈†t','Pi','So']; 
  return days[d.getDay()];
}

const flag=(cc)=> String.fromCodePoint(...[...cc.toUpperCase()].map(c=>127397+c.charCodeAt(0)));

function cityLabel(x){ 
  return (typeof x==='string'?(x.split(',')[0]):(x?.name||'')).trim()||'‚Äî'; 
}

async function geocodeAll(q,count=8){
  const r=await fetch(`${GEO}/search?name=${encodeURIComponent(q)}&count=${count}&language=sk&format=json`);
  const j=await r.json();
  return j.results||[];
}

async function reverseGeocode(lat, lon) {
  const url = `${NOMINATIM_API}&lat=${lat}&lon=${lon}`;
  try {
    const r = await fetch(url);
    if (!r.ok) return null;
    const j = await r.json();
    const addr = j.address;
    if (!addr) return null;
    const name = addr.city || addr.town || addr.village || addr.municipality || addr.county;
    if (name) {
      return { name: name, latitude: lat, longitude: lon, country_code: addr.country_code ? addr.country_code.toUpperCase() : 'SK', admin1: addr.state || '' };
    }
    const fallbackName = addr.county || addr.state || 'Aktu√°lna poloha';
    return { 
      name: fallbackName, 
      latitude: lat, 
      longitude: lon, 
      country_code: addr.country_code ? addr.country_code.toUpperCase() : 'SK', 
      admin1: addr.state || ''
    };
  } catch (e) {
    console.error("Chyba pri volan√≠ Nominatim reverseGeocode:", e);
    return null;
  }
}

async function fetchWx(lat,lon){
  const url=`${API}/forecast?latitude=${lat}&longitude=${lon}`
    +`&current=temperature_2m,is_day,weather_code`
    +`&hourly=temperature_2m,weather_code,precipitation_probability,precipitation,wind_speed_10m,wind_direction_10m,uv_index`
    +`&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max`
    +`&timezone=auto&forecast_days=16`;
  const r=await fetch(url); if(!r.ok) throw new Error('api'); return await r.json();
}

async function fetchHistoryExact(lat,lon){
  const d=new Date(); d.setFullYear(d.getFullYear()-1);
  const date=d.toISOString().slice(0,10);
  const url=`${ARCH}?latitude=${lat}&longitude=${lon}`
    +`&start_date=${date}&end_date=${date}`
    +`&daily=temperature_2m_max,precipitation_sum`
    +`&timezone=auto`;
  const r=await fetch(url); if(!r.ok) throw new Error('arch1'); return await r.json();
}

function renderHero(city, wx){
  const code = sanitizeCode(wx.current.weather_code);
  el.heroPlace.textContent = city?.__isCurrentLocation && !city.name ? 'Aktu√°lna poloha' : cityLabel(city);
  el.heroTemp.textContent = Math.round(wx.current.temperature_2m)+'¬∞';
  el.heroIcon.textContent = iconFor(code);
}

function renderHourly(wx){
  const H=wx.hourly; 
  el.hourList.innerHTML='';
  
  const now=new Date(); 
  let start=0; 
  for(let i=0;i<H.time.length;i++){ 
    if(new Date(H.time[i])>=now){ 
      start=i; 
      break; 
    } 
  }
  
  const end=Math.min(start+24,H.time.length);
  
  for(let i=start;i<end;i++){
    const code=sanitizeCode(H.weather_code[i]);
    const temp=Math.round(H.temperature_2m[i]);
    const pop=H.precipitation_probability?.[i];
    const pmm=H.precipitation?.[i];
    const wind=H.wind_speed_10m?.[i];
    const wdir=H.wind_direction_10m?.[i];

    const card=document.createElement('div');
    card.className='hour-card';
    
    card.innerHTML=`
      <div class="hour-time">${fmtTime(H.time[i])}</div>
      <div class="hour-temp">${temp}¬∞</div>
      <div class="hour-details">
        <div class="hour-precipitation">${pop!=null?`${pop}%`:'‚Äî'} ${pmm!=null?pmm.toFixed(0):'0'} mm</div>
        <div class="hour-wind">${wind!=null?`${Math.round(wind)} km/h, ${dd2dir(wdir)}`:'‚Äî'}</div>
      </div>
      <div class="text-2xl">${iconFor(code)}</div>
    `;
    
    el.hourList.appendChild(card);
  }
}

function renderDaily(wx){
  const D=wx.daily; 
  el.dailyList.innerHTML=''; 
  const n=Math.min(10,D.time.length);
  
  for(let i=0;i<n;i++){
    const dayName = fmtDay(D.time[i]);
    const tmin=Math.round(D.temperature_2m_min[i]); 
    const tmax=Math.round(D.temperature_2m_max[i]); 
    const code=sanitizeCode(D.weather_code[i]);
    
    const card=document.createElement('div');
    card.className='daily-card';
    
    card.innerHTML=`
      <div class="day-name">${dayName}</div>
      <div class="day-weather">${descFor(code)}</div>
      <div class="day-temp">${tmax}¬∞ ${tmin}¬∞</div>
      <div class="text-xl">${iconFor(code)}</div>
    `;
    
    el.dailyList.appendChild(card);
  }
}

function renderHistoryExact(hist){
  const H=hist.daily; 
  const dateStr=H.time?.[0];
  
  if(!dateStr){ 
    el.historyTemp.textContent = '‚Äî';
    return; 
  }
  
  const tmax=Math.round(H.temperature_2m_max?.[0]) || '‚Äî'; 
  el.historyTemp.textContent = tmax !== '‚Äî' ? tmax + '¬∞' : '‚Äî';
}

function renderUV(wx){
  const H=wx.hourly; 
  let uvNow=null; 
  const now=new Date();
  
  for(let i=0;i<H.time.length;i++){ 
    if(new Date(H.time[i])>=now){ 
      uvNow=H.uv_index?.[i] ?? null; 
      break; 
    } 
  }
  
  el.uvNow.textContent = uvNow!=null ? uvNow.toFixed(1) : '‚Äî';
}

async function run(queryOrCityObj){
  el.loading.classList.remove('hidden'); 
  el.err.classList.add('hidden');
  
  try{
    let city = typeof queryOrCityObj==='object'
      ? queryOrCityObj
      : (await geocodeAll(cityLabel(queryOrCityObj),1))[0];
      
    if(!city) throw new Error('notfound');

    const wx=await fetchWx(city.latitude,city.longitude);
    const hist=await fetchHistoryExact(city.latitude,city.longitude);

    renderHero(city,wx);
    renderHourly(wx);
    renderDaily(wx);
    renderHistoryExact(hist);
    renderUV(wx);

    localStorage.setItem('lastCity', JSON.stringify({
      name: city.name,
      latitude: city.latitude,
      longitude: city.longitude,
      country_code: city.country_code,
      __isCurrentLocation: !!city.__isCurrentLocation
    }));
    
  } catch(e){ 
    console.error(e); 
    el.err.classList.remove('hidden'); 
  } finally{ 
    el.loading.classList.add('hidden'); 
  }
}

function switchTab(tabName) {
  const allBtns = [el.tab24hBtn, el.tab10dBtn];
  const allContents = [el.hourlyContent, el.dailyContent];

  allBtns.forEach(btn => {
    const isActive = btn.getAttribute('data-tab') === tabName;
    btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
  });

  allContents.forEach(content => {
    const isActive = content.getAttribute('data-tab-content') === tabName;
    content.classList.toggle('hidden', !isActive);
  });
}

// Event listeners pre taby
el.tab24hBtn.addEventListener('click', () => switchTab('hourly'));
el.tab10dBtn.addEventListener('click', () => switchTab('daily'));

let selIndex=-1;
let lastSuggest=[];

function hideSuggest(){ 
  el.suggest.classList.add('hidden'); 
  el.suggest.innerHTML=''; 
  selIndex=-1; 
  lastSuggest=[]; 
}

function showSuggest(){ 
  el.suggest.classList.remove('hidden'); 
}

function cityRow(c){
  const admin = c.admin1 || c.admin2 || c.admin3 || '';
  const country = c.country || '';
  const meta = [admin, country].filter(Boolean).join(' ¬∑ ');
  return `
    <div class="s-name">${c.name}</div>
    <div class="s-meta">${meta}</div>
  `;
}

function renderSuggest(items){
  el.suggest.innerHTML='';
  items.forEach((c,idx)=>{
    const d=document.createElement('div');
    d.className='suggest-item';
    d.setAttribute('role','option');
    d.setAttribute('data-idx',idx);
    d.innerHTML=`<span class="flag">${c.country_code?flag(c.country_code):''}</span><div>${cityRow(c)}</div>`;
    d.addEventListener('mousedown',e=>{ e.preventDefault(); choose(idx); });
    el.suggest.appendChild(d);
  });
  
  if(items.length===0){
    const d=document.createElement('div');
    d.className='suggest-item'; 
    d.innerHTML='<div class="s-meta">≈Ωiadne v√Ωsledky</div>';
    el.suggest.appendChild(d);
  }
  
  showSuggest();
}

async function suggest(q){
  q = cityLabel(q);
  if(!q){ hideSuggest(); return; }
  
  try{
    const res=await geocodeAll(q,8);
    lastSuggest=res;
    renderSuggest(res);
  } catch{ 
    hideSuggest(); 
  }
}

function choose(i){
  const c=lastSuggest[i]; 
  if(!c) return;
  el.input.value = cityLabel(c);
  hideSuggest();
  run(c);
}

el.input.addEventListener('input', (e)=>{ suggest(e.target.value); });

el.input.addEventListener('keydown',(e)=>{
  const items=[...el.suggest.querySelectorAll('.suggest-item')];
  if(e.key==='ArrowDown'){ 
    if(items.length){ 
      e.preventDefault(); 
      selIndex=(selIndex+1)%items.length; 
      updateSel(items); 
    } 
  } else if(e.key==='ArrowUp'){ 
    if(items.length){ 
      e.preventDefault(); 
      selIndex=(selIndex-1+items.length)%items.length; 
      updateSel(items); 
    } 
  } else if(e.key==='Enter'){ 
    if(selIndex>=0 && lastSuggest[selIndex]){ 
      e.preventDefault(); 
      choose(selIndex); 
    } 
  } else if(e.key==='Escape'){ 
    hideSuggest(); 
  }
});

function updateSel(items){
  items.forEach((it,i)=> it.setAttribute('aria-selected', i===selIndex ? 'true' : 'false'));
  const active=items[selIndex]; 
  if(active){ 
    active.scrollIntoView({block:'nearest'}); 
  }
}

document.addEventListener('click',(e)=>{ 
  if(!e.target.closest('.suggest-wrap')) hideSuggest(); 
});

el.form.addEventListener('submit', (ev)=>{
  ev.preventDefault();
  const q=cityLabel(el.input.value);
  if(q) run(q);
});

// Geolok√°cia
function getCityFromStorage() {
  const last = localStorage.getItem('lastCity');
  try { 
    return last ? JSON.parse(last) : null; 
  } catch (e) { 
    console.error("Chyba pri parsovan√≠ lastCity:", e); 
    return null;
  }
}

function checkAndroidLocationEnabled(forceFetch=false) {
  const cityObj = getCityFromStorage();

  if (cityObj && !forceFetch) {
    el.input.value = cityLabel(cityObj);
    run(cityObj);
    return;
  }
  
  if ('geolocation' in navigator) {
    getCurrentLocation();
  } else {
    handleLocationFailure(); 
  }
}

function getCurrentLocation() {
  navigator.geolocation.getCurrentPosition(locationSuccess, locationError, {
    enableHighAccuracy: true, 
    timeout: 5000, 
    maximumAge: 0 
  });
}

async function locationSuccess(position) {
  const latitude = position.coords.latitude;
  const longitude = position.coords.longitude;
  
  let locatedCity = null;
  try {
    locatedCity = await reverseGeocode(latitude, longitude);
  } catch (e) {
    locatedCity = null;
  }

  const cityToUse = {
    name: locatedCity?.name || "", 
    latitude: latitude,
    longitude: longitude,
    country_code: locatedCity?.country_code || "SK",
    __isCurrentLocation: true
  };
  
  if(el.input) {
    el.input.value = cityToUse.name;
  }

  run(cityToUse);
}

function locationError(error) {
  handleLocationFailure();
}

function handleLocationFailure() {
  const cityObj = getCityFromStorage();
  el.loading.classList.add('hidden');

  if (cityObj) {
    el.input.value = cityLabel(cityObj);
    run(cityObj);
  } else {
    el.err.classList.remove('hidden');
    el.heroPlace.textContent = 'Poloha nezisten√°';
    el.heroTemp.textContent = '--¬∞';
    el.heroIcon.textContent = '‚ùì';
  }
}

// Spustenie aplik√°cie
checkAndroidLocationEnabled();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Poƒçasie</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
  :root{
    --bg1:#0f1e2f; --bg2:#091523;
    --card:#12243a; --stroke:#1f3a58;
    --txt:#eaf2ff; --muted:#a9bad9; --brand:#5fb0ff;
    --r:14px; --shadow:0 10px 26px rgba(0,0,0,.28);
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--txt);
    font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background: radial-gradient(1100px 700px at 50% -12%, #163152 0%, #0d223a 45%, #091523 100%),
               linear-gradient(180deg,var(--bg1),var(--bg2));
    min-height:100vh;
  }
  .wrap{max-width:1160px;margin:auto;padding:20px 14px 40px}
  header h1{margin:0 0 10px;text-align:center;font-size:28px}

  /* toolbar */
  .toolbar{display:grid;grid-template-columns:1fr auto auto auto;gap:10px;margin:12px 0}
  .searchCol{display:flex;flex-direction:column;gap:8px;position:relative}
  .search{width:100%;background:#1a2f4b;border:1px solid var(--stroke);color:#fff;border-radius:12px;padding:12px 14px;outline:none}
  #suggestions{display:none;position:absolute;top:100%;left:0;right:0;background:#0f2136;border:1px solid var(--stroke);border-radius:12px;padding:8px;margin-top:6px;z-index:20}
  .sugg{padding:8px 10px;border-radius:8px;cursor:pointer}
  .sugg:hover{background:#162c49}
  .pill{background:#23436c;border:1px solid var(--stroke);color:#e9f0ff;border-radius:12px;padding:12px 14px;font-weight:600;cursor:pointer}
  .pill.active{background:var(--brand);border-color:#3b7ec9;color:#062343}

  /* cards */
  .row{display:grid;grid-template-columns:1.05fr 1fr;gap:14px}
  @media (max-width:900px){.row{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid var(--stroke);border-radius:var(--r);box-shadow:var(--shadow);padding:14px}
  .card h3{margin:0 0 10px;text-align:center}
  .meta{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px;color:var(--muted)}
  .meta strong{color:#fff}
  .tempNow{font-size:44px;font-weight:700;margin:8px 0}
  .icon{width:70px;height:70px;display:flex;align-items:center;justify-content:center;font-size:52px}

  /* SUMMARY ‚Äì center */
  .summaryRow{margin-top:14px}
  .summaryBox{max-width:820px;margin:0 auto;text-align:center;padding:12px 14px;border:1px solid var(--stroke);background:#11233a;border-radius:12px}

  /* parts of day ‚Äì no leftover gap */
  .partsWrap{margin-top:14px}
  .partsGrid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:12px;
  }
  .part{background:#142a45;border:1px solid var(--stroke);border-radius:12px;padding:12px;text-align:center}
  .part .em{font-size:20px}
  .part .tt{font-weight:700;margin-top:6px}
  .part .sub{color:#bcd0f3;font-size:12px;margin-top:4px}

  .chartWrap{height:260px}
  canvas{background:#0f2340;border:1px solid var(--stroke);border-radius:12px}

  /* 7-day forecast (models) */
  .modelsGrid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:12px}
  @media (max-width:1024px){.modelsGrid{grid-template-columns:repeat(5,1fr)}}
  @media (max-width:720px){.modelsGrid{grid-template-columns:repeat(3,1fr)}}
  @media (max-width:520px){.modelsGrid{grid-template-columns:repeat(2,1fr)}}
  .mcol{background:#142a45;border:1px solid var(--stroke);border-radius:12px;padding:12px;text-align:center}
  .mcol .em{font-size:20px} .mcol .hi{font-weight:700} .mcol .lo{opacity:.85}
</style>
</head>
<body>
  <div class="wrap">
    <header><h1>Poƒçasie</h1></header>

    <div class="toolbar">
      <div class="searchCol">
        <input id="q" class="search" type="text" placeholder="Hƒæadaj mesto (napr. Bratislava, Ko≈°ice)">
        <div id="suggestions"></div>
      </div>
      <button id="geoBtn" class="pill">üìç Moja poloha</button>
      <button id="cBtn" class="pill active">¬∞C</button>
      <button id="fBtn" class="pill">¬∞F</button>
    </div>

    <div class="row">
      <section class="card">
        <div style="display:grid;grid-template-columns:1fr auto;gap:14px;align-items:start">
          <div>
            <h3 id="place">‚Äî</h3>
            <div id="time" style="color:#a9bad9;font-size:14px">‚Äî</div>
            <div class="tempNow" id="temp">‚Äî¬∞</div>
            <div class="meta" style="margin-top:8px">
              <div>Pocitov√° teplota: <strong id="apparent">‚Äî</strong></div>
              <div>Vietor: <strong id="wind">‚Äî</strong></div>
              <div>Vlhkos≈•: <strong id="hum">‚Äî</strong></div>
              <div>Tlak: <strong id="press">‚Äî</strong></div>
              <div>V√Ωchod slnka: <strong id="sunrise">‚Äî</strong></div>
              <div>Z√°pad slnka: <strong id="sunset">‚Äî</strong></div>
            </div>
          </div>
          <div id="icon" class="icon">‚Äî</div>
        </div>
      </section>

      <section class="card">
        <h3>Teplota poƒças 24 hod√≠n</h3>
        <div class="chartWrap"><canvas id="hourly"></canvas></div>
      </section>
    </div>

    <!-- SUMMARY centered -->
    <section class="summaryRow">
      <div class="summaryBox" id="summary">‚Äî</div>
    </section>

    <!-- Parts of day -->
    <section class="partsWrap">
      <h3 style="text-align:center;margin:14px 0 10px">Dnes po ƒçastiach</h3>
      <div id="partsGrid" class="partsGrid"></div>
    </section>

    <!-- 7-day simple forecast from ECMWF -->
    <section class="card" style="margin-top:16px">
      <h3>7-d≈àov√° predpoveƒè</h3>
      <div id="modelsGrid" class="modelsGrid"></div>
    </section>
  </div>

<script>
  // ===== helpers
  const $=s=>document.querySelector(s);
  const fmt0=(v,u='')=>(v==null||Number.isNaN(v))?'‚Äî':`${Math.round(v)}${u}`;
  const fmt1=(v,u='')=>(v==null||Number.isNaN(v))?'‚Äî':`${(Math.round(v*10)/10).toFixed(1)}${u}`;
  const toF=c=>(c*9/5)+32;
  const WMO={0:['Jasno'],1:['Preva≈æne jasno'],2:['Polojasno'],3:['Zamraƒçen√©'],45:['Hmla'],48:['Mrzn√∫ca hmla'],51:['Slab√© mrholenie'],53:['Mrholenie'],55:['Siln√© mrholenie'],61:['Slab√Ω d√°≈æƒè'],63:['D√°≈æƒè'],65:['Lejak'],66:['Mrzn√∫ci d√°≈æƒè'],67:['Mrzn√∫ci d√°≈æƒè'],71:['Slab√© sne≈æenie'],73:['Sne≈æenie'],75:['Siln√© sne≈æenie'],77:['Snehov√© zrn√°'],80:['Preh√°nky'],81:['Preh√°nky'],82:['Siln√© preh√°nky'],85:['Snehov√© preh√°nky'],86:['Siln√© snehov√© preh√°nky'],95:['B√∫rky'],96:['B√∫rky s kr√∫pami'],99:['Siln√© b√∫rky s kr√∫pami']};
  const emoji=(code)=>{const k=Number(code); if([0,1].includes(k))return'‚òÄÔ∏è'; if([2].includes(k))return'‚õÖ'; if([3].includes(k))return'‚òÅÔ∏è'; if([45,48].includes(k))return'üå´Ô∏è'; if([51,53,55].includes(k))return'üå¶Ô∏è'; if([61,63,65,80,81,82].includes(k))return'üåßÔ∏è'; if([71,73,75,77,85,86].includes(k))return'‚ùÑÔ∏è'; if([95,96,99].includes(k))return'‚õàÔ∏è'; return'üå§Ô∏è';};
  const uvCat=u=>u<3?'n√≠zky':u<6?'mierny':u<8?'vysok√Ω':u<11?'veƒæmi vysok√Ω':'extr√©mny';

  let state={units:'c',place:'Bratislava, SK',lat:48.1486,lon:17.1077,last:null};
  let hourlyChart=null;

  // ===== fetch + render
  async function fetchWeather(){
    const tz=Intl.DateTimeFormat().resolvedOptions().timeZone;
    const p=new URLSearchParams({
      latitude:state.lat, longitude:state.lon, timezone:tz,
      current:'temperature_2m,apparent_temperature,relative_humidity_2m,pressure_msl,wind_speed_10m,weather_code,uv_index',
      hourly:'temperature_2m,precipitation,weather_code,wind_speed_10m',
      daily:'weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,wind_speed_10m_max,uv_index_max,sunrise,sunset',
      forecast_days:'7'
    });
    const r=await fetch(`https://api.open-meteo.com/v1/forecast?${p}`);
    if(!r.ok) throw new Error('Naƒç√≠tanie zlyhalo');
    state.last=await r.json();
    renderHeader(); drawHourly(); renderSummary(); renderPartsOfDay(); renderModelGrid();
  }

  function renderHeader(){
    const d=state.last, cur=d.current, tz=d.timezone;
    $('#place').textContent=state.place;
    $('#time').textContent=new Intl.DateTimeFormat('sk-SK',{dateStyle:'medium',timeStyle:'short',timeZone:tz}).format(new Date(cur.time));
    const t=state.units==='c'?cur.temperature_2m:toF(cur.temperature_2m);
    const app=state.units==='c'?cur.apparent_temperature:toF(cur.apparent_temperature);
    $('#temp').textContent=fmt0(t,'¬∞');
    $('#apparent').textContent=fmt0(app,'¬∞');
    $('#wind').textContent=fmt1(cur.wind_speed_10m,' km/h');
    $('#hum').textContent=fmt0(cur.relative_humidity_2m,'%');
    $('#press').textContent=fmt0(cur.pressure_msl,' hPa');
    $('#icon').textContent=emoji(cur.weather_code);

    const sr=d.daily.sunrise?.[0]?new Date(d.daily.sunrise[0]):null;
    const ss=d.daily.sunset?.[0]?new Date(d.daily.sunset[0]):null;
    $('#sunrise').textContent=sr?sr.toLocaleTimeString('sk-SK',{hour:'2-digit',minute:'2-digit'}):'‚Äî';
    $('#sunset').textContent=ss?ss.toLocaleTimeString('sk-SK',{hour:'2-digit',minute:'2-digit'}):'‚Äî';
  }

  function drawHourly(){
    const d=state.last, cur=d.current; const hours=d.hourly.time;
    let i=hours.findIndex(h=>h.slice(0,13)===(cur.time||'').slice(0,13)); if(i<0)i=0;
    const labels=hours.slice(i,i+24).map(h=>h.split('T')[1]);
    const t24c=d.hourly.temperature_2m.slice(i,i+24), data=state.units==='c'?t24c:t24c.map(toF);
    if(hourlyChart) hourlyChart.destroy();
    hourlyChart=new Chart($('#hourly'),{
      type:'line',
      data:{labels,datasets:[{label:state.units==='c'?'Teplota (¬∞C)':'Teplota (¬∞F)',data,borderWidth:2,pointRadius:2,tension:.35}]},
      options:{responsive:true,maintainAspectRatio:false,scales:{x:{grid:{color:'rgba(255,255,255,.08)'}},y:{grid:{color:'rgba(255,255,255,.08)'}}},plugins:{legend:{labels:{color:'#fff'},onClick:(e)=>{},onHover:(e)=>{if(e?.native)e.native.target.style.cursor='default';}}}}
    });
  }

  function renderSummary(){
    const d=state.last, dd=d.daily;
    const tmax=state.units==='c'?dd.temperature_2m_max[0]:toF(dd.temperature_2m_max[0]);
    const tmin=state.units==='c'?dd.temperature_2m_min[0]:toF(dd.temperature_2m_min[0]);
    const ps=dd.precipitation_sum[0], pp=dd.precipitation_probability_max?.[0], wmax=dd.wind_speed_10m_max[0];
    const cond=(WMO[dd.weather_code?.[0]]?.[0])||'‚Äî';
    const rainTxt=ps<0.1?(pp&&pp>20?`bez v√Ωrazn√Ωch zr√°≈æok (pravdepodobnos≈• ${pp}%)`:'bez zr√°≈æok'):`zr√°≈æky do ${fmt1(ps,' mm')}`;
    const uvTxt=dd.uv_index_max?.[0]!=null?`UV ${uvCat(dd.uv_index_max[0])} (max ${fmt1(dd.uv_index_max[0])})`:'UV √∫daj nedostupn√Ω';
    $('#summary').innerHTML=`Dnes <strong>${cond.toLowerCase()}</strong>, max <strong>${fmt0(tmax,'¬∞')}</strong>, min <strong>${fmt0(tmin,'¬∞')}</strong>, ${rainTxt}, vietor do <strong>${fmt1(wmax,' km/h')}</strong>, ${uvTxt}.`;
  }

  // parts of day ‚Äì pick 09:00, 15:00, 21:00, 03:00
  function atHour(targetHour){
    const d=state.last.hourly;
    for(let i=0;i<d.time.length;i++){
      const hh=parseInt(d.time[i].split('T')[1].slice(0,2),10);
      if(hh===targetHour) return i;
    }
    return 0;
  }
  function renderPartsOfDay(){
    const h=state.last.hourly;
    const idx = {
      morning: atHour(9),
      afternoon: atHour(15),
      evening: atHour(21),
      night: atHour(3)
    };
    const parts = [
      ['Doobeda', idx.morning],
      ['Poobede', idx.afternoon],
      ['Veƒçer',   idx.evening],
      ['Noc',     idx.night]
    ];
    const g=$('#partsGrid'); g.innerHTML='';
    parts.forEach(([label,i])=>{
      const tC=h.temperature_2m[i], t=state.units==='c'?tC:toF(tC);
      const w=h.weather_code[i], p=h.precipitation[i], wind=h.wind_speed_10m[i];
      const el=document.createElement('div'); el.className='part';
      el.innerHTML = `
        <div class="sub" style="opacity:.85">${label}</div>
        <div class="em" style="font-size:22px;margin:6px 0">${emoji(w)}</div>
        <div class="tt">${fmt0(t,'¬∞')}</div>
        <div class="sub">${fmt1(p,' mm/h')} ‚Ä¢ vietor ${fmt1(wind,' km/h')}</div>
      `;
      g.appendChild(el);
    });
  }

  async function renderModelGrid(){
    const tz=Intl.DateTimeFormat().resolvedOptions().timeZone;
    const p=new URLSearchParams({latitude:state.lat,longitude:state.lon,timezone:tz,
      daily:'weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max',forecast_days:'7'});
    const r=await fetch(`https://api.open-meteo.com/v1/ecmwf?${p}`).catch(()=>null);
    const j=await r.json().catch(()=>null);
    const box=$('#modelsGrid'); box.innerHTML='';
    if(!j || !j.daily){ box.innerHTML='<div style="grid-column:1/-1;text-align:center;color:#ffd6d6">D√°ta sa nepodarilo naƒç√≠ta≈•.</div>'; return; }
    const d=j.daily, n=Math.min(7,d.time.length);
    for(let i=0;i<n;i++){
      const lab=new Date(d.time[i]+'T00:00:00').toLocaleDateString('sk-SK',{weekday:'short',day:'2-digit',month:'2-digit'});
      const max=state.units==='c'?d.temperature_2m_max[i]:toF(d.temperature_2m_max[i]);
      const min=state.units==='c'?d.temperature_2m_min[i]:toF(d.temperature_2m_min[i]);
      const el=document.createElement('div'); el.className='mcol';
      el.innerHTML = `
        <div style="opacity:.85">${lab}</div>
        <div style="font-size:20px;margin:6px 0">${emoji(d.weather_code?.[i])}</div>
        <div class="hi">${fmt0(max,'¬∞')}</div>
        <div class="lo">${fmt0(min,'¬∞')}</div>
        <div class="pp" style="color:#bcd0f3;margin-top:4px">Zr√°≈æky: ${d.precipitation_probability_max?.[i]??'‚Äî'}%</div>
      `;
      box.appendChild(el);
    }
  }

  // search & controls (r√Ωchle)
  let timer;
  $('#q').addEventListener('input',e=>{
    const q=e.target.value.trim(); clearTimeout(timer);
    if(q.length<2){$('#suggestions').style.display='none'; return;}
    timer=setTimeout(async ()=>{
      const res=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=6&language=sk&format=json`).then(r=>r.json()).catch(()=>({}));
      const arr=res.results||[]; const box=$('#suggestions'); box.innerHTML=''; box.style.display='block';
      if(!arr.length){ box.innerHTML='<div class="sugg">Niƒç sa nena≈°lo</div>'; return; }
      arr.forEach(p=>{
        const b=document.createElement('div'); b.className='sugg';
        b.textContent=`${p.name}${p.admin1?`, ${p.admin1}`:''}, ${p.country_code}`;
        b.onclick=()=>{ state.lat=p.latitude; state.lon=p.longitude; state.place=b.textContent; box.style.display='none'; fetchWeather(); };
        box.appendChild(b);
      });
    },250);
  });
  document.addEventListener('click',e=>{const box=$('#suggestions'); if(!box.contains(e.target)&&e.target!==$('#q')) box.style.display='none';});

  $('#geoBtn').addEventListener('click',()=>{
    if(!navigator.geolocation) return alert('Geolok√°cia nie je podporovan√°.');
    navigator.geolocation.getCurrentPosition(pos=>{ state.lat=pos.coords.latitude; state.lon=pos.coords.longitude; state.place='Moja poloha'; fetchWeather(); });
  });
  $('#cBtn').addEventListener('click',()=>{state.units='c'; $('#cBtn').classList.add('active'); $('#fBtn').classList.remove('active'); renderHeader(); drawHourly(); renderSummary(); renderPartsOfDay();});
  $('#fBtn').addEventListener('click',()=>{state.units='f'; $('#fBtn').classList.add('active'); $('#cBtn').classList.remove('active'); renderHeader(); drawHourly(); renderSummary(); renderPartsOfDay();});

  fetchWeather().catch(e=>alert(e.message));
  window.addEventListener('resize',()=>{ if(state.last){ drawHourly(); }});
</script>
</body>
</html>

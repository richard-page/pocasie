<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PredpoveÄ poÄasia â€“ UV index + presne pred rokom</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root { --glass: rgba(255,255,255,.08); --glass-b: rgba(255,255,255,.18); }
  * { box-sizing: border-box; }
  html, body { width:100%; max-width:100%; overflow-x:hidden; overscroll-behavior-x:none; touch-action:pan-y; }
  /* ÄistÃ¡ modrÃ¡ â€“ bez gradientu */
  body { margin:0; background:#0ea5e9; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }

  .glass { background:var(--glass); border:1px solid var(--glass-b); backdrop-filter:blur(12px); border-radius:1rem; }
  .mono  { font-feature-settings:"tnum" 1,"lnum" 1 }
  .sticky-header{ position:sticky; top:0; z-index:50; backdrop-filter:blur(10px) }

  .tbl th,.tbl td{ padding:.65rem .75rem; white-space:nowrap }
  .tbl thead th{ position:sticky; top:0; background:rgba(0,0,0,.15); backdrop-filter:blur(6px) }
  .val-bold{ font-weight:600; color:#fff }

  .metric{ background:var(--glass); border:1px solid var(--glass-b); border-radius:.75rem; padding:.6rem .8rem }
  .metric .label{ color:rgba(255,255,255,.72); font-size:.8rem; line-height:1.15 }
  .metric .val{ color:#fff; font-weight:600; font-size:1.05rem }

  .uv-bar{ height:10px; border-radius:9999px; background:rgba(255,255,255,.18); overflow:hidden }
  .uv-fill{ height:100%; border-radius:9999px }

  main, header, section, .glass, .grid, .flex { min-width:0 }
  img,video,canvas,table { max-width:100% }

  .cols { display:grid; grid-template-columns:1fr; gap:1rem; }
  @media (min-width:1024px){
    .cols { display:flex; align-items:stretch; gap:1rem; }
    .col-left, .col-right { align-self:stretch; }
  }

  /* MobilnÃ© rozbaÄ¾ovanie */
  .card{ border-radius:1rem; border:1px solid var(--glass-b); background:var(--glass); }
  .acc-btn{
    width:100%; background:none; border:0; cursor:pointer;
    padding:0.9rem 0.95rem; display:flex; align-items:center; gap:.75rem;
    text-align:left; flex-wrap:nowrap; color:#fff;
  }
  .acc-head{ flex:1; min-width:0; }
  .acc-right{ flex:0 0 auto; margin-left:auto; display:flex; align-items:center; gap:.5rem; white-space:nowrap; }
  .chip{ font-size:.9rem; opacity:.95 }
  .chev{ transition:transform .22s ease }
  .acc-btn[aria-expanded="true"] .chev{ transform:rotate(180deg) }
  .panel-wrap{ height:0; overflow:hidden; transition:height .22s ease; }
  .panel{ padding:0 .95rem .95rem .95rem; }

  /* ===== Kompakt mÃ³d na â‰¥lg (PC) â€“ menej prÃ¡zdneho priestoru ===== */
  @media (min-width:1024px){
    /* menÅ¡ie karty vpravo */
    .right-card-pad { padding:.65rem .8rem !important; }
    .right-stack-tight > * + * { margin-top:.55rem !important; }
    .tight-list > * + * { margin-top:.45rem !important; }

    /* kompaktnÃ© metriky */
    .metric{ padding:.48rem .65rem; }
    .metric .label{ font-size:.75rem; }
    .metric .val{ font-size:1rem; }

    /* menÅ¡ie medzery v grid-och */
    .current-grid { gap:.5rem !important; }
    .daily-tight  > .glass { padding:.55rem .7rem !important; }
    .section-head { padding:.55rem .8rem !important; }
  }
</style>
</head>
<body class="min-h-screen text-white">

<header class="sticky-header w-full glass">
  <div class="w-full px-3 md:px-6 py-3 flex items-center gap-3">
    <h1 class="text-base sm:text-lg md:text-xl font-semibold whitespace-nowrap truncate flex-shrink-0 max-w-[60vw]">
      PredpoveÄ poÄasia
    </h1>
    <div class="flex-1"></div>

    <form id="searchForm" class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2 w-full sm:w-[560px] max-w-full" novalidate>
      <input id="cityInput" placeholder="Zadaj mesto (napr. Hlohovec)"
             class="w-full px-4 py-2.5 rounded-lg bg-white/20 border border-white/20 placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
             autocomplete="off" inputmode="search" type="search" />
      <button id="searchBtn" type="submit"
              class="w-full sm:w-auto inline-flex items-center justify-center px-4 md:px-5 py-2.5 rounded-lg bg-white/30 hover:bg-white/40 text-white font-medium">
        HÄ¾adaÅ¥
      </button>
    </form>
  </div>
</header>

<main class="w-full px-2 md:px-4 lg:px-6 py-4 space-y-4">

  <!-- AktuÃ¡lne -->
  <section id="current" class="hidden glass p-4">
    <div class="text-sm text-white/80"><span id="placeName">â€”</span></div>
    <div class="mt-2 flex flex-wrap items-center gap-4">
      <div class="flex items-end gap-3">
        <div class="text-6xl font-bold mono" id="curTemp">--Â°</div>
      </div>
      <div>
        <div id="curDesc" class="text-white/90 text-lg font-semibold">â€”</div>
        <div id="sunInfo" class="text-white/70 text-sm">â€”</div>
      </div>
    </div>
    <div class="grid current-grid gap-2 mt-3 text-white/90 md:grid-cols-4 sm:grid-cols-2">
      <!-- bez emoji v labeloch; PC = kompaktnejÅ¡ie v CSS -->
      <div class="metric"><div class="label">Vietor</div><div id="curWind" class="val mono">â€”</div></div>
      <div class="metric"><div class="label">NÃ¡razy</div><div id="curGust" class="val mono">â€”</div></div>
      <div class="metric"><div class="label">VlhkosÅ¥</div><div id="curHum" class="val mono">â€”</div></div>
      <div class="metric"><div class="label">Pocitovo</div><div id="curFeels" class="val mono">â€”</div></div>
    </div>
  </section>

  <!-- Layout -->
  <section class="cols">
    <!-- 24 h predpoveÄ -->
    <div id="colLeft" class="col-left glass overflow-visible lg:overflow-hidden lg:basis-7/12 flex flex-col min-h-0">
      <div class="section-head flex items-center justify-between px-4 py-3 border-b border-white/20">
        <h2 class="text-lg font-semibold">24-hodinovÃ¡ predpoveÄ</h2>
      </div>

      <!-- Desktop tabuÄ¾ka -->
      <div class="hidden lg:block overflow-x-auto flex-1 min-h-0">
        <table class="tbl w-full h-full min-w-[900px] text-sm">
          <thead>
            <tr class="text-white/90">
              <th class="text-left">ÄŒas</th>
              <th class="text-left">PoÄasie</th>
              <th class="text-left">Teplota</th>
              <th class="text-left">RosnÃ½ bod</th>
              <th class="text-left">ZrÃ¡Å¾ky</th>
              <th class="text-left">Vietor</th>
              <th class="text-left">OblaÄnosÅ¥</th>
              <th class="text-left">Tlak</th>
            </tr>
          </thead>
          <tbody id="hourRows" class="divide-y divide-white/10"></tbody>
        </table>
      </div>

      <!-- Mobil â€“ rozbaÄ¾ovacie karty -->
      <div id="hourList" class="block lg:hidden p-2 space-y-2"></div>
    </div>

    <!-- PravÃ½ stÄºpec (kompaktnejÅ¡ie na PC) -->
    <div id="colRight" class="col-right lg:basis-5/12 space-y-4 right-stack-tight">
      <div class="glass right-card-pad">
        <div class="section-head px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">10-dÅˆovÃ¡ predpoveÄ</h2></div>
        <div id="dailyList" class="p-3 space-y-2 tight-list daily-tight"></div>
      </div>

      <div class="glass right-card-pad">
        <div class="section-head px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">Presne pred rokom</h2></div>
        <div id="historyExact" class="p-4"></div>
      </div>

      <div class="glass right-card-pad">
        <div class="section-head px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">UV index</h2></div>
        <div id="uvPanel" class="p-4 space-y-3">
          <div class="grid grid-cols-2 gap-3">
            <div class="metric"><div class="label">AktuÃ¡lne</div><div id="uvNow" class="val mono">â€”</div></div>
            <div class="metric"><div class="label">DneÅ¡nÃ© maximum</div><div id="uvMax" class="val mono">â€”</div></div>
          </div>
          <div>
            <div class="flex items-center justify-between mb-1">
              <div class="text-white/80 text-sm">ÃšroveÅˆ: <span id="uvCat" class="font-semibold text-white"></span></div>
              <!-- odstrÃ¡nenÃ½ text 0â€“11+ -->
            </div>
            <div class="uv-bar"><div id="uvFill" class="uv-fill" style="width:0%"></div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="loading" class="hidden text-center py-10">
    <div class="inline-block w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
    <p class="mt-2">NaÄÃ­tavamâ€¦</p>
  </div>
  <div id="err" class="hidden glass p-4">
    <div class="text-center text-red-200">Nepodarilo sa naÄÃ­taÅ¥ Ãºdaje. SkÃºs inÃ© mesto.</div>
  </div>
</main>

<script>
const API='https://api.open-meteo.com/v1';
const GEO='https://geocoding-api.open-meteo.com/v1';
const ARCH='https://archive-api.open-meteo.com/v1/era5';

const el={
  form:document.getElementById('searchForm'),
  input:document.getElementById('cityInput'),
  btn:document.getElementById('searchBtn'),
  loading:document.getElementById('loading'),
  err:document.getElementById('err'),
  current:document.getElementById('current'),
  hourRows:document.getElementById('hourRows'),
  hourList:document.getElementById('hourList'),
  dailyList:document.getElementById('dailyList'),
  historyExact:document.getElementById('historyExact'),
  uvNow:document.getElementById('uvNow'),
  uvMax:document.getElementById('uvMax'),
  uvFill:document.getElementById('uvFill'),
  uvCat:document.getElementById('uvCat'),
  place:document.getElementById('placeName'),
  curTemp:document.getElementById('curTemp'),
  curDesc:document.getElementById('curDesc'),
  curWind:document.getElementById('curWind'),
  curGust:document.getElementById('curGust'),
  curHum:document.getElementById('curHum'),
  curFeels:document.getElementById('curFeels'),
  sunInfo:document.getElementById('sunInfo')
};

function show(n,yes=true){ n.classList[yes?'remove':'add']('hidden'); }
function sanitizeCode(c){ c=Number(c); return (c===45||c===48)?3:c; }

/* Emoji len v textoch poÄasia */
function iconFor(code){
  code=sanitizeCode(code);
  if([0,1].includes(code)) return 'â˜€ï¸';
  if(code===2) return 'â›…';
  if(code===3) return 'â˜ï¸';
  if([51].includes(code)) return 'ğŸŒ¦ï¸';
  if([61,63,65,80,81,82].includes(code)) return 'ğŸŒ§ï¸';
  if([71,73,75].includes(code)) return 'ğŸŒ¨ï¸';
  if([95,96,99].includes(code)) return 'â›ˆï¸';
  return 'ğŸŒ¤ï¸';
}
function descFor(c){
  c=sanitizeCode(c);
  const d={0:'Jasno',1:'PrevaÅ¾ne jasno',2:'ÄŒiastoÄne oblaÄno',3:'ZamraÄenÃ©',
           51:'Mrholenie',61:'SlabÃ½ dÃ¡Å¾Ä',63:'Mierny dÃ¡Å¾Ä',65:'SilnÃ½ dÃ¡Å¾Ä',
           71:'SlabÃ© sneÅ¾enie',73:'Mierne sneÅ¾enie',75:'SilnÃ© sneÅ¾enie',
           80:'PrehÃ¡nky',81:'Mierne prehÃ¡nky',82:'SilnÃ© prehÃ¡nky',
           95:'BÃºrka',96:'BÃºrka s krÃºpami',99:'SilnÃ¡ bÃºrka s krÃºpami'};
  return d[c] || 'â€”';
}
function withIcon(code){ return `${iconFor(code)} ${descFor(code)}`; }

/* 8-smernÃ½ vietor */
function dd2dir(dd){
  if(dd==null||isNaN(dd)) return 'â€”';
  const deg=((dd%360)+360)%360;
  const dirs=['S','SV','V','JV','J','JZ','Z','SZ'];
  const idx=Math.floor((deg+22.5)/45)%8;
  return dirs[idx];
}
function fmtTime(iso){ const d=new Date(iso); return d.getHours().toString().padStart(2,'0')+':00'; }
function ymd(d){ return d.toISOString().slice(0,10); }

/* UV kategÃ³rie â€“ Å¾enskÃ½ rod */
function uvCategory(u){
  if(u==null||isNaN(u)) return {name:'â€”',color:'background:rgba(255,255,255,.35);'};
  if(u<=2)  return {name:'NÃ­zka',        color:'background:#9AE6B4;'}; 
  if(u<=5)  return {name:'StrednÃ¡',      color:'background:#F6E05E;'}; 
  if(u<=7)  return {name:'VysokÃ¡',       color:'background:#F6AD55;'}; 
  if(u<=10) return {name:'VeÄ¾mi vysokÃ¡', color:'background:#F56565;'}; 
  return       {name:'ExtrÃ©mna',        color:'background:#B83280;'};
}

async function geocode(q){
  const r=await fetch(`${GEO}/search?name=${encodeURIComponent(q)}&count=1&language=sk`);
  const j=await r.json(); if(!j.results||j.results.length===0) throw new Error('notfound'); return j.results[0];
}
async function fetchWx(lat,lon){
  const url=`${API}/forecast?latitude=${lat}&longitude=${lon}`
    +`&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,weather_code,wind_speed_10m,wind_gusts_10m,wind_direction_10m`
    +`&hourly=temperature_2m,dew_point_2m,surface_pressure,weather_code,precipitation_probability,precipitation,wind_speed_10m,wind_gusts_10m,wind_direction_10m,cloud_cover,uv_index`
    +`&daily=weather_code,temperature_2m_max,temperature_2m_min,sunrise,sunset,uv_index_max`
    +`&timezone=auto&forecast_days=16`;
  const r=await fetch(url); if(!r.ok) throw new Error('api'); return await r.json();
}
/* â€Pred rokomâ€œ â€“ naÄÃ­tame aj HOURLY pre max vietor + smer */
async function fetchHistoryExact(lat,lon){
  const d=new Date(); d.setFullYear(d.getFullYear()-1);
  const date=ymd(d);
  const url=`${ARCH}?latitude=${lat}&longitude=${lon}`
    +`&start_date=${date}&end_date=${date}`
    +`&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode`
    +`&hourly=wind_speed_10m,wind_direction_10m`
    +`&timezone=auto`;
  const r=await fetch(url); if(!r.ok) throw new Error('arch1'); return await r.json();
}

function renderCurrent(city,wx){
  el.place.textContent=`${city.name}${city.country?`, ${city.country}`:''}`;
  const c=wx.current, code=sanitizeCode(c.weather_code);
  el.curTemp.textContent=Math.round(c.temperature_2m)+'Â°';
  el.curDesc.textContent=withIcon(code);
  el.curWind.textContent=`${Math.round(c.wind_speed_10m)} km/h`;  // iba rÃ½chlosÅ¥
  el.curGust.textContent=`${Math.round(c.wind_gusts_10m)} km/h`;
  el.curHum.textContent=c.relative_humidity_2m+' %';
  el.curFeels.textContent=Math.round(c.apparent_temperature)+'Â°';
  const sr=wx.daily.sunrise?.[0], ss=wx.daily.sunset?.[0];
  const t=s=>s?new Date(s).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}):'â€”';
  el.sunInfo.textContent=`VÃ½chod ${t(sr)} Â· ZÃ¡pad ${t(ss)}`;
  show(el.current,true);
}

function renderHourly(wx){
  const H=wx.hourly;
  el.hourRows.innerHTML='';
  el.hourList.innerHTML='';

  const now=new Date(); let start=0;
  for(let i=0;i<H.time.length;i++){ if(new Date(H.time[i])>=now){ start=i; break; } }
  const end=Math.min(start+24,H.time.length);

  for(let i=start;i<end;i++){
    const code=sanitizeCode(H.weather_code[i]);
    const temp=Math.round(H.temperature_2m[i]);
    const dew=H.dew_point_2m?.[i];
    const pres=H.surface_pressure?.[i];
    const pop=H.precipitation_probability?.[i];
    const pmm=H.precipitation?.[i];
    const wind=H.wind_speed_10m?.[i], wdir=H.wind_direction_10m?.[i];
    const cld=H.cloud_cover?.[i];
    const timeStr=fmtTime(H.time[i]);

    // Desktop
    const tr=document.createElement('tr'); tr.className='hover:bg-white/10';
    tr.innerHTML=`
      <td class="mono">${timeStr}</td>
      <td class="text-white/85 font-medium">${withIcon(code)}</td>
      <td class="val-bold mono">${temp}Â°</td>
      <td class="val-bold mono">${dew!=null?Math.round(dew):'â€”'}Â°</td>
      <td class="val-bold mono">${pop!=null?`${pop}%`:'â€”'} Â· ${pmm!=null?pmm.toFixed(1):'0.0'} mm</td>
      <td class="val-bold mono">${wind!=null?`${Math.round(wind)} km/h`:'â€”'} (${dd2dir(wdir)})</td>
      <td class="val-bold mono">${cld!=null?`${cld}%`:'â€”'}</td>
      <td class="val-bold mono">${pres!=null?Math.round(pres):'â€”'} hPa</td>`;
    el.hourRows.appendChild(tr);

    // Mobil
    const card=document.createElement('div'); card.className='card';
    const btn=document.createElement('button'); btn.className='acc-btn'; btn.type='button';
    btn.setAttribute('aria-expanded','false');
    btn.innerHTML=`
      <div class="acc-head">
        <div>
          <div class="mono font-semibold">${timeStr} Â· ${temp}Â°</div>
          <div class="text-white/80 text-sm">${withIcon(code)}</div>
        </div>
      </div>
      <div class="acc-right">
        <span class="chip mono">${pop!=null?`${pop}%`:'â€”'} Â· ${pmm!=null?pmm.toFixed(1):'0.0'} mm</span>
        <svg class="chev" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
      </div>`;
    const wrap=document.createElement('div'); wrap.className='panel-wrap';
    const panel=document.createElement('div'); panel.className='panel';
    panel.innerHTML=`
      <div class="grid grid-cols-2 gap-2 mt-3 text-sm">
        <div class="metric"><div class="label">Tlak</div><div class="val mono">${pres!=null?Math.round(pres):'â€”'} hPa</div></div>
        <div class="metric"><div class="label">RosnÃ½ bod</div><div class="val mono">${dew!=null?Math.round(dew):'â€”'}Â°</div></div>
        <div class="metric"><div class="label">OblaÄnosÅ¥</div><div class="val mono">${cld!=null?`${cld}%`:'â€”'}</div></div>
        <div class="metric"><div class="label">Vietor</div><div class="val mono">${wind!=null?`${Math.round(wind)} km/h`:'â€”'} (${dd2dir(wdir)})</div></div>
      </div>`;
    wrap.appendChild(panel); card.appendChild(btn); card.appendChild(wrap); el.hourList.appendChild(card);

    let open=false;
    const setHeight = () => { wrap.style.height = open ? panel.scrollHeight+'px' : '0px'; };
    btn.addEventListener('click',()=>{
      if (wrap.style.height === 'auto') wrap.style.height = panel.scrollHeight+'px';
      open=!open; btn.setAttribute('aria-expanded', String(open));
      requestAnimationFrame(setHeight);
    });
    wrap.addEventListener('transitionend',(e)=>{
      if(e.propertyName!=='height') return;
      if(open){ wrap.style.height='auto'; }
    });
  }
}

function renderDaily(wx){
  const D=wx.daily; el.dailyList.innerHTML='';
  const n=Math.min(10,D.time.length);
  for(let i=0;i<n;i++){
    const d=new Date(D.time[i]);
    const dn=['Ne','Po','Ut','St','Å t','Pi','So'][d.getDay()];
    const tmin=Math.round(D.temperature_2m_min[i]);
    const tmax=Math.round(D.temperature_2m_max[i]);
    const code=sanitizeCode(D.weather_code[i]);

    const card=document.createElement('div'); card.className='glass p-3 rounded-xl';
    card.innerHTML=`
      <div class="flex items-center justify-between">
        <div>
          <div class="font-medium">${dn} ${d.getDate()}</div>
          <div class="text-white/70 text-sm">${withIcon(code)}</div>
        </div>
        <div class="mono text-lg font-semibold">${tmax}Â° / <span class="text-white/80">${tmin}Â°</span></div>
      </div>`;
    el.dailyList.appendChild(card);
  }
}

function renderHistoryExact(hist){
  const H=hist.daily;
  const dateStr=H.time?.[0];
  if(!dateStr){ el.historyExact.innerHTML='<div class="text-white/80">DÃ¡ta nie sÃº dostupnÃ©.</div>'; return; }
  const d=new Date(dateStr);
  const dn=['Ne','Po','Ut','St','Å t','Pi','So'][d.getDay()];
  const tmin=Math.round(H.temperature_2m_min?.[0]);
  const tmax=Math.round(H.temperature_2m_max?.[0]);
  const pr=(H.precipitation_sum?.[0] ?? 0).toFixed(1);
  const code=(H.weathercode?.[0] ?? 3);
  const desc=withIcon(code);

  // Max vietor + smer z hodinovÃ½ch dÃ¡t
  let windBox = 'â€”';
  const HH = hist.hourly;
  if (HH && Array.isArray(HH.wind_speed_10m) && HH.wind_speed_10m.length){
    let maxIdx = 0, maxVal = -Infinity;
    for (let i=0;i<HH.wind_speed_10m.length;i++){
      const v = HH.wind_speed_10m[i];
      if (typeof v === 'number' && v > maxVal){ maxVal = v; maxIdx = i; }
    }
    const dirDeg = HH.wind_direction_10m?.[maxIdx];
    const dirTxt = dd2dir(dirDeg);
    if (isFinite(maxVal)) windBox = `${Math.round(maxVal)} km/h ${dirTxt}`;
  }

  el.historyExact.innerHTML=`
    <div class="glass p-4 rounded-xl space-y-3">
      <div>
        <div class="font-semibold text-lg">${dn} ${d.getDate()}.${(d.getMonth()+1).toString().padStart(2,'0')}.${d.getFullYear()}</div>
        <div class="text-white/80">${desc}</div>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
        <div class="metric"><div class="label">Max</div><div class="val mono">${tmax}Â°</div></div>
        <div class="metric"><div class="label">Min</div><div class="val mono">${tmin}Â°</div></div>
        <div class="metric"><div class="label">ZrÃ¡Å¾ky</div><div class="val mono">${pr} mm</div></div>
        <div class="metric"><div class="label">Vietor (max)</div><div class="val mono">${windBox}</div></div>
      </div>
    </div>`;
}

function renderUV(wx){
  const H=wx.hourly;
  let uvNow = null;
  const now = new Date();
  for(let i=0;i<H.time.length;i++){
    if(new Date(H.time[i])>=now){ uvNow = H.uv_index?.[i] ?? null; break; }
  }
  const uvMax = wx.daily.uv_index_max?.[0] ?? null;
  const cat = uvCategory(uvMax ?? uvNow);

  el.uvNow.textContent = uvNow!=null ? uvNow.toFixed(1) : 'â€”';
  el.uvMax.textContent = uvMax!=null ? uvMax.toFixed(1) : 'â€”';
  el.uvCat.textContent = cat.name;

  const u = Math.max(0, Math.min(11, (uvMax!=null?uvMax:uvNow)||0));
  el.uvFill.style.width = (u/11*100).toFixed(0)+'%';
  el.uvFill.style.cssText += ';'+cat.color;
}

async function run(q){
  el.loading.classList.remove('hidden'); el.err.classList.add('hidden');
  try{
    const city=await geocode(q);
    const wx=await fetchWx(city.latitude,city.longitude);
    const histExact=await fetchHistoryExact(city.latitude,city.longitude);

    renderCurrent(city,wx);
    renderHourly(wx);
    renderDaily(wx);
    renderHistoryExact(histExact);
    renderUV(wx);
  }catch(e){
    el.err.classList.remove('hidden');
  }finally{
    el.loading.classList.add('hidden');
  }
}

el.form.addEventListener('submit', (ev)=>{
  ev.preventDefault();
  const q=el.input.value.trim();
  if(q) run(q);
});

el.input.value='Hlohovec';
run('Hlohovec');
</script>
</body>
</html>

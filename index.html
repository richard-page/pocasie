
<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radarov√© inform√°cie | MeteoPoƒçasie.sk</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
            <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a4130fa7fd.js" crossorigin="anonymous"></script>
      <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<script src="https://kit.fontawesome.com/a4130fa7fd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.min.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6237697852136105" crossorigin="anonymous"></script>
    <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>

<!-- Example ad unit -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6237697852136105"
     data-ad-slot="f08c47fec0942fa0"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<style>
 .adsbygoogle {
   position: absolute;
   z-index: 1001;
   margin-top: 20%;
 }
</style>
    <div id="live-text">
  
</div>
    <style>
        /* Global styles */
        body {
            margin: 0;
            padding: 0;
            font-family: Poppins;
        }
        
        /* Map and controls layout */
        #mapid {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }
        
.layer-container {
            position: absolute;
            z-index: 1000;
            top: 35%;
            left: 2%;
            right: 2%;
            background: #002043;
            padding: 10px;
            border-radius: 10px;
            display: none; /* Initially hidden */
            height: 170px;
        }
        .layer-container button {
            display: block;
            width: 150px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: ;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }
        .layer-container button:hover {
            background-color: ;
        }
        
        
        
        
        
        .toggle-button {
            position: absolute;
            z-index: 1000;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: #002043;
            border-radius: 50%;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        

        
        
        
        
        
                .toggle-button-2 {
            position: absolute;
            z-index: 1000;
            top: 80px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: #002043;
            border-radius: 50%;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        
        
                        .toggle-button-3 {
            position: absolute;
            z-index: 1000;
            top: 140px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: #002043;
            border-radius: 50%;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        
        
           .toggle-button-6 {
            position: absolute;
            z-index: 1001;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: #002043;
            border-radius: 50%;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        
        
                                .toggle-button-4 {
            position: absolute;
            z-index: 1000;
            top: 80px;
            right: 20px;
            width: 40px;
            height: 40px;
            background-color: #002043;
            border-radius: 50%;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        
        .legend {
            position: absolute;
            bottom: 12%;
            right: 10px;
            z-index: 1000;
            background-color: #FFFFFFEB;
            padding: 10px;
            border-radius: 6px;
            display: none;
        }
        
        .legend.active {
            display: block;
        }
        
        .legend-icon {
            position: absolute;
            bottom: 50px;
            right: 20px;
            z-index: 1001;
            width: 30px;
            height: 30px;
            background-color: #FFFFFF;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .legend-icon i {
            font-size: 20px;
            color: #fff;
        }
        
        
        @media only screen and (max-width: 730px){
            .legend {
            position: absolute;
            bottom: 12%;
            right: 10px;
            z-index: 1000;
            background-color: #FFFFFFEB;
            padding: 10px;
            border-radius: 6px;
            display: none;
        }
        
        .legend.active {
            display: block;
        }
        
        .legend-icon {
            position: absolute;
            bottom: 50px;
            right: 20px;
            z-index: 1001;
            width: 30px;
            height: 30px;
            background-color: #FFFFFF;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .legend-icon i {
            font-size: 20px;
            color: #fff;
        }
        }
        
        
        #timestamp {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #002043;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 25px;
            display: block;
            z-index: 999;
            color: #fff;
            font-weight: 600;
            font-family: Poppins;
            border: 1px solid #fff;
        }
        
        
@media only screen and (max-width: 730px){
        #timestamp {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #002043);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            display: block;
            z-index: 999;
            color: #fff;
            font-weight: 600;
            font-family: Poppins;
            border: 1px solid #fff;
        }
        
}
        
        #playPauseButton {
            
        }
        
       .image {
         width: 140px;
       }
       
       
       .weather-box {
            position: absolute;
            background: transparent;
            padding: 1px;
            color: #000;
            border-radius: 3px;
            font-size: 7px;
            line-height: 12px;
            text-align: center;
            pointer-events: none;
            display: none;
        }
        .weather-box img {
            vertical-align: middle;
            height: 20px;
            width: 20px;
            filter: drop-shadow(0 0 3px #000);
        }
        .legend {
            padding: 10px;
            font-size: 12px;
            background: white;
            line-height: 10px;
            color: #555;
            max-height: 200px;
            overflow: auto;
            display: none;
        }
        .legend div {
            display: flex;
            align-items: center;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }
        .legend-toggle {
            position: absolute;
            bottom: 5%;
            left: 0;
            background: white;
            padding: 5px;
            cursor: pointer;
            z-index: 1000;
            border: 1px solid #ccc;
            
        }
        
        input[type="radio"] {
          -webkit-appearance: none;
          appearance: none;
          background: #fff;
          width: 1.5em;
          height: 1.5em;
          border: 0.15em solid #000;
          border-radius: 50%;
          transform: translateY(-0.075em);
        }
        
        
        
        input[type="radio"]:checked::before {
          transform: scale(1.5);
        }
        
        input[type="radio"].active {
          background: #000;
        }
        
        input[type="radio"]:focus.active {
          outline: max(2px, 0.15em) solid #000;
         outline-offset: max(2px, 0.15em);
        }
        
        input[type="radio"]::before {
         content: "";
         width: 0.65em;
         height: 0.65em;
         border-radius: 50%;
         transform: scale(0);
         transition: 120ms transform ease-in-out;
         box-shadow: inset 1em 1em var(--form-control-bg); 
         background: canvasText;
       }
       
             .form-control:focus-within {
        color: var(--form-control-bg);
      }
       
       input[type="radio"]:focus {
         outline: max(2px, 0.15em) solid #000;
         outline-offset: max(2px, 0.15em);
       }
       
       input[type="radio"]:hover {
          background: #000;
          color: #fff;
        }
       
              :root {
         --form-control-color: #000;
       }
       
       :root {
          --form-control-bg: #000;
        }
       
       
      .fa-info-circle {
         color: #000; 
         background: #fff;
      }
      
      
     .fa-info-circle::before {
       content: "i";
       color: #000; 
         background: #fff;
     }
     
    label {
      font-weight: bolder;
      font-family: Poppins
    }
    
    
    #manualUpdateButton {
    
}

.separator {
  left: 4%;
  right: 0;
  height: 1px;
  width: 120px;
  background: #FFFFFF75;
  position: absolute;
  display: inline-block;
  text-align: center;
}


.separator:before {
  content: "In√©";
 text-align: center;
 position: absolute;
 color: #fff;
 margin-top: -10%;
 margin-left: 60%;
}






.live-badge {
display: inline-flex;
align-items: center;
background-color: red;
color: white;
padding: 6px 16px;
border-radius: 25px;
font-size: 14px;
font-weight: 600;
gap: 10px;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.dot-wrapper {
position: relative;
width: 12px;
height: 12px;
}

.dot1, .dot2 {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
border-radius: 50%;
background-color: white;
opacity: 0.8;
}

.dot1 {
width: 14px;
height: 14px;
animation: pulse1 2s infinite ease-in-out;
}

.dot2 {
width: 8px;
height: 8px;
animation: pulse2 2s infinite ease-in-out;
animation-delay: 1s;
}

@keyframes pulse1 {
0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
50% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.4; }
100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
}

@keyframes pulse2 {
0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.5; }
100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

#live-text {
transition: opacity 0.6s ease;
}

.fade-out {
opacity: 0;
}

/* Hlavn√° spodn√° skupina tlaƒçidiel */
.button-group-wrapper {
display: flex;
gap: 12px; /* Medzera medzi skupinami tlaƒçidiel */
margin-top: 30px;
bottom: 180px;
}


@media only screen and (max-width: 730px){
  /* Hlavn√° spodn√° skupina tlaƒçidiel */
.button-group-wrapper {
display: flex;
gap: 12px; /* Medzera medzi skupinami tlaƒçidiel */
margin-top: 30px;
bottom: 120px;
}

}

.button-group {
display: flex;
}

.control-button {
background-color: #002041;
color: white;
border: 1px solid #FFFFFF38;
width: 45px;
height: 45px;
font-size: 18px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: background-color 0.3s ease;
}

.control-button:active {
background-color: #309afe;
}


.control-button-2 {
background-color: #002041;
color: white;
border: 1px solid #FFFFFF38;
width: 20px;
height: 20px;
font-size: 18px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: background-color 0.3s ease;
position: absolute;
border-radius: 50px;
right: -1%;
top: -5%;
}

.control-button-2:active {
background-color: #309afe;
}



.control-buttons {
background-color: #002041;
color: white;
border: 1px solid #FFFFFF38;
width: 45px;
height: 45px;
font-size: 18px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: background-color 0.3s ease;
}

.control-buttons:active {
background-color: #309afe;
}

/* Zaoblenie len pre prv√© a posledn√© v ka≈ædej skupine */
.button-group .control-button:first-child {
border-top-left-radius: 25px;
border-bottom-left-radius: 25px;
}

.button-group .control-button:last-child {
border-top-right-radius: 25px;
border-bottom-right-radius: 25px;
}

/* Horn√© tlaƒçidl√° + a - */
.corner-button-group {
position: absolute;
top: 20px;
right: 20px;
display: flex;
}

.corner-button-group .control-button:active {
background-color: #309afe;
}

.corner-button-group .control-button {
width: 40px;
height: 40px;
font-size: 16px;
border-radius: 0;
background-color: #002041;
color: white;
border: none;
}

.corner-button-group .control-button:first-child {
border-top-left-radius: 25px;
border-bottom-left-radius: 25px;
}

.corner-button-group .control-button:last-child {
border-top-right-radius: 25px;
border-bottom-right-radius: 25px;
}


    </style>
</head>
<body>
  
  
  

<!-- === Custom Message Popup (replaces alert) === -->
<div id="message-popup">
<div id="message-content"></div>
<button onclick="closeMessagePopup()">OK</button>
</div>

<div id="control-panel-container"></div>
  <div class="button-group-wrapper">
    <!-- v≈°etky tlaƒçidl√° -->
  </div>

  <div id="slider-panel-container" style="display: none;">
    <div class="slider-container">
      <input type="range" min="0" max="15" value="11" oninput="updateSlider(this)" id="timeSlider">
       <button class="control-button-2" onclick="restoreControlPanel()" aria-label="Sp√§≈• na panel">
        <i class="fas fa-xmark"></i>
      </button>
    </div>
  </div>




  <div id="map-wrapper">
    
  
    
  
  <div id="control-panel-container"></div> 
<div class="toggle-button-2" onclick="toggleGPS()"><i class="fa-solid fa-location-crosshairs"></i></div>
<div class="toggle-button-3" onclick="toggleScreenFullMap()"><i class="fa-solid fa-expand"></i></div>





<div class="toggle-button-6" onclick="exitButton()">
  <i class="fa-solid fa-layer-group"></i>
</div>


<style>
  #logo-container {
  position: absolute;
  bottom: 0%;
  left: 5%;
  z-index: 999; /* zabezpeƒç√≠, ≈æe logo bude nad mapou */
}

#logo {
  width: 100px; /* nastavte veƒækos≈• loga podƒæa potreby */
  height: auto;
  opacity: 0.8; /* priehƒæadnos≈• loga (voliteƒæn√©) */
}


@media only screen and (max-width: 730px){
  #logo-container {
  position: absolute;
  bottom: 23%;
  left: 0%;
  z-index: 999; /* zabezpeƒç√≠, ≈æe logo bude nad mapou */
}

#logo {
  width: 90px; /* nastavte veƒækos≈• loga podƒæa potreby */
  height: auto;
  opacity: 0.8; /* priehƒæadnos≈• loga (voliteƒæn√©) */
}
}




.slider-container {
  background-color: #002043;
  padding: 18px 14px;
  border-radius: 25px;
  width: 200px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1001;
  position: absolute;
  bottom: 15%;

  /* D√¥le≈æit√© centrovanie */
  left: 50%;
  transform: translateX(-50%);
}


    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 4px; /* P√¥vodn√° tenk√° v√Ω≈°ka dr√°hy */
      background: transparent; /* P√¥vodne biela, teraz transparentn√°, aby sa zobrazil JS gradient */
      outline: none;
      border-radius: 25px;
      transition: background 0.2s ease-in-out; /* Hladk√Ω prechod pre pozadie gradientu */
      margin-top: 0; /* Resetuje margin-top, aby flexbox mohol centrova≈• */
    }

    /* WebKit (Chrome, Safari) */
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #3a9be3;
      border: 3px solid #002043;
      /* Margin-top palca je prisp√¥soben√Ω tak, aby bol vycentrovan√Ω na tenkej ƒçiare */
      margin-top: -10.5px;
      cursor: pointer;
      position: relative;
      z-index: 2;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Prid√° tie≈à palcu */
      transition: background 0.2s ease-in-out, transform 0.1s ease-in-out; /* Hladk√© prechody pre palec */
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: #2a8bd2; /* Tmav≈°ia modr√° pri prechode my≈°ou */
      transform: scale(1.05); /* Mierne zv√§ƒç≈°√≠ pri prechode my≈°ou */
    }

    input[type="range"]::-webkit-slider-runnable-track {
      height: 4px; /* P√¥vodn√° tenk√° v√Ω≈°ka dr√°hy */
      border-radius: 25px;
      background: transparent; /* D√¥le≈æit√©: Urob√≠ dr√°hu transparentnou, aby sa zobrazil gradient z JS */
    }

    /* Firefox */
    input[type="range"]::-moz-range-thumb {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #3a9be3;
      border: 3px solid #002043;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Prid√° tie≈à palcu */
      transition: background 0.2s ease-in-out, transform 0.1s ease-in-out; /* Hladk√© prechody pre palec */
    }

    input[type="range"]::-moz-range-thumb:hover {
      background: #2a8bd2; /* Tmav≈°ia modr√° pri prechode my≈°ou */
      transform: scale(1.05); /* Mierne zv√§ƒç≈°√≠ pri prechode my≈°ou */
    }

    input[type="range"]::-moz-range-track {
      height: 4px; /* P√¥vodn√° tenk√° v√Ω≈°ka dr√°hy */
      border-radius: 25px;
      background: transparent; /* D√¥le≈æit√©: Urob√≠ dr√°hu transparentnou */
    }

    input[type="range"]::-moz-range-progress {
      background-color: #3a9be3;
      height: 4px; /* P√¥vodn√° tenk√° v√Ω≈°ka dr√°hy */
      border-radius: 25px;
    }

    /* Edge & IE */
    input[type="range"]::-ms-thumb {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      background: #3b9af8;
      border: 3px solid #002043;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); /* Prid√° tie≈à palcu */
      transition: background 0.2s ease-in-out, transform 0.1s ease-in-out; /* Hladk√© prechody pre palec */
    }

    input[type="range"]::-ms-thumb:hover {
      background: #2a8bd2; /* Tmav≈°ia modr√° pri prechode my≈°ou */
      transform: scale(1.05); /* Mierne zv√§ƒç≈°√≠ pri prechode my≈°ou */
    }

    input[type="range"]::-ms-track {
      height: 4px; /* P√¥vodn√° tenk√° v√Ω≈°ka dr√°hy */
      background: transparent; /* D√¥le≈æit√©: Urob√≠ dr√°hu transparentnou */
      border-color: transparent;
      color: transparent;
    }

    input[type="range"]::-ms-fill-lower {
      background: #3a9be3; /* Vyplnen√° ƒças≈• pre Edge/IE */
      border-radius: 25px;
      height: 4px; /* P√¥vodn√° tenk√° v√Ω≈°ka dr√°hy */
    }

    input[type="range"]::-ms-fill-upper {
      background: white; /* Nevyplnen√° ƒças≈• pre Edge/IE */
      border-radius: 25px;
      height: 4px; /* P√¥vodn√° tenk√° v√Ω≈°ka dr√°hy */
    }
</style>
<script>
    // Funkcia na aktualiz√°ciu pozadia posuvn√≠ka na z√°klade jeho hodnoty
    function updateSlider(slider) {
  const value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
  slider.style.background = `linear-gradient(to right, #3a9be3 ${value}%, white ${value}%)`;
}


    // Z√≠ska element posuvn√≠ka
    const slider = document.querySelector('input[type="range"]');

    // Prid√° posluch√°ƒça udalost√≠ na aktualiz√°ciu posuvn√≠ka po naƒç√≠tan√≠ obsahu DOM
    // Toto zabezpeƒç√≠ spr√°vny poƒçiatoƒçn√Ω vzhƒæad posuvn√≠ka
    document.addEventListener('DOMContentLoaded', () => {
      updateSlider(slider);
    });
    
    
  
  
  
function showSlider() {
  document.querySelector('#control-panel-container').style.display = 'none';
  document.getElementById('slider-panel-container').style.display = 'block';

  const slider = document.getElementById('timeSlider');
  if (slider) {
    updateSlider(slider); // nastav vzhƒæad a r√°mec
  }
}

function restoreControlPanel() {
  document.getElementById('slider-panel-container').style.display = 'none';
  document.querySelector('#control-panel-container').style.display = 'flex'; // alebo block, podƒæa layoutu
}




  </script>
<script>
  // Funkcia na pridanie loga do mapy
function addLogoToMap() {
  var logoContainer = document.createElement('div');
  logoContainer.id = 'logo-container';

  var logoImage = document.createElement('img');
  logoImage.src = 'https://www.meteopocasie.sk/wp-content/uploads/2024/01/Untitled49_20231209213754.png'; // Zme≈àte cestu k obr√°zku loga
  logoImage.id = 'logo';
  logoImage.style.width = "9px";
  logoImage.style.filter = "blur(9px)";

  logoContainer.appendChild(logoImage);
  document.body.appendChild(logoContainer);
}

// Zavolajte funkciu po inicializ√°cii mapy
addLogoToMap(); 
</script>


<div class="overlay-a">
    <div class="layer-container" id="layerPanel">

    <style>
        /* Import Poppins font */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400&display=swap');

        /* General styles */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #F0F0F0;
            font-family: 'Poppins', sans-serif;
            margin: 0;
        }

        /* Container to center buttons and allow wrapping */
        .button-container-fit {
            display: inline-flex;
            gap: 10px; /* Space between buttons */
            width: auto; /* Set a fixed width for the container */
            position: static;
            border-radius: 20px;
        }

        /* General button styles */
        .custom-button-fit {
            background-color: #002043;
            color: transparent;
            width: calc(50% - 5px); /* Two buttons per row with a gap */
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            cursor: pointer;
            transition: transform 0.2s;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
            height: 80px; /* Set a consistent height for buttons */
        }

        /* Button hover effect */
        .custom-button-fit:hover {
            transform: scale(1.05);
        }

        /* Top icon */
        .top-icon {
            width: 20px;
            height: 20px;
            margin-bottom: 5%;
            z-index: 200; /* Ensure it stays above the overlay */
            margin-left: -5%;
            position: absolute;
            font-family: Poppins;
        }

        /* Text inside button */
        .button-text-fit {
            font-size: 12px;
            margin: -5% 0;
            z-index: 200; /* Ensure it stays above the overlay */
            font-family: Poppins;
            font-weight: 600;
            position: relative;
            width: 100%;
        }

        /* Bottom image adjusted to fill the button's width fully */
        .bottom-icon-fit {
            width: 100%;
            height: auto;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            object-fit: cover;
            border-radius: ;
            z-index: 0; /* Behind the overlay and other elements */
            font-weight: 600;
            font-family: Poppins;
        }

        /* Overlay effect for bottom images */
        .custom-button-fit::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%; /* Covers the entire bottom image */
            background: rgba(0, 0, 0, 0.4); /* Dark overlay with transparency */
            z-index: 1; /* Between the image and text/icon */
        }

        /* Special style for the "Vymaza≈•" button */
        .reset-button-fit {
            height: 80px;
            justify-content: center;
        }
        
       .button-container-fit-2 {
         position: relative;
         display: flex;
         gap: 10px;
         overflow-x: scroll;
       }
        
        
               .button-container-fit-3 {
         position: relative;
         display: flex;
         gap: 10px;
         overflow-x: scroll;
       }
        
        
.button-container-fit {
  display: inline-flex;
  gap: 10px;
}

.custom-checkbox-fit {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 150px;
  height: 80px;
  cursor: pointer;
  border-radius: 20px;
  overflow: hidden;
  background-color: #002043;
  color: white;
  font-family: Poppins, sans-serif;
}

.custom-checkbox-fit input[type="checkbox"] {
  display: none;
}

/* Obr√°zok na pozad√≠ - mus√≠ by≈• √∫plne pod */
.bottom-icon-fit {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
}

/* Tmav√Ω overlay pre lep≈°iu ƒçitateƒænos≈• textu */
.custom-checkbox-fit::after {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1;
}

/* Ikona a text maj√∫ vy≈°≈°√≠ z-index aby boli navrchu */
.top-icon,
.button-text-fit {
  position: relative;
  z-index: 2;
}

.top-icon {
  font-size: 20px;
  margin-bottom: 4px;
}

.button-text-fit {
  font-size: 12px;
  font-weight: 600;
  text-align: center;
}

/* Pri za≈°krtnutom checkboxe rozjasn√≠me text a ikonu */
.custom-checkbox-fit.checked .top-icon,
.custom-checkbox-fit.checked .button-text-fit {
  filter: brightness(1.5);
}

.leaflet-control-zoom {
  display: none !important;
}


        .leaflet-control-layers-expanded{
          background: #000000C9;
        }
        
        
        
        .modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.modal-content {
  position: relative;
  width: 90%;
  max-width: 800px;
  height: 80%;
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
}

.close-button {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 24px;
  font-weight: bold;
  color: #333;
  cursor: pointer;
  z-index: 10;
}

    .button-wrapper {
      position: relative;
      display: inline-block;
    }

    .plus-button {
      background-color: #FFD700; /* ≈ælt√° */
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s;
      position: relative;
      z-index: 1;
    }

    .plus-button:hover {
      background-color: #FFC107; /* tmav≈°ia ≈ælt√° pri hover */
    }

    .plus-button i {
      color: #000; /* ƒçierna ikona */
      font-size: 24px;
    }

    .label {
      position: absolute;
      bottom: -12px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #fff; /* biely text */
      background: #309afe; /* modr√© pozadie */
      padding: 2px 6px;
      border-radius: 6px;
      z-index: 2;
      pointer-events: none;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    </style>
    <section class="button-container-fit-2">
      
<div class="button-container-fit">
  <label class="custom-checkbox-fit" for="toggle-reports">
    <input type="checkbox" id="toggle-reports" onchange="toggleWeatherReports()" />

    <!-- Horn√° ikona -->
    <i class="fa-solid fa-user-check top-icon"></i>
<br>
    <!-- Text -->
    <span class="button-text-fit">Hl√°senia poƒçasia</span>
<br>
    <!-- Obr√°zok pozadia -->
    <img src="https://www.meteopocasie.sk/meteoradar/report.png" alt="Pozorovania" class="bottom-icon-fit" />
  </label>
</div>






          <div class="button-container-fit">
        <!-- Radar / blesky button -->
        <button onclick="setKind('combi')" class="custom-button-fit">
           <i class="fa-solid fa-satellite-dish top-icon fa-xl"></i><br>
            <span class="button-text-fit">Radar+Satelit</span>
            <img src="https://i.postimg.cc/nLQ11T2t/IMG-20241101-070756.jpg" alt="Additional icon" class="bottom-icon-fit">
        </button>
        </div>
        
             <div class="button-container-fit">
        <!-- Radar / blesky button -->
        <button onclick="setKind('satDWD')" class="custom-button-fit" style="pointer-events: ;">
           <i class="fa-solid fa-satellite top-icon fa-xl"></i><br>
            <span class="button-text-fit">Satelit infra</span>
            <img src="https://www.meteopocasie.sk/meteoradar/infra.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
        </div>
        
        
                     <div class="button-container-fit" style="opacity: 0.5; pointer-events: none;">
        <!-- Radar / blesky button -->
        <button onclick="addPressureLayer()" class="custom-button-fit" style="pointer-events: ;">
           <i class="fa-solid fa-satellite-dish top-icon fa-xl"></i><br>
            <span class="button-text-fit" style="color:red;">Izobary</span>
            <img src="https://i.postimg.cc/nLQ11T2t/IMG-20241101-070756.jpg" alt="Additional icon" class="bottom-icon-fit">
        </button>
        </div>
        
        
        <div class="button-container-fit">
  <button onclick="setKind('blitzDWD')" class="custom-button-fit">
    <i class="fa-solid fa-bolt top-icon fa-xl"></i><br>
    <span class="button-text-fit">Hustota bleskov</span>
    <img src="https://www.meteopocasie.sk/meteoradar/.png" class="bottom-icon-fit">
  </button>
</div>



    <div class="button-container-fit">
        <!-- Satelit / blesky button -->
        <button onclick="addLightningLayer()"  class="custom-button-fit">
           <i class="fa-solid fa-bolt top-icon fa-xl"></i><br>
            <span class="button-text-fit">Blesky</span>
            <img src="https://cms.accuweather.com/wp-content/uploads/2018/02/lightning-getty-6.jpg" alt="Additional icon" class="bottom-icon-fit">
        </button>
</div>

    <div class="button-container-fit">
        <!-- Satelit / blesky button -->
        <button onclick="arrowPrecip()"  class="custom-button-fit">
           <i class="fa-solid fa-wind top-icon fa-xl"></i><br>
            <span class="button-text-fit">Smer zr√°≈æok a vetra</span>
            <img src="https://www.meteopocasie.sk/pocasie/predpoved/map_forecast/arrowWind.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
</div>


          <div class="button-container-fit">
        <!-- Radar / blesky button -->
        <button class="custom-button-fit" onclick="toggleRainAccumLayer(this)">
           <i class="fa-solid fa-drop top-icon fa-xl"></i><br>
            <span class="button-text-fit">Zr√°≈ækov√© √∫hrny</span>
            <img src="https://i.postimg.cc/nLQ11T2t/IMG-20241101-070756.jpg" alt="Additional icon" class="bottom-icon-fit">
        </button>
        </div>
        
                  <div class="button-container-fit">
        <!-- Radar / blesky button -->
        <button class="custom-button-fit" onclick="toggleWindSpeedLayer(this)">
           <i class="fa-solid fa-wind top-icon fa-xl"></i><br>
            <span class="button-text-fit">Aktu√°lne n√°razy vetra</span>
            <img src="https://i.postimg.cc/nLQ11T2t/IMG-20241101-070756.jpg" alt="Additional icon" class="bottom-icon-fit">
        </button>
        </div>
        
                  <div class="button-container-fit">
                    
        <!-- Radar / blesky button -->
        <button class="custom-button-fit" id="weatherLayerToggle">
           <i class="fa-solid fa-drop top-icon fa-xl"></i><br>
            <span class="button-text-fit">Aktu√°lne poƒçasie</span>
            <img src="https://i.postimg.cc/8kRbcTk9/Screenshot-20250712-190840-com-android-chrome-edit-422854479803183.jpg" alt="Additional icon" class="bottom-icon-fit">
        </button>
        </div>

    <div class="button-container-fit">
        <!-- Oƒçak√°van√© b√∫rky button -->
        <button onclick="addPrognosticLayer()"  class="custom-button-fit">
<i class="fa-solid fa-bolt top-icon fa-xl"></i><br>
            <span class="button-text-fit">Oƒçak√°van√© b√∫rky</span>
            <img src="https://eoimages.gsfc.nasa.gov/images/imagerecords/149000/149301/maracaibo.jpg" alt="Additional icon" class="bottom-icon-fit">
        </button>
         <button onclick="addSatelliteLayer()"  class="custom-button-fit">
<i class="fa-solid fa-cyclone  top-icon fa-xl"></i><br>
            <span class="button-text-fit">Hurik√°ny</span>
            <img src="https://t3.ftcdn.net/jpg/08/45/81/20/360_F_845812066_0v5YOYPWEZVpmNDw48YNEKKlg0H5tDJ6.webp" alt="Additional icon" class="bottom-icon-fit">
        </button>
</div>

    <div class="button-container-fit">
        <!-- Vymaza≈• button (without bottom icon) -->
        <button id="manualUpdateButton" onclick="manualUpdate()" class="custom-button-fit reset-button-fit">
<i class="fa-solid fa-trash top-icon fa-xl"></i><br>
            <span class="button-text-fit">Vymaza≈•</span>
        </button>
    </div>
    </section>
<section class="button-container-fit-3">
    <div class="button-container-fit">
        <button onclick="setBaseMap('Satellite')" class="custom-button-fit">
            <i class="fa-solid fa-map top-icon fa-xl"></i><br>
            <span class="button-text-fit">Satelitn√°</span>
<img src="https://www.meteopocasie.sk/pocasie/predpoved/map_forecast/satellite.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
    </div>
    <div class="button-container-fit">
        <button onclick="setBaseMap('Dark All')" class="custom-button-fit">
            <i class="fa-solid fa-map top-icon fa-xl"></i><br>
            <span class="button-text-fit">ƒåierna mapa</span>
            <img src="https://www.meteopocasie.sk/pocasie/predpoved/map_forecast/dark_all.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
    </div>
    <div class="button-container-fit">
        <button onclick="setBaseMap('Hillshade')" class="custom-button-fit">
            <i class="fa-solid fa-map top-icon fa-xl"></i><br>
            <span class="button-text-fit">Tmavosiv√° mapa</span>
            <img src="https://www.meteopocasie.sk/pocasie/predpoved/map_forecast/gray.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
    </div>
            <div class="button-container-fit">
        <button onclick="setBaseMap('reliefMapa')" class="custom-button-fit">
            <i class="fa-solid fa-map top-icon fa-xl"></i><br>
            <span class="button-text-fit">Reli√©f mapa</span>
            <img src="https://www.meteopocasie.sk/meteoradar/relief.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
    </div>
    <div class="button-container-fit">
        <button onclick="setBaseMap('OpenStreetMap')" class="custom-button-fit">
            <i class="fa-solid fa-map top-icon fa-xl"></i><br>
            <span class="button-text-fit">OSM mapa</span>
            <img src="https://www.meteopocasie.sk/pocasie/predpoved/map_forecast/osm.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
    </div>
        <div class="button-container-fit">
        <button onclick="setBaseMap('BielaMapa')" class="custom-button-fit">
            <i class="fa-solid fa-map top-icon fa-xl"></i><br>
            <span class="button-text-fit">Biela mapa</span>
            <img src="https://www.meteopocasie.sk/pocasie/predpoved/map_forecast/white.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
    </div>
        <div class="button-container-fit">
        <button onclick="setBaseMap('CiernaMapa')" class="custom-button-fit">
            <i class="fa-solid fa-map top-icon fa-xl"></i><br>
            <span class="button-text-fit">Satelitn√° (2. verzia)</span>
            <img src="https://www.meteopocasie.sk/pocasie/predpoved/map_forecast/sat.png" alt="Additional icon" class="bottom-icon-fit">
        </button>
    </div>
    
<!-- Modal pre hl√°senie -->
<div id="report-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close-button" id="close-report-modal">&times;</span>
    <iframe src="https://www.meteopocasie.sk/meteoradar/wxmap/index.html"
            frameborder="0" style="width: 100%; height: 100%; border: none;"></iframe>
  </div>
</div>



<style type="text/css" media="all">
  #play-button {
    z-index: 1001;
  }
  
  
  .layer-toggle-btn {
  padding: 6px 12px;
  background-color: #004080;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  transition: background-color 0.3s;
}

.layer-toggle-btn.active {
  background-color: #00aaff; /* Akt√≠vny stav */
}




</style>



</section>
<!-- html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const textElement = document.getElementById('live-text');
const texts = ['NA≈ΩIVO', 'LIVE'];
let index = 0;
let intervalId = null;

// Spust√≠ anim√°ciu textu
function startTextAnimation() {
  if (intervalId) return; // u≈æ be≈æ√≠

  textElement.classList.remove('hidden');
  index = 0;
  textElement.textContent = texts[index];

  intervalId = setInterval(() => {
    textElement.classList.add('fade-out');
    setTimeout(() => {
      index = (index + 1) % texts.length;
      textElement.textContent = texts[index];
      textElement.classList.remove('fade-out');
    }, 300);
  }, 5000);
}

// Zastav√≠ anim√°ciu a skryje text
function stopTextAnimation() {
  if (intervalId) {
    clearInterval(intervalId);
    intervalId = null;
  }
  textElement.classList.add('hidden');
}



function back() {
  stop(); // ak m√°≈° definovan√© stop, nech sa animation zastav√≠
  showFrame(animationPosition - 1);
}

function next() {
  stop();
  showFrame(animationPosition + 1);
}


</script>

<style type="text/css" media="all">
  .hidden {
  display: none;
}

.fade-out {
  opacity: 0;
  transition: opacity 0.3s ease;
}
 
</style>

       <!-- <label><input type="checkbox" id="weatherLayerToggle" onchange="toggleWeatherLayer()"> Zobrazi≈• aktu√°lne poƒçasie</label> -->
        <script>
          function togglePanel() {
            const panel = document.getElementById('layerPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        function exitButton() {
            const panel = document.getElementById('layerPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        const checkbox = document.getElementById('toggle-reports');

checkbox.addEventListener('change', () => {
  if (checkbox.checked) {
    loadReports();
  } else {
    // Ak chce≈°, m√¥≈æe≈° hneƒè zmaza≈• vrstvu, keƒè vypne≈° hl√°senia:
    if (layer) {
      map.removeLayer(layer);
      layer = null;
    }
  }
});

function stop() {
    if (animationTimer) {
      clearInterval(animationTimer);
      animationTimer = null;
      updatePlayPauseButton();
      return true;
    }
    return false;
  }

  function play() {
    if (animationTimer) return;
    animationTimer = setInterval(() => {
      showFrame(animationPosition + 1);
    }, 1000);
    updatePlayPauseButton();
  }

  function playStop() {
    if (animationTimer) {
      stop();
    } else {
      play();
    }
  }

// Event listener pre posuvn√≠k ƒçasu
timeSlider.addEventListener('input', function() {
stop();
showFrame(parseInt(this.value));
});




  function updatePlayPauseButton() {
  const playButton = document.getElementById("play-button");
  if (!playButton) {
    console.warn("Tlaƒçidlo play-button sa nena≈°lo.");
    return;
  }

  const icon = playButton.querySelector("i");
  if (!icon) {
    console.warn("Ikona <i> sa nena≈°la vo vn√∫tri play-button.");
    return;
  }

icon.classList.remove("fa-play", "fa-pause");
icon.className = animationTimer ? "fa-pause" : "fa-play";



  console.log("Aktu√°lna trieda:", icon.className);
  console.log("Animation running:", !!animationTimer);
console.log("Icon before:", icon.className);

}

   


function createControlPanel() {
  const container = document.createElement('div');
  container.className = 'button-group-wrapper';
  container.style.position = 'absolute';
  container.style.left = '50%';
  container.style.transform = 'translateX(-50%)';
  container.style.zIndex = '1000';

  container.innerHTML = `
    <div class="button-group">
      <button class="control-button" id="backward-button" aria-label="Prehratie sp√§≈•" onclick="back()">
        <i class="fas fa-backward"></i>
      </button>
      <button class="control-button" id="play-button" aria-label="Prehra≈•/Pozastavi≈•" onclick="playStop()">
        <i class="fas fa-play"></i>
      </button>
      <button class="control-button" id="forward-button" aria-label="Prehratie dopredu" onclick="next()">
        <i class="fas fa-forward"></i>
      </button>
    </div>

    <div class="button-group">
      <button class="control-button" id="refresh-button" aria-label="Obnovi≈•" onclick="manualUpdate()">
        <i class="fas fa-rotate"></i>
      </button>
          <div class="button-group">
      <button class="control-buttons" id="show-button" aria-label="zobrazi≈• slider" onclick="showSlider()">
        <i class="fas fa-sliders"></i>
      </button>
      <button class="control-button" id="cancel-button" aria-label="Zru≈°i≈•" onclick="exitButton()">
        <i class="fas fa-xmark"></i>
      </button>
    </div>
  `;
  
  

  // Pridaj do hlavn√©ho kontajnera
  document.getElementById('control-panel-container').appendChild(container);

  // Pridaj event listenery na nov√© tlaƒçidl√°
  document.getElementById("backward-button").addEventListener("click", () => {
    console.log("Kliknut√©: sp√§≈•");
    back(); // Ak m√°≈° definovan√∫ funkciu `back`
  });

  document.getElementById("play-button").addEventListener("click", () => {
    togglePlayerStop(); // Funguje s tvoj√≠m JS
  });

  document.getElementById("forward-button").addEventListener("click", () => {
    console.log("Kliknut√©: dopredu");
    next(); // Ak m√°≈° definovan√∫ funkciu `next`
  });

  document.getElementById("refresh-button").addEventListener("click", () => {
    console.log("Kliknut√©: obnovi≈•");
    manualUpdate(); // Ak m√°≈° definovan√∫ funkciu `manualUpdate`
  });

  document.getElementById("cancel-button").addEventListener("click", () => {
    console.log("Kliknut√©: zru≈°i≈•");
    exitButton(); // Ak m√°≈° definovan√∫ funkciu `exitButton`
  });
  
document.getElementById("cancel-button").addEventListener("click", () => {
  console.log("Kliknut√©: zru≈°i≈•");
  exitButton(); // Ak m√°≈° definovan√∫ funkciu `exitButton`
  
});

document.getElementById('backward-button').addEventListener('click', () => {
  stop();
  showFrame(animationPosition - 1); // ü†î sp√§≈• m√° by≈• -1
});

document.getElementById('forward-button').addEventListener('click', () => {
  stop();
  showFrame(animationPosition + 1); // ü†ñ dopredu +1
});



}


        // === Screenshot Logic ===
let currentImageDataUrl = "";
let screenshotTimestamp = ""; // Variable to store the timestamp for the filename

/**
* Captures the map and timestamp, then displays it in a popup.
*/

function captureAndShare() {
  const loadingOverlay = document.getElementById('loading-overlay');
  // Zobraz spinner a zaƒçiatoƒçn√Ω text
loadingOverlay.style.display = 'flex';
const loadingText = document.getElementById('loading-text');
if (loadingText) loadingText.innerText = 'Pripravujem obr√°zok...';

// Zme≈à text po 1.5 sekunde
setTimeout(() => {
  if (loadingText) loadingText.innerText = 'U≈æ to bude...';
}, 1500);

// Zme≈à text po 3 sekund√°ch
setTimeout(() => {
  if (loadingText) loadingText.innerText = 'U≈æ ƒçoskoro obr√°zok pripraven√Ω';
}, 3000);




  // ‚è±Ô∏è Vygeneruj timestamp pre n√°zov
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  screenshotTimestamp = `${year}${month}${day}_${hours}${minutes}${seconds}`;

  // ‚õîÔ∏è Skry≈• UI prvky
  const liveBadge = document.querySelector('.live-badge');
  const reportButton = document.querySelector('.button-wrapper');
  const toggleWrapper = document.querySelector('.weather-toggle-wrapper');
  const zoomControl = document.querySelector('.corner-button-group');
  const textDiv = document.querySelector('.text-content-map');
  const attr = document.querySelector('.leaflet-control-attribution');
  const timeDisplay = document.getElementById('timestamp');
  const buttonWrapp = document.querySelector('.button-wrappers');
  const logoImage = document.getElementById('logo-container');

  if (liveBadge) liveBadge.style.display = 'none';
  if (reportButton) reportButton.style.display = 'none';
  if (toggleWrapper) toggleWrapper.style.display = 'none';
  if (zoomControl) zoomControl.style.display = 'none';
  if (textDiv) textDiv.style.display = 'block';
  if (attr) attr.style.display = 'none';
  if (timeDisplay) timeDisplay.style.bottom = '11%';
  if (buttonWrapp) buttonWrapp.style.display = 'none';
  if (logoImage) logoImage.style.marginBottom = '-30%';

  // üîÑ Poƒçkaj 1 frame na DOM update (100 ms staƒç√≠)
  setTimeout(() => {
    // üï≥Ô∏è Doƒçasne skry spinner (aby nebol v screenshote)
    loadingOverlay.style.visibility = 'hidden';

    // üì∏ Zachy≈• sn√≠mku
    html2canvas(document.getElementById('capture-area'), {
      useCORS: true,
      allowTaint: false,
      backgroundColor: null
    }).then(canvas => {
      currentImageDataUrl = canvas.toDataURL('image/png');

      // ‚úÖ Zobraz obr√°zok a popup
      document.getElementById('screenshot-img').src = currentImageDataUrl;
      document.getElementById('screenshot-popup').style.display = 'flex';
      
      

      // üîÅ Obnov UI prvky
      if (liveBadge) liveBadge.style.display = '';
      if (reportButton) reportButton.style.display = '';
      if (toggleWrapper) toggleWrapper.style.display = '';
      if (zoomControl) zoomControl.style.display = 'block';
      if (textDiv) textDiv.style.display = 'none';
      if (attr) attr.style.display = 'block';
      if (timeDisplay) timeDisplay.style.bottom = '50px';
      if (buttonWrapp) buttonWrapp.style.display = 'block';
      if (logoImage) logoImage.style.marginBottom = 'auto';

      // ‚úÖ Znova zobraz spinner a hneƒè ho skry
      loadingOverlay.style.visibility = 'visible';
      loadingOverlay.style.display = 'none';
    }).catch(err => {
      console.error("Error capturing map:", err);
      showMessage("Nepodarilo sa vytvori≈• obr√°zok. Sk√∫ste znova.");

      // üîÅ Obnov UI aj pri chybe
      if (liveBadge) liveBadge.style.display = 'block';
      if (reportButton) reportButton.style.display = 'block';
      if (toggleWrapper) toggleWrapper.style.display = 'block';
      if (zoomControl) zoomControl.style.display = 'block';
      if (textDiv) textDiv.style.display = 'block';
      if (attr) attr.style.display = 'block';
      if (timeDisplay) timeDisplay.style.bottom = '50px';
      if (buttonWrapp) buttonWrapp.style.display = 'block';
      if (logoImage) logoImage.style.marginBottom = 'auto';
      loadingOverlay.style.display = 'none';
    });
  }, 5000); // ‚ö†Ô∏è Toto neme≈à! Len kr√°tky delay pre DOM aktualiz√°ciu
}


/**
* Saves the captured image to the user's device.
*/
function saveImage() {
if (currentImageDataUrl) {
const a = document.createElement('a');
// Use the generated timestamp in the filename
a.href = currentImageDataUrl;
a.download = `meteoradarmeteopocasie_${screenshotTimestamp}.png`; // Dynamic filename
document.body.appendChild(a); // Append to body to make it clickable
a.click();
document.body.removeChild(a); // Clean up
} else {
showMessage("≈Ωiadny obr√°zok na ulo≈æenie.");
}
}

/**
* Shares the captured image using the Web Share API.
*/
function shareImage() {
if (navigator.share && currentImageDataUrl) {
fetch(currentImageDataUrl)
.then(res => res.blob())
.then(blob => {
const file = new File([blob], `meteoradarmeteopocasie_${screenshotTimestamp}.png`, { type: blob.type }); // Dynamic filename
navigator.share({
files: [file],
title: "Radarov√° mapa",
text: "Aktu√°lna radarov√° mapa zr√°≈æok."
}).catch(err => {
if (err.name !== 'AbortError') { // Ignore user cancellation
console.error("Sharing failed:", err);
showMessage("Zdieƒæanie zlyhalo. V√°≈° prehliadaƒç alebo zariadenie nepodporuje zdieƒæanie s√∫borov.");
}
});
}).catch(err => {
console.error("Error preparing image for sharing:", err);
showMessage("Nepodarilo sa pripravi≈• obr√°zok na zdieƒæanie.");
});
} else {
showMessage("Zdieƒæanie nie je podporovan√© v tomto prehliadaƒçi alebo zariaden√≠.");
}
}

/**
* Closes the screenshot preview popup.
*/
function closePopup() {
document.getElementById('screenshot-popup').style.display = 'none';
currentImageDataUrl = ""; // Clear image data
screenshotTimestamp = ""; // Clear the timestamp
}

// === Custom Message Box Functions ===
/**
* Displays a custom message in a modal popup.
* @param {string} message - The message to display.
*/
function showMessage(message) {
document.getElementById('message-content').innerText = message;
document.getElementById('message-popup').style.display = 'flex';
}

/**
* Closes the custom message popup.
*/
function closeMessagePopup() {
document.getElementById('message-popup').style.display = 'none';
}

// Keyboard navigation for radar frames
document.onkeydown = function(e) {
if (e.keyCode === 37) stop(), showFrame(animationPosition - 1); // Left arrow
if (e.keyCode === 39) stop(), showFrame(animationPosition + 1); // Right arrow
};


// Zavolaj po naƒç√≠tan√≠ DOM alebo mapy
document.addEventListener('DOMContentLoaded', createControlPanel);

function createLiveBadge() {
  const liveBadge = document.createElement('div');
  liveBadge.className = 'live-badge';
  liveBadge.style.position = 'absolute';
  liveBadge.style.top = '15px';
  liveBadge.style.left = '50%';
  liveBadge.style.transform = 'translateX(-50%)';
  liveBadge.style.zIndex = '1000';

  liveBadge.innerHTML = `
    <div class="dot-wrapper">
      <div class="dot1"></div>
      <div class="dot2"></div>
    
    </div>
    <span id="live-text">NA≈ΩIVO</span>
  `;

  document.getElementById('mapid').appendChild(liveBadge);
}

function openReportModal() {
  const modal = document.getElementById("report-modal");
  if (modal) modal.style.display = "flex";
}

function closeReportModal() {
  const modal = document.getElementById("report-modal");
  if (modal) modal.style.display = "none";
}

function setupModalCloseButton() {
  const closeBtn = document.getElementById("close-report-modal");
  if (closeBtn) {
    closeBtn.addEventListener("click", closeReportModal);
  } else {
    console.error("‚ùå close-report-modal not found");
  }
}

function openReportModal() {
  window.location.href = "https://www.meteopocasie.sk/meteoreporty/";
}


function createReportButton() {
  const buttonWrapper = document.createElement('div');
  buttonWrapper.className = 'button-wrapper';
  buttonWrapper.style.position = 'absolute';
  buttonWrapper.style.top = '220px';        // üîΩ Stred v√Ω≈°ky (prisp√¥sob podƒæa potreby)
  buttonWrapper.style.right = '20px';     // ‚¨Ö Vpravo s miernym odsaden√≠m
  buttonWrapper.style.transform = 'translateY(-50%)'; // vertik√°lne vycentrovanie
  buttonWrapper.style.borderRadius = '50%';
  buttonWrapper.style.zIndex = '1000';

  buttonWrapper.innerHTML = `
    <button class="plus-button" onclick="openReportModal()" style="border-radius: 50px;">
      <i class="fas fa-plus"></i>
    </button>
    <div class="label">Nov√©</div>
  `;

  document.getElementById('control-panel-container').appendChild(buttonWrapper);
  document.getElementById('mapid').appendChild(buttonWrapper); 
}



let weatherLayerVisible = false;


function setupWeatherToggleButton() {
  const btn = document.getElementById('weatherLayerToggle');

  btn.addEventListener('click', () => {
    weatherLayerVisible = !weatherLayerVisible;
    btn.classList.toggle('active', weatherLayerVisible);

    if (weatherLayerVisible) {
      loadWeatherLayer(); // naƒç√≠taj a zobraz vrstvu
    } else {
      if (weatherLayerGroup) {
        map.removeLayer(weatherLayerGroup);
        weatherLayerGroup = null;
      }
    }
  });
}

let rainviewerTileBaseUrl = 'https://tilecache.rainviewer.com';

async function checkRainviewerStatus() {
  try {
    const res = await fetch('https://api.rainviewer.com/public/weather-maps.json');
    const data = await res.json();

    const nowcast = data.radar?.nowcast;
    const nowUnix = Math.floor(Date.now() / 1000); // aktu√°lny ƒças v sekund√°ch

    if (!nowcast || nowcast.length === 0) {
      showRainviewerError("‚ö†Ô∏è V√Ωpadok slu≈æby RainViewer (ch√Ωbaj√∫ nowcast √∫daje).");
      return;
    }

    const lastNowcast = nowcast[nowcast.length - 1];
    const timeDiff = nowUnix - lastNowcast.time;

    // Overenie star≈°√≠ch √∫dajov ako 30 min√∫t
    if (timeDiff > 1800) {
      showRainviewerError("‚ö†Ô∏è V√Ωpadok slu≈æby RainViewer ‚Äì √∫daje s√∫ star≈°ie ako 30 min√∫t. Na odstr√°nen√≠ chyby pracuj√∫.");
      return;
    }

    // Skontroluj, ƒçi tile existuje cez HEAD
    const tilePath = lastNowcast.path;
    const testTileUrl = `${rainviewerTileBaseUrl}${tilePath}/512/5/18/12/0/1_0.png`;

    const headRes = await fetch(testTileUrl, { method: 'HEAD' });

    if (!headRes.ok || headRes.status >= 400) {
      showRainviewerError("‚ö†Ô∏è V√Ωpadok slu≈æby RainViewer ‚Äì radarov√Ω tile nie je dostupn√Ω.");
    } else {
      hideRainviewerError();
    }

  } catch (err) {
    showRainviewerError("‚ùå Chyba pri kontrole RainViewer: " + err.message);
  }
}

function showRainviewerError(msg) {
  const el = document.getElementById('rainviewer-alert');
  if (el) {
    el.textContent = msg;
    el.style.display = 'block';
  }
}

function hideRainviewerError() {
  const el = document.getElementById('rainviewer-alert');
  if (el) el.style.display = 'none';
}

// Spusti ihneƒè a opakuj ka≈æd√Ωch 30 sek√∫nd
checkRainviewerStatus();
setInterval(checkRainviewerStatus, 30000);



function createTextContent() {
  const textDiv = document.createElement('div');
  textDiv.className = 'text-content-map';
    textDiv.style.width = 'auto';
    textDiv.style.height = 'auto';
    textDiv.style.padding = '8px';
    textDiv.style.fontFamily = 'Poppins';
    textDiv.style.background = '#3b9af8';
    textDiv.style.color = '#fff';
    textDiv.style.fontWeight = '700';
    textDiv.style.zIndex = '1000';
    textDiv.style.position = 'absolute';
    textDiv.style.top = '10%';
    textDiv.style.left = '50%';
    textDiv.style.transform = 'translateX(-50%)';
    textDiv.style.borderRadius = '25px';
    textDiv.style.fontSize = '16px';
    textDiv.style.display = 'none';
    
    
    textDiv.innerHTML = `<div class="text-content">
    <i class="fas fa-satellite-dish "></i> <span class="span-text"> METEORADAR</span>
    </div>`;
    
    
    document.getElementById('control-panel-container').appendChild(textDiv);
  document.getElementById('mapid').appendChild(textDiv); 
}



document.addEventListener("DOMContentLoaded", () => {
  createControlPanel();
  createLiveBadge();
  createZoomControls();
  createReportButton();
  setupWeatherToggleButton();
  setupModalCloseButton(); // mus√≠ √≠s≈• A≈Ω po vytvoren√≠ report-button + modal mus√≠ by≈• v HTML!
  createTextContent();
});
 


function createZoomControls() {
  const zoomControl = document.createElement('div');
  zoomControl.className = 'corner-button-group';
  zoomControl.style.position = 'absolute';
  zoomControl.style.top = '15px';
  zoomControl.style.left = '15px';
  zoomControl.style.zIndex = '1000';
  zoomControl.style.display = 'flex';
  zoomControl.style.flexDirection = 'column';

  zoomControl.innerHTML = `
    <div style="display: flex; flex-direction: column; overflow: hidden; width: 40px;">
      <button class="control-button" aria-label="Zv√§ƒç≈°i≈•" style="width:40px;height:40px;border:none;border-radius:25px 25px 0 0;padding:0;margin:0; border-bottom: 1px solid #FFFFFF38;">
        <i class="fas fa-plus"></i>
      </button>
      <button class="control-button" aria-label="Zmen≈°i≈•" style="width:40px;height:40px;border:none;border-radius:0 0 25px 25px;padding:0;margin:0;">
        <i class="fas fa-minus"></i>
      </button>
    </div>
  `;

  // Pripojenie do DOM
  document.getElementById('mapid').appendChild(zoomControl);

  // N√°jdi tlaƒçidl√° v r√°mci zoomControlu
  const zoomInBtn = zoomControl.querySelector('button[aria-label="Zv√§ƒç≈°i≈•"]');
  const zoomOutBtn = zoomControl.querySelector('button[aria-label="Zmen≈°i≈•"]');

  // Event listenery
  if (zoomInBtn && zoomOutBtn) {
    zoomInBtn.addEventListener("click", () => map.zoomIn());
    zoomOutBtn.addEventListener("click", () => map.zoomOut());
  } else {
    console.warn("‚ùó Zoom tlaƒçidl√° sa nena≈°li.");
  }
}


        
        
        // Ensure the panel is initially hidden
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('layerPanel').style.display = 'none';
        });
        
        
        function setKind(boxNumber, selectedBox) {
            const boxes = document.querySelectorAll('.box');
            boxes.forEach(box => {
                box.classList.remove('selected');
                box.style.backgroundColor = '#002043';
                box.classList.remove('rounded');
            });

            selectedBox.classList.add('selected');
            selectedBox.classList.add('rounded');
            selectedBox.style.backgroundColor = '#3b9af8';

            switch (boxNumber) {
                case 2:
                    console.log("Druh√Ω box kliknut√Ω - naƒç√≠tam druh√Ω k√≥d.");
                    break;
                case 3:
                    console.log("Tret√≠ box kliknut√Ω - naƒç√≠tam tret√≠ k√≥d.");
                    break;
                default:
                    console.log("Nezn√°my box.");
            }
        }
        


        
        
        </script>
        <br>
        <div class="separator" style="display: none;">
          
        </div>
<br> <br>
    <!-- Play/Pause button -->


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
            user-select: none; /* Zamedzenie v√Ωberu textu */
            -webkit-user-select: none; /* Pre WebKit prehliadaƒçe */
        }

        .container {
            display: flex;
            flex-direction: row;
            background-color: #002043; /* Pozadie pre obalov√Ω element */
            padding: 10px; /* Pridanie paddingu na okolo boxov */
            border-radius: 20px; /* Zaoblenie rohov pre cel√∫ oblas≈• */
            border: 1px solid #fff;
            width: 240px;
        }
        
            /* Odstr√°nenie predvolen√©ho pozadia a tie≈àa Leafletu */
    .leaflet-popup-content-wrapper,
    .leaflet-popup-tip {
      background: transparent;
      box-shadow: none;
    }

    /* Hlavn√Ω kontajner n√°≈°ho modern√©ho popupu */
    .modern-popup .leaflet-popup-content-wrapper {
      background: rgba(0, 32, 67, 0.85); /* Tmavomodr√° #002043 s 85% priehƒæadnos≈•ou */
      border-radius: 25px;
      color: #ffffff;
      border: 1px solid #3b9af8;
      /* Efekt rozmazan√©ho pozadia (prehƒæadnos≈•) */
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }

    /* ≈†√≠pka popupu, aby ladila s dizajnom */
    .modern-popup .leaflet-popup-tip-container {
      width: 40px;
      height: 20px;
    }
    .modern-popup .leaflet-popup-tip {
       background: #3b9af8; /* Svetlomodr√° farba pre ≈°√≠pku */
       border: none;
    }

    /* Vn√∫tro popupu - odstr√°nime predvolen√© odsadenie */
    .leaflet-popup-content {
      margin: 0;
      padding: 0;
      width: 250px !important; /* Pevn√° ≈°√≠rka pre lep≈°√≠ vzhƒæad */
    }

    /* Nadpis javu (header) */
    .wx-popup-header {
      background: #3b9af8;
      color: #ffffff;
      padding: 10px 20px;
      border-radius: 25px 25px 0 0; /* Zaoblenie len horn√Ωch rohov */
      font-weight: 600;
      font-size: 16px;
      font-family: 'Poppins', sans-serif;
      text-align: center;
    }

    /* Telo popupu (obsah) */
    .wx-popup-body {
      padding: 15px;
    }
    
    .wx-popup-time {
      font-size: 15px;
      opacity: 0.8;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
      margin-bottom: 10px;
      text-align: left;
    }

    .wx-popup-desc {
      font-size: 14px;
      line-height: 1.5;
      font-family: 'Poppins';
      margin-bottom: 10px;
      text-align: center;
    }
    
    /* Gal√©ria s obr√°zkami */
    .wx-popup-gallery {
      display: flex;
      flex-direction: column;
      gap: 10px; /* Medzera medzi obr√°zkami */
    }

    .wx-popup-image {
      width: 100%;
      height: auto;
      border-radius: 15px;
      display: block;
    }
    
        /* Odstr√°nenie predvolen√©ho pozadia a tie≈àa Leafletu */
    .leaflet-popup-content-wrapper,
    .leaflet-popup-tip {
      background: transparent;
      box-shadow: none;
    }

    /* Hlavn√Ω kontajner n√°≈°ho modern√©ho popupu */
    .modern-popup .leaflet-popup-content-wrapper {
      background: rgba(0, 32, 67, 0.85); /* Tmavomodr√° #002043 s 85% priehƒæadnos≈•ou */
      border-radius: 25px;
      color: #ffffff;
      border: 1px solid #3b9af8;
      /* Efekt rozmazan√©ho pozadia (prehƒæadnos≈•) */
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }

    /* ≈†√≠pka popupu, aby ladila s dizajnom */
    .modern-popup .leaflet-popup-tip-container {
      width: 40px;
      height: 20px;
    }
    .modern-popup .leaflet-popup-tip {
       background: #3b9af8; /* Svetlomodr√° farba pre ≈°√≠pku */
       border: none;
    }

    /* Vn√∫tro popupu - odstr√°nime predvolen√© odsadenie */
    .leaflet-popup-content {
      margin: 0;
      padding: 0;
      width: 250px !important; /* Pevn√° ≈°√≠rka pre lep≈°√≠ vzhƒæad */
    }
        
        
        @media only screen and (max-width: 730px){
                  .container {
            display: flex;
            flex-direction: row;
            background-color: #002043; /* Pozadie pre obalov√Ω element */
            padding: 10px; /* Pridanie paddingu na okolo boxov */
            border-radius: 20px; /* Zaoblenie rohov pre cel√∫ oblas≈• */
            border: 1px solid #fff;
            width: auto;
        }
        }

        .box {
            background-color: #002043; /* P√¥vodn√° farba */
            color: white;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 0 5px; /* Pridanie medzery medzi boxmi */
            pointer-events: auto; /* Umo≈ænenie interakcie s boxmi */
            border-radius: 13px; /* Zaoblen√© rohy pre v≈°etky boxy */
        }

        .box:hover {
            background-color: #3b9af8; /* Farba pri hover */
            transform: scale(1.6); /* Zv√§ƒç≈°enie boxu */
            transition: background-color 0.3s, transform 0.3s; /* Pridajte prechod aj pre transform√°ciu */
        }

        .selected {
            background-color: #3b9af8; /* Zvolen√° farba */
            transform: scale(1.6); /* Zv√§ƒç≈°enie boxu */
            transition: background-color 0.3s, transform 0.3s; /* Pridajte prechod aj pre transform√°ciu */
        }
        
        .rain-label {
display: inline-block;
min-width: 50px;
padding: 6px 10px;
border-radius: 16px;
font-weight: 600;
font-size: 14px;
text-align: center;
white-space: nowrap;
box-shadow: 0 0 5px rgba(0,0,0,0.3);
color: black;
font-family: 'Poppins', sans-serif !important;
z-index: 1001;
}


.share-btn {
cursor: pointer;
font-size: 20px;
color: white; /* White icon color */
background-color: #3c9afa; /* Background color */
padding: 5px 15px; /* Increased padding for better rounding */
border-radius: 50%; /* 25px rounded corners */
transition: background-color 0.3s ease;
display: flex; /* For centering the icon and text */
align-items: center;
justify-content: center;
height: 40px; /* To make the button consistent with others */
gap: 8px; /* Space between icon and text */
font-family: 'Poppins', sans-serif; /* Poppins font */
margin-left: 0%;
}

.share-btn:hover {
background-color: #307ac2; /* Darker shade on hover */
}

/* New container for map and elements to be captured */
#capture-area {
position: absolute;
top: 50px; /* Below the controls (ul) */
bottom: 0;
left: 0;
right: 0;
overflow: hidden; /* Ensures content stays within bounds */
display: flex;
flex-direction: column;
background-color: #fff; /* For certainty, so the background is not transparent */
}


/* === Website text at top right === */
#website-info {
position: absolute;
top: 10px; /* Distance from the top */
right: 10px; /* Distance from the right */
color: white; /* White text color */
font-family: 'Poppins', sans-serif;
font-size: 16px;
text-shadow: 1px 1px 2px black; /* Black shadow */
z-index: 10; /* Above the map */
}

/* === Container for Meteoradar and Timestamp at bottom center === */
#bottom-center-elements {
position: absolute;
bottom: 10px;
left: 50%;
transform: translateX(-50%);
display: flex;
gap: 10px; /* Space between Meteoradar and Timestamp */
z-index: 1001; /* Ensure it's above the map */
}

/* === Meteoradar text box - now inside bottom-center-elements === */
#meteoradar-info {
background-color: #3c9afa; /* Same as share button background */
color: white;
font-family: 'Poppins', sans-serif;
padding: 6px 12px; /* Reduced vertical padding */
border-radius: 25px; /* Rounded corners */
font-size: 14px;
box-shadow: 0 2px 5px rgba(0,0,0,0.2);
white-space: nowrap; /* Prevent text wrapping */
display: flex;
align-items: center;
justify-content: center;
gap: 5px; /* Space between icon and text */
}


/* === Screenshot Popup === */
#screenshot-popup {
position: fixed;
top: 0; left: 0; right: 0; bottom: 0;
background-color: rgba(0,0,0,0.8);
z-index: 9999;
display: none;
align-items: center;
justify-content: center;
flex-direction: column;
padding: 20px;
}

#screenshot-popup img {
max-width: 90vw;
max-height: 70vh;
border: 4px solid white;
border-radius: 10px;
margin-bottom: 20px;
object-fit: contain; /* Ensures image fits without cropping */
}

#screenshot-popup button {
margin: 5px;
padding: 10px 20px;
font-size: 16px;
border: none;
border-radius: 25px; /* 25px rounded corners */
cursor: pointer;
box-shadow: 0 2px 5px rgba(0,0,0,0.2);
transition: background-color 0.3s ease, transform 0.2s ease;
font-family: 'Poppins', sans-serif; /* Poppins font */
}

#screenshot-popup button:hover {
transform: translateY(-2px);
}

.btn-save { background-color: #28a745; color: white; }
.btn-save:hover { background-color: #218838; }
.btn-share { background-color: #007bff; color: white;border-radius: 50%; }
.btn-share:hover { background-color: #0056b3; }
.btn-close { background-color: #6c757d; color: white; }
.btn-close:hover { background-color: #5a6268; }

/* === Custom Message Popup === */
#message-popup {
position: fixed;
top: 0; left: 0; right: 0; bottom: 0;
background-color: rgba(0,0,0,0.8);
z-index: 10000; /* Higher than screenshot popup */
display: none;
align-items: center;
justify-content: center;
flex-direction: column;
padding: 20px;
}
#message-popup div {
background-color: white;
padding: 30px;
border-radius: 10px;
text-align: center;
font-size: 18px;
color: #333;
box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}
#message-popup button {
margin-top: 15px;
padding: 10px 25px;
font-size: 16px;
border: none;
border-radius: 25px; /* 25px rounded corners */
cursor: pointer;
background-color: #007bff;
color: white;
box-shadow: 0 2px 5px rgba(0,0,0,0.2);
transition: background-color 0.3s ease, transform 0.2s ease;
font-family: 'Poppins', sans-serif; /* Poppins font */
}
#message-popup button:hover {
background-color: #0056b3;
transform: translateY(-2px);
}

/* === Loading Overlay === */
#loading-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background-color: rgba(0, 0, 0, 0.7);
color: white;
display: none; /* Hidden by default */
align-items: center;
justify-content: center;
flex-direction: column;
font-size: 24px;
z-index: 10001; /* Highest z-index */
}
#loading-overlay .spinner {
border: 4px solid rgba(255, 255, 255, 0.3);
border-top: 4px solid #fff;
border-radius: 50%;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
margin-bottom: 15px;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}


    </style>



    </div>
</div>
    

    
    
    
    



    <!-- Legend -->
    <div class="legend" id="legend">
        <img src="https://www.meteopocasie.sk/lightning/legend.png" class="image" alt="Legend">
    </div>



    <!-- Map container -->

    <style type="text/css" media="all">
     .share-btn {
       position: absolute; z-index: 1001; top: 10%; left: 1%; display: ; 
     }
     
     @media only screen and (max-width: 730px){
      .share-btn {
        position: absolute; z-index: 1001; top: 20%; left: 3%; display: ;
      }
     }
    </style>
      <div class="share-btn" onclick="captureAndShare()" title="Zdieƒæa≈•" style="border-radius: 90%;">
<i class="fa-solid fa-share" style="font-size: 19px;"></i> <!-- Changed icon here -->
</div>

<div id="capture-area" style="position: absolute; top: 0;">
  <div id="rainviewer-alert" style="
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 65, 65, 0.95);
  color: white;
  padding: 12px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  font-family: Arial, sans-serif;
  font-size: 16px;
  z-index: 9999;
  display: none;
">
  ‚ö†Ô∏è Radarov√° vrstva je moment√°lne nedostupn√° (v√Ωpadok slu≈æby RainViewer).
</div>
      <div id="mapid">
        
        <div class="content-wrapper" id="legendPanel">
          <center>
  <div class="button-wrappers">
    <button id="toggle-more-btn">
      <i class="fas fa-chevron-up" id="toggle-icon"></i>
      <span></span>
    </button>
  </div>
          </center>


  <div class="main-container">
    
    
    <!-- D√°≈æƒè - viditeƒæn√Ω predvolene -->
    <div class="legend-container" id="rain">
      <div class="gradient-bar rain-gradient">
          <div class="intensity-labels">
    <span>SLAB√â</span>
    <span>MIERNE</span>
    <span>SILN√â <i class="fas fa-exclamation-triangle"></i></span>
  </div>
 
        <i class="fas fa-cloud-showers-heavy legend-icon" style="background: transparent; margin-top: 2%;"></i>
      </div>
      
      <div class="description">
        <strong><i class="fas fa-cloud-showers-heavy"></i>D√°≈æƒè</strong>
      </div>
    </div>

    <!-- Ostatn√© legendy s√∫ skryt√© predvolene pomocou triedy 'extra-legend' -->
    <div class="legend-container extra-legend" id="snow">
      <div class="gradient-bar snow-gradient">
        <i class="fas fa-snowflake legend-icon" style="background: transparent; margin-top: 2%;"></i>
      </div>
      <div class="description">
        <strong><i class="fas fa-snowflake"></i>Sneh</strong>
      </div>
    </div>

    <div class="legend-container extra-legend" id="freezing-rain">
      <div class="gradient-bar freezing-rain-gradient">
        <i class="fas fa-icicles legend-icon" style="background: transparent; margin-top: 2%;"></i>
      </div>
      <div class="description">
        <strong><i class="fas fa-icicles"></i>Mrzn√∫ci d√°≈æƒè</strong>
      </div>
    </div>

    <div class="legend-container extra-legend" id="mixed-precip">
      <div class="gradient-bar mixed-precip-gradient">
        <i class="fas fa-cloud-meatball legend-icon" style="background: transparent; margin-top: 2%;"></i>
      </div>
      <div class="description">
        <strong><i class="fas fa-cloud-meatball"></i>Zmie≈°an√© zr√°≈æky</strong>
      </div>
    </div>

    <div class="legend-container extra-legend" id="cloudiness">
      <div class="gradient-bar cloudiness-gradient">
        <i class="fas fa-cloud legend-icon" style="background: transparent; margin-top: 2%;"></i>
      </div>
      <div class="description"> 
        <strong><i class="fas fa-cloud"></i>Oblaƒçnos≈•</strong>
      </div> 
    </div>

    <!-- Blesky - non-clickable, ale teraz je tie≈æ s√∫ƒças≈•ou extra-legend, tak≈æe sa zobraz√≠/skryje s ostatn√Ωmi -->
    <div class="static-legend-container extra-legend" id="lightning">
      <div class="gradient-bar lightning-gradient">
        <div class="black-square-icon" style="background: black; margin-top: 0%;"></div> <!-- Ikona ƒçierneho ≈°tvorca -->
        <span class="lightning-text">Blesky</span> <!-- Text "Blesky" priamo na gradientovom pruhu -->
      </div>
      <!-- Popis je teraz priamo na pruhu, tak≈æe tu nie je potrebn√Ω expandovateƒæn√Ω popis -->
    </div>
  </div>


</div> 
    <style>

    .content-wrapper {
        position: relative;
        width: 100%;
        max-width: 600px;
        z-index: 1000;
    }

    .main-container {
      width: 100%;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      border-radius: 10px;
      overflow: hidden;
    }

    .legend-container {
      width: 100%;
      cursor: pointer;
      user-select: none;
      position: relative;
    }

    /* New style for static (non-clickable) legends */
    .static-legend-container {
        width: 100%;
        user-select: none;
        position: relative;
    }

    .gradient-bar {
      height: 50px;
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .legend-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 20px; /* Zmen≈°en√° veƒækos≈• ikony */
        color: #000;
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.4);
    }

    /* Black square icon for lightning */
    .black-square-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        width: 20px; /* Veƒækos≈• ≈°tvorca */
        height: 20px; /* Veƒækos≈• ≈°tvorca */
        background-color: #000; /* ƒåierna farba */
        border-radius: 0; /* Odstr√°nen√© zaoblen√© rohy */
    }

    /* Text for lightning legend directly on bar */
    .lightning-text {
        position: absolute;
        left: 50px; /* Posunutie textu vedƒæa ikony */
        top: 50%;
        transform: translateY(-50%);
        font-size: 1rem;
        font-weight: 600;
        color: #333; /* Tmav≈°ia farba pre lep≈°iu ƒçitateƒænos≈• na svetlo≈°edom pozad√≠ */
    }

    /* Gradients */
    .rain-gradient {
      background: linear-gradient(
        to right,
        #3e8d5d 0%,
        #6ae04b 14.2%,
        #fafb55 28.5%,
        #efbd3f 42.8%,
        #e8662c 57.1%,
        #c63727 71.4%,
        #d041a9 85.7%,
        #eb55f5 100%
      );
    }

    .snow-gradient {
      background: linear-gradient(to right, #90bdbb 0%, #b6f5f9 33.3%, #80bdfe 66.6%, #4582fa 100%);
    }

    .freezing-rain-gradient {
      background: linear-gradient(to right, #cea6b3 0%, #ee94ae 50%, #e85479 100%);
    }

    .mixed-precip-gradient {
      background: linear-gradient(to right, #a290b7 0%, #b58ef6 50%, #9f7aec 100%);
    }

    .lightning-gradient { /* Nov√Ω gradient pre blesky - biele */
      background-color: #FFFFFF; /* Biela farba */
    }

    .cloudiness-gradient { /* Nov√Ω gradient pre oblaƒçnos≈• */
      background: linear-gradient(to right, #f3f3f3 0%, #c0c0c0 33.3%, #c0c0c0 100%);
    }

    /* Description styling */
    .description {
      display: none;
      background: #111;
      padding: 15px 20px;
      font-size: 1rem;
      line-height: 1.4;
      color: #ddd;
      border-left: 4px solid #fff; /* Default border color */
    }
    
    .description strong i {
        margin-right: 12px;
        width: 20px;
        text-align: center;
        font-size: 1.1rem; /* Zmen≈°en√° veƒækos≈• ikony v popise */
    }

    /* Unique border colors for descriptions */
    #rain .description { border-left-color: #6ae04b; }""
    #snow .description { border-left-color: #80bdfe; }
    #freezing-rain .description { border-left-color: #e85479; }
    #mixed-precip .description { border-left-color: #b58ef6; }
    #cloudiness .description { border-left-color: #c0c0c0; } /* Farba pre oblaƒçnos≈• */

    .active .description {
      display: block;
    }

    .legend-container + .legend-container {
      border-top: 1px solid #222;
    }

    .legend-container:hover {
      filter: brightness(1.1);
      transition: filter 0.2s;
    }

    /* By default, all extra legends are hidden */
    .extra-legend {
        display: none;
    }


    @media only screen and (max-width: 730px){

    }
    
    
.button-wrappers {
    position: absolute; /* Absol√∫tne pozicionovanie */
    top: -35px; /* Vertik√°lna poloha: -10px od vrchu nadraden√©ho elementu */
    right: 0; /* Horizont√°lna poloha: 0px od prav√©ho okraja nadraden√©ho elementu */
    z-index: -10; /* Vrstva z-indexu: Zabezpeƒçuje, ≈æe tlaƒçidlo je pod hlavnou legendou */
}

#toggle-more-btn {
    background-color: #002042; /* Farba pozadia tlaƒçidla */
    color: #fff; /* Farba textu/ikony */
    border: none; /* Bez r√°mƒçeka */
    padding: 10px; /* Vn√∫torn√© odsadenie tlaƒçidla (okolo ikony) */
    border-top-left-radius: 25px; /* Zaoblenie ƒæav√©ho horn√©ho rohu */
    border-top-right-radius: 25px; /* Zaoblenie prav√©ho horn√©ho rohu */
    border-bottom-left-radius: 0; /* Bez zaoblenia ƒæav√©ho doln√©ho rohu */
    border-bottom-right-radius: 0; /* Bez zaoblenia prav√©ho doln√©ho rohu */
    font-family: 'Poppins', sans-serif; /* Pou≈æit√Ω font */
    font-size: 0.95rem; /* Veƒækos≈• fontu (nem√° vplyv na ikonu, lebo je to SVG/font-awesome) */
    font-weight: 600; /* Hr√∫bka fontu */
    cursor: pointer; /* Zmena kurzora na ruku pri prechode my≈°ou */
    transition: all 0.2s ease-in-out; /* Plynul√° anim√°cia pri zmene stavu (napr. hover) */
    box-shadow: 0 2px 5px rgba(0,0,0,0.3); /* Tie≈à tlaƒçidla */
    display: flex; /* Pou≈æitie Flexboxu pre jednoduch√© centrovanie obsahu */
    align-items: center; /* Vertik√°lne centrovanie obsahu (ikony) v r√°mci tlaƒçidla */
    justify-content: center; /* Horizont√°lne centrovanie obsahu (ikony) v r√°mci tlaƒçidla */
    width: 45px; /* Pevn√° ≈°√≠rka tlaƒçidla */
    height: 45px; /* Pevn√° v√Ω≈°ka tlaƒçidla */
}

#toggle-more-btn:hover {
    filter: brightness(1.1); /* Zjasnenie tlaƒçidla pri prechode my≈°ou */
    transform: translateY(-1px); /* Mierne posunutie tlaƒçidla nahor pri prechode my≈°ou */
}

/* ≈†t√Ωly pre samotn√∫ ikonu v tlaƒçidle */
#toggle-icon { /* T√°to ikona je s√∫ƒças≈•ou #toggle-more-btn */
    /* Jej poz√≠cia je ovl√°dan√° Flexboxom z #toggle-more-btn */
}
    
    



    .intensity-labels {
        display: flex;
        justify-content: space-around;
        width: 100%;
        max-width: 600px; /* Zodpoved√° max-width .content-wrapper */
        margin-bottom: -1%; /* Medzera medzi popiskami a legendou */
        font-size: 0.85rem;
        font-weight: 600;
        color: #000;
        text-shadow: 0 0 3px rgba(0,0,0,0.5);
        padding: 0 20px; /* Odsadenie od okrajov */
        box-sizing: border-box;
        text-shadow: 0 0 1px #000000;
    }

    .intensity-labels span {
        flex: 1; /* Rovnomern√© rozlo≈æenie */
        text-align: center;
        display: flex; /* Pou≈æitie flexboxu pre zarovnanie ikony a textu */
        align-items: center; /* Vertik√°lne centrovanie */
        justify-content: center; /* Horizont√°lne centrovanie */
        gap: 5px; /* Medzera medzi textom a ikonou */
    }

    @media (max-width: 600px) {
      .gradient-bar {
        height: 45px;
      }
      body {
        padding: 30px 10px;
      }
      .button-wrappers {
        padding-left: 0px; /* Men≈°ie odsadenie pre mobiln√© zariadenia */
      }
      .intensity-labels {
        padding: 0 10px;
      }
    }
    
    
/* Zarovnanie panelu √∫plne dolu vpravo (nad attribution) */
#legendPanel {
    position: absolute;
    bottom: 0; /* mierne nad attribution */
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    transition: bottom 0.4s ease;
    max-width: 600px;
    width: 95%;
}

/* Akt√≠vny stav, keƒè je legenda vytiahnut√° do stredu */
#legendPanel.expanded {
    bottom: 50%; /* vysunie sa do stredu mapy */
    transform: translate(-50%, 50%);
}

/* Anim√°cia pos√∫vania */
#legendPanel,
#legendPanel .main-container,
#legendPanel .button-wrappers {
    transition: all 0.4s ease;
}

.leaflet-control-attribution {
  display: none;
}


/* Zabr√°ni overflow scrollu */
body, html {
    margin: 0;
    padding: 0;
    overflow: hidden; /* <== toto ƒçasto rie≈°i pos√∫vanie */
}



#timeSliderContainer {
  position: absolute;
  z-index: 1001;
}

#timeSlider {
  
}


/* Apply Poppins font to Leaflet popups */
.leaflet-popup-content {
font-family: 'Poppins', sans-serif !important;
}
.gust-label {
display: flex; /* Use flexbox for alignment */
flex-direction: row; /* Arrange items in a row */
align-items: center; /* Vertically center items */
justify-content: center; /* Horizontally center content */
min-width: 140px; /* Increased min-width to give more space */
padding: 6px 10px;
border-radius: 16px;
font-weight: 600;
font-size: 14px;
text-align: center;
white-space: nowrap;
box-shadow: 0 0 5px rgba(0,0,0,0.3);
font-family: 'Poppins', sans-serif !important;
box-sizing: border-box; /* Include padding in width */
transition: background-color 0.5s ease; /* Smooth transition for color change */
}
.wind-arrow {
display: inline-block;
width: 24px; /* Adjusted size for the new arrow */
height: 24px; /* Adjusted size for the new arrow */
margin-right: 8px; /* Increased space between arrow and text */
line-height: 1; /* Ensure arrow aligns well with text */
transition: transform 0.3s ease-out; /* Smooth rotation */
flex-shrink: 0; /* Prevent arrow from shrinking */
}
.wind-arrow svg {
width: 100%;
height: 100%;
fill: currentColor; /* Use the parent's text color for the SVG fill */
}
.wind-text {
font-size: 1.1em; /* Made larger */
font-weight: 900; /* Made even bolder */
margin-right: 8px; /* Increased space between direction text and speed */
}
  </style>
</head>
<body>



  <script>
    // Funkcionalita pre rozbaƒæovanie popisov (accordion)
    document.querySelectorAll('.legend-container').forEach(container => {
      container.addEventListener('click', () => {
        // Ak je to statick√° legenda, neumo≈æn√≠me kliknutie
        if (container.classList.contains('static-legend-container')) {
            return;
        }

        if (container.classList.contains('active')) {
          container.classList.remove('active');
        } else {
          // Zatvori≈• v≈°etky akt√≠vne legendy okrem tej, na ktor√∫ sa kliklo
          document.querySelectorAll('.legend-container').forEach(c => {
            c.classList.remove('active');
          });
          container.classList.add('active');
        }
      });
    });

    // Funkcionalita pre tlaƒçidlo "Zobrazi≈• viac/menej"
    const toggleButton = document.getElementById('toggle-more-btn');
    const extraLegends = document.querySelectorAll('.extra-legend');
    let areExtraVisible = false; // Predvolene s√∫ extra legendy skryt√©

    // Nastavenie poƒçiatoƒçn√©ho stavu pri naƒç√≠tan√≠ str√°nky
    document.addEventListener('DOMContentLoaded', () => {
        // Uistite sa, ≈æe v≈°etky extra legendy s√∫ na zaƒçiatku skryt√©
        extraLegends.forEach(legend => {
            legend.style.display = 'none';
        });
        // Tlaƒçidlo by malo ma≈• text "Zobrazi≈• viac"
        toggleButton.innerHTML = '<i class="fas fa-chevron-up" id="toggle-icon"></i>';
    });


    toggleButton.addEventListener('click', () => {
        areExtraVisible = !areExtraVisible;
        extraLegends.forEach(legend => {
            if (areExtraVisible) {
                legend.style.display = 'block';
            } else {
                legend.style.display = 'none';
            }
        });
        // Zmena textu a ikony na z√°klade stavu
        if (areExtraVisible) {
            toggleButton.innerHTML = '<i class="fas fa-chevron-down" id="toggle-icon"></i>';
        } else {
            toggleButton.innerHTML = '<i class="fas fa-chevron-up" id="toggle-icon"></i>';
        }
    });
    
    
    
    
    
    
  </script>

        
      </div>

   <div id="timestamp">

        Aktu√°lny ƒças: <span id="currentTime">00:00:00</span>
    </div> 
    

<div id="logo-container">
  <img src="https://www.meteopocasie.sk/wp-content/uploads/2024/01/Untitled49_20231209213754.png" alt="Logo" id="logo">
</div>
  <!-- === Screenshot Popup === -->
<div id="screenshot-popup">
  
<img id="screenshot-img" src="" alt="Mapa" />
<div>
  
<button class="btn-share" onclick="shareImage()">Zdieƒæa≈•</button>
<button class="btn-save" onclick="saveImage()">Ulo≈æi≈•</button>
<button class="btn-close" onclick="closePopup()">Zavrie≈•</button>
</div>
</div>

<!-- === Loading Overlay === -->
<div id="loading-overlay">
  <div class="spinner"></div>
  <div id="loading-text">Pripravujem obr√°zok...</div>
</div>

<style type="text/css" media="all">
  #controlsContainer {
    position: absolute;
    width: auto;
    height: auto;
    padding: 7px;
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    z-index: 1001;
    border-radius: 25px;
    left: 53px;
    top: 14%;
  }
  
  
  @media only screen and (max-width: 730px){
      #controlsContainer {
    position: absolute;
    width: auto;
    height: auto;
    padding: 7px;
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    z-index: 1001;
    border-radius: 25px;
    left: 14%;
    top: 31%;
  }
  }
  
  #geolocationButton {
background-color: #50afeb;
color: white;
border: none;
border-radius: 50%; /* Kruhov√Ω tvar */
width: 45px;
height: 45px;
font-size: 20px;
display: flex;
justify-content: center;
align-items: center;
cursor: pointer;
box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
transition: background-color 0.3s, transform 0.1s;
}

#geolocationButton:hover {
background-color: #3a92d4;
transform: scale(1.05);
}

#highlightIntenseButton {
background-color: #50afeb;
color: white;
border: none;
border-radius: 25px;
padding: 4px;
cursor: pointer;
font-size: 14px;
transition: background-color 0.3s, transform 0.1s;
display: flex;
align-items: center;
gap: 5px;
position: absolute;
transform: translateY(-50%);
right: 50%;
width: auto;
}

#highlightIntenseButton:hover {
background-color: #3a92d4;

}

#highlightIntenseButton.active {
background-color: #002043;
box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

/* ≈†t√Ωl pre vlastn√Ω ≈°pendl√≠k */
.custom-marker-icon {
font-size: 30px;
text-align: center;
line-height: 1;
transform: translate(-50%, -100%);
}

/* CSS pre plynul√∫ anim√°ciu radarov√Ωch sn√≠mok */
.leaflet-tile {
transition: opacity 0.8s ease-in-out; /* Plynul√Ω prechod pre zmeny opacity */
filter: none;
}
/* Nov√Ω filter pre zv√Ωraznenie intenzity */
/* ‚úÖ APLIKUJE filter IBA na radarov√© vrstvy */
.radar-tile.highlight-intense {
  filter: grayscale(90%) brightness(200%) contrast(400%) hue-rotate(100deg) saturate(200%);
}

.img-ic {
  width: 40px;
}
</style>

</div>

<div id="controlsContainer">
<!-- <button id="geolocationButton" title="Moja poloha">
<i class="fas fa-location-arrow"></i>
</button>-->
<button id="highlightIntenseButton" title="Detekcia kr√∫p">
<img class="img-ic" src="https://www.meteopocasie.sk/wp-content/themes/intentionally-blank/icons/hail.png" alt="" />
</button>
</div>
<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Esri Leaflet Core -->
<script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>

<!-- Esri Leaflet Vector Extension -->
<script src="https://unpkg.com/esri-leaflet-vector@4.1.1/dist/esri-leaflet-vector.js"></script>


    <script>
        var map = L.map('mapid').setView([48.688, 19.358], 6);

L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
    attribution: 'Map data ¬© <a href="https://openstreetmap.org">OpenStreetMap</a> & <a href="https://www.rainviewer.com/">RainViewer.com</a> contributors'
}).addTo(map);

// Premenn√° na ulo≈æenie kruhu
let pulsingCircle;

// Funkcia na povolenie GPS po kliknut√≠
function toggleGPS() {
    // ≈Ωiados≈• o zistenie aktu√°lnej polohy
    map.locate({ setView: true, maxZoom: 12 });

    // Ak je poloha n√°jden√°
    map.on('locationfound', function (e) {
        var baseRadius = e.accuracy / 0.6;
        var maxRadius = baseRadius * 1.5;
        var currentRadius = baseRadius;
        var growing = true;

        // Odstr√°ni≈• existuj√∫ci kruh, ak existuje
        if (pulsingCircle) {
            map.removeLayer(pulsingCircle);
        }

        // Vytvori≈• nov√Ω kruh
        pulsingCircle = L.circle(e.latlng, {
            color: '#fff',
            fillColor: '#007bff',
            fillOpacity: 0.5,
            radius: baseRadius
        }).addTo(map);

        // Funkcia anim√°cie kruhu
        function animatePulse() {
            if (growing) {
                currentRadius += 1;
                if (currentRadius >= maxRadius) growing = false;
            } else {
                currentRadius -= 1;
                if (currentRadius <= baseRadius) growing = true;
            }

            pulsingCircle.setRadius(currentRadius);
            requestAnimationFrame(animatePulse);
        }

        // Spusti≈• anim√°ciu
        animatePulse();
    });

    // Ak je chyba pri zis≈•ovan√≠ polohy
    map.on('locationerror', function (e) {
        alert("Nemo≈æno z√≠ska≈• polohu: " + e.message);
    });
}

function toggleScreenFullMap() {
    const wrapper = document.getElementById('map-wrapper'); // zabal v≈°etko do tohto

    if (!document.fullscreenElement) {
        if (wrapper.requestFullscreen) {
            wrapper.requestFullscreen();
        } else if (wrapper.webkitRequestFullscreen) {
            wrapper.webkitRequestFullscreen();
        } else if (wrapper.mozRequestFullScreen) {
            wrapper.mozRequestFullScreen();
        } else if (wrapper.msRequestFullscreen) {
            wrapper.msRequestFullscreen();
        }
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    }
}

// Event listener na opustenie fullscreen (napr. cez ESC) - obnov UI
document.addEventListener('fullscreenchange', () => {
    var controlPanel = document.getElementById('controlPanel');
    if (!document.fullscreenElement) {
        if (controlPanel) controlPanel.style.display = 'block';
        restoreRadarLayers();
    }
});

        
// Defin√≠cia z√°kladn√Ωch m√°p
var baseMaps = {
    "Satellite": L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', { attribution: "Satellite" }),
    "Dark All": L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: "Dark All" }),
    "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: "OpenStreetMap" }),
    "Relief Mapa": L.tileLayer('http://maps.openweathermap.org/maps/2.0/relief/{z}/{x}/{y}?mix_w=1&appid=b1b15e88fa797225412429c1c50c122a1', { attribution: "OpenWeatherMap.org" }),

    // ArcGIS podklady cez Esri Leaflet
    "ArcGIS Topo": L.esri.basemapLayer('Topographic'),
    "ArcGIS Streets": L.esri.basemapLayer('Streets'),
    "CiernaMapa": L.esri.basemapLayer('Imagery'),
    "Hillshade": L.esri.basemapLayer('DarkGray'),
    "BielaMapa": L.esri.basemapLayer('Gray'),
};

// Predvolen√° z√°kladn√° mapa
var currentBaseMap = baseMaps["Satellite"];
currentBaseMap.addTo(map);

// Funkcia na prep√≠nanie z√°kladnej mapy
function setBaseMap(mapType) {
    if (currentBaseMap) {
        map.removeLayer(currentBaseMap);
    }

    currentBaseMap = baseMaps[mapType];

    if (currentBaseMap) {
        currentBaseMap.addTo(map);
    } else {
        console.error("Neplatn√Ω typ mapy: " + mapType);
    }
}


// Pridanie z√°kladn√Ωch m√°p do inicializaƒçnej funkcie
loadApiData();


        
        
// Naƒç√≠tanie hranice Slovenska zo s√∫boru sk-hranice.json
  
  fetch('https://www.meteopocasie.sk/GEO/sk-map.json')
    .then(response => response.json())
    .then(data => {
        // Vytvorenie "tie≈àovej" vrstvy
        L.geoJSON(data, {
            style: function (feature) {
                return {
                    color: "#000", // Farba tie≈àa
                    weight: 2,     // Hr√∫bka tie≈àa
                    opacity: 0.3,  // Nepriehƒæadnos≈• tie≈àa
                    fillOpacity: 0
                };
            }
        }).addTo(map);

        // Vytvorenie hlavnej vrstvy hran√≠c
        L.geoJSON(data, {
            style: function (feature) {
                return {
                    color: "#FFF", // Farba hranice
                    weight: 1,     // Hr√∫bka hranice
                    opacity: 0.6,  // Nepriehƒæadnos≈• hranice
                    fillOpacity: 0
                };
            }
        }).addTo(map);
    })
    .catch(error => console.error('Error fetching the border data:', error));

        
        const apiKey = 'b1b15e88fa797225412429c1c50c122a1'; // Nahraƒè vlastn√Ωm kƒæ√∫ƒçom
const apiUrl = 'https://api.openweathermap.org/data/2.5/weather';
let weatherLayerGroup = null; // Glob√°lna vrstva poƒçasia


function createLegend(map) {
  const legend = L.control({ position: 'bottomright' });

  legend.onAdd = function () {
    const div = L.DomUtil.create('div', 'legend');
    const grades = [40, 35, 30, 25, 20, 15, 10, 5, 0, -5, -10, -15, -20, -25, -30, -35];
    const labels = grades.map((grade, i) => {
      const sign = i === 0 ? '+' : (i === grades.length - 1 ? '-' : '');
      return `<div><i class="legend-color" style="background: ${getTemperatureColor(grade)}"></i> ${grade}${sign}¬∞C</div>`;
    });

    div.innerHTML = labels.join('');
    return div;
  };

  legend.addTo(map);
}


        
      
        const locations = [
  { name: "Bratislava", lat: 48.1486, lon: 17.1077 },
  { name: "Ko≈°ice", lat: 48.7164, lon: 21.2611 },
  { name: "Pre≈°ov", lat: 49.0030, lon: 21.2330 },
  { name: "≈Ωilina", lat: 49.2238, lon: 18.7394 },
  { name: "Nitra", lat: 48.3064, lon: 18.0764 },
  { name: "Bansk√° Bystrica", lat: 48.7384, lon: 19.1603 },
  { name: "Trnava", lat: 48.3774, lon: 17.5888 },
  { name: "Trenƒç√≠n", lat: 48.8945, lon: 18.0399 },
  { name: "Martin", lat: 49.0640, lon: 18.9205 },
  { name: "Poprad", lat: 49.0557, lon: 20.3005 },
  { name: "Prievidza", lat: 48.7736, lon: 18.6275 },
  { name: "Zvolen", lat: 48.5739, lon: 19.1294 },
  { name: "Luƒçenec", lat: 48.3321, lon: 19.6673 },
  { name: "Levice", lat: 48.2157, lon: 18.6042 },
  { name: "Pova≈æsk√° Bystrica", lat: 49.1211, lon: 18.4317 },
  { name: "Nattheim (Nemecko)", lat: 48.7006, lon: 10.2878 },
  
  // Nov√© lokality na Slovensku
  { name: "Hlohovec", lat: 48.4316, lon: 17.8032 },
  { name: "Dunajsk√° Streda", lat: 47.9925, lon: 17.6145 },
  { name: "Kom√°rno", lat: 47.7579, lon: 18.1348 },
  { name: "Nov√© Z√°mky", lat: 47.9850, lon: 18.1614 },
  { name: "Topoƒæƒçany", lat: 48.5560, lon: 18.1741 },
  { name: "≈†aƒæa", lat: 48.1514, lon: 17.8791 },
  { name: "Partiz√°nske", lat: 48.6270, lon: 18.3735 },
  { name: "Rimavsk√° Sobota", lat: 48.3836, lon: 20.0169 },
  { name: "Vranov nad Topƒæou", lat: 48.8886, lon: 21.6756 },
  { name: "Humenn√©", lat: 48.9370, lon: 21.9162 },
  { name: "Michalovce", lat: 48.7551, lon: 21.9195 },
  { name: "Snina", lat: 48.9885, lon: 22.1494 },
  { name: "Trebi≈°ov", lat: 48.6293, lon: 21.7198 },
  { name: "Bardejov", lat: 49.2937, lon: 21.2757 },
  { name: "Sabinov", lat: 49.1044, lon: 21.0981 },
  { name: "Kysuck√© Nov√© Mesto", lat: 49.2964, lon: 18.7856 },
  { name: "ƒåadca", lat: 49.4393, lon: 18.7880 },
  { name: "Star√° ƒΩubov≈àa", lat: 49.3010, lon: 20.6875 },
  { name: "Liptovsk√Ω Mikul√°≈°", lat: 49.0802, lon: 19.6073 },
  { name: "Ru≈æomberok", lat: 49.0786, lon: 19.3088 },
  { name: "Doln√Ω Kub√≠n", lat: 49.2094, lon: 19.2977 },
  { name: "Krupina", lat: 48.3533, lon: 19.0638 },
  { name: "Detva", lat: 48.5595, lon: 19.4216 },
  { name: "Rev√∫ca", lat: 48.6831, lon: 20.1210 },
  { name: "Tisovec", lat: 48.6904, lon: 19.9437 },
  { name: "Hri≈àov√°", lat: 48.5914, lon: 19.5272 },
  { name: "≈Ωiar nad Hronom", lat: 48.5911, lon: 18.8597 },
  { name: "Handlov√°", lat: 48.7280, lon: 18.7608 },
  { name: "Brezno", lat: 48.8041, lon: 19.6422 },
  { name: "Ro≈æ≈àava", lat: 48.6659, lon: 20.5321 },
  { name: "Medzev", lat: 48.6994, lon: 20.7754 },
  { name: "Medzilaborce", lat: 49.3530, lon: 21.9176 },
  { name: "Nov√° Ba≈àa", lat: 48.3094, lon: 18.5625 },
  { name: "Malacky", lat: 48.4346, lon: 17.0479 },
  { name: "Hol√≠ƒç", lat: 48.5755, lon: 17.1489 },
  { name: "Myjava", lat: 48.6953, lon: 17.5686 },
  { name: "Pfofeld (Nemecko)", lat: 49.1033, lon: 10.7690 },
  { name: "Obernbreit (Nemecko)", lat: 49.7094, lon: 10.2125 },
  
  { name: "Veƒæk√Ω Krt√≠≈°", lat: 48.2075, lon: 19.3517 },
  { name: "Bytƒça", lat: 49.2246, lon: 18.5560 },
  { name: "≈†urany", lat: 48.0843, lon: 18.1875 }
];
        
        
      // openweathermap pallete 
     // -40 = #FFFCFF, -35 = #FFDAFA, -30 = #E1ABFF, -25 = #CF78FF, -20 = #8D78FF, -15 = #5872FF, -10 = #0054FF, -5 = #00A6FF, 0 = 
        
        
        http://maps.openweathermap.org/maps/2.0/weather/TA2/{z}/{x}/{y}?appid=b1b15e88fa797225412429c1c50c122a1&fill_bound=true&opacity=0.6&palette=-40:FFFCFF;-35:FFDAFA;-30:E1ABFF;-25:CF78FF;-20:8D78FF;-15:5872FF;-10:0054FF;-5:00A6FF;0:00F7FF;5:00FF0B;10:9FFF00;15:FFF600;20:F5BE00;25:FF6F00;30:FF2600;35:BE0202;40:9800FF
        
        
        //

        function getTemperatureColor(temperature) {
  if (temperature >= 40) return '#9800FF';
  else if (temperature >= 35) return '#BE0202';
  else if (temperature >= 30) return '#FF2600';
  else if (temperature >= 25) return '#FF6F00';
  else if (temperature >= 20) return '#F5BE00';
  else if (temperature >= 15) return '#FFF600';
  else if (temperature >= 10) return '#9FFF00';
  else if (temperature >= 5) return '#00FF0B';
  else if (temperature >= 0) return '#00F7FF';
  else if (temperature >= -5) return '#00A6FF';
  else if (temperature >= -10) return '#0054FF';
  else if (temperature >= -15) return '#5872FF';
  else if (temperature >= -20) return '#8D78FF';
  else if (temperature >= -25) return '#CF78FF';
  else if (temperature >= -30) return '#E1ABFF';
  else if (temperature >= -35) return '#FFDAFA';
  else return '#FFFCFF';
}

function loadWeatherLayer() {
  if (weatherLayerGroup) {
    map.removeLayer(weatherLayerGroup); // Odstr√°ni predch√°dzaj√∫cu vrstvu
  }

  weatherLayerGroup = L.layerGroup();

  locations.forEach(location => {
    const url = `${apiUrl}?lat=${location.lat}&lon=${location.lon}&appid=${apiKey}&units=metric&lang=sk`;

    fetch(url)
      .then(response => response.json())
      .then(data => {
        const temperature = data.main.temp_max;
const icon = data.weather[0].icon;
const iconUrl = `https://www.meteopocasie.sk/3d_iconset/${icon}.png`; // vlastn√° ikona
const temperatureColor = getTemperatureColor(temperature);

const weatherDesc = data.weather[0].description;

const divHtml = `
  <div class="weather-bubble" style="border-color: ${temperatureColor}">
    <div class="temp" style="color: ${temperatureColor}">${temperature.toFixed()}¬∞</div>
    <img src="${iconUrl}" alt="ikona" class="weather-icon">
    <div class="weather-tooltip">
      <strong>${location.name}</strong><br>
      ${weatherDesc.charAt(0).toUpperCase() + weatherDesc.slice(1)}
      <br>${temperature.toFixed()}
    </div>
  </div>
`;

const weatherBox = L.divIcon({
  className: '',
  html: divHtml,
  iconSize: [40, 40],
  iconAnchor: [20, 20]
});

const marker = L.marker([location.lat, location.lon], { icon: weatherBox });
weatherLayerGroup.addLayer(marker);


        marker.on('click', () => {
          alert(`${location.name}: ${temperature.toFixed(1)} ¬∞C`);
        });

        weatherLayerGroup.addLayer(marker);
      })
      .catch(error => console.error(`Chyba pre ${location.name}:`, error));
  });

  weatherLayerGroup.addTo(map);
}

     
     
     function manualUpdate() {
    // Perform the manual update logic here
    // Example: Fetch new radar data and update the map
    // Here is a basic fetch example (you may adjust as per your API endpoint and logic):
    fetch('https://api.rainviewer.com/public/weather-maps.json')
        .then(response => response.json())
        .then(data => {
            initialize(data, optionKind); // Reinitialize map with new data
        })
        .catch(error => console.error('Error fetching radar data:', error));
} 
     
     
       function back() {
  stop();
  showFrame(animationPosition - 1);
}

function next() {
  stop();
  showFrame(animationPosition + 1);
}

var apiData = {};
var mapFrames = [];
var lastPastFramePosition = -1;
var radarLayers = [];
var lightningLayer;
var satLayer = null;
var prognosticLayer;
var tropicalLayer;
var arrowPrecipLayer;


var optionKind = 'combi'; // predvolene naƒç√≠ta radar + satellite
var optionCombi = 'satellite';
var optionTileSize = 512;
var optionColorScheme = 7;
var optionSmoothData = 1;
var optionSnowColors = 1;
var optionBlurData = 0;
var satelliteFrames = [];
var satelliteLayer;

let reportsVisible = false;
let reportsInterval;


var animationPosition = 0;
var animationTimer = false;



    var loadingTilesCount = 0;
    var loadedTilesCount = 0;
    
    function startLoadingTile() {
        loadingTilesCount++;    
    }
    function finishLoadingTile() {
        // Delayed increase loaded count to prevent changing the layer before 
        // it will be replaced by next
        setTimeout(function() { loadedTilesCount++; }, 250);
    }
    function isTilesLoading() {
        return loadingTilesCount > loadedTilesCount;
    }
    
    


var geolocationButton = document.getElementById('geolocationButton');
var highlightIntenseButton = document.getElementById('highlightIntenseButton'); // Tlaƒçidlo pre detekciu kr√∫p

// if (savedHighlightIntense === 'true') {
//   highlightIntenseButton.classList.add('active');
// }

function loadApiData() {
  var apiRequest = new XMLHttpRequest();
  apiRequest.open("GET", "https://api.rainviewer.com/public/weather-maps.json", true);
  apiRequest.onload = function() {
    if (apiRequest.status === 200) {
      try {
        apiData = JSON.parse(apiRequest.response);
        console.log("API data naƒç√≠tan√©:", apiData);
        initialize(apiData, optionKind);
      } catch (e) {
        console.error("Chyba pri parsovan√≠ JSON:", e);
      }
    } else {
      console.error("Chyba pri naƒç√≠tan√≠ API, status:", apiRequest.status);
    }
  };
  apiRequest.onerror = function() {
    console.error("Chyba pri naƒç√≠tan√≠ API - sie≈•ov√° chyba");
  };
  apiRequest.send();
}



// Na zaƒçiatku JS skriptu zavolaj
loadApiData();

// Funkcia na aplikovanie/odstr√°nenie filtrov na v≈°etky existuj√∫ce dla≈ædice
function applyFilterToAllTiles(className, enable) {
  document.querySelectorAll('.radar-tile').forEach(tile => {
    tile.classList.toggle(className, enable);
  });
}
 

highlightIntenseButton.addEventListener('click', function () {
  highlightIntenseButton.classList.toggle('active');
  const isActive = highlightIntenseButton.classList.contains('active');

  // Ulo≈æi≈• stav
  localStorage.setItem('filterHighlightIntense', isActive.toString());

  // Aplikova≈•/odstr√°ni≈• filter IBA na radar tiles
  applyFilterToAllTiles('highlight-intense', isActive);
});


// Ukladanie polohy a pribl√≠≈æenia mapy pri zmene
map.on('moveend', function() {
localStorage.setItem('mapCenter', JSON.stringify(map.getCenter()));
localStorage.setItem('mapZoom', map.getZoom());
});


// Modified initialize function to combine radar and satellite layers
function initialize(api, kind) {
  if (lightningLayer) { map.removeLayer(lightningLayer); lightningLayer = null; }
  if (blitzLayer) { map.removeLayer(blitzLayer); blitzLayer = null; }
  if (satLayer) { map.removeLayer(satLayer); satLayer = null; } 
  if (prognosticLayer) { map.removeLayer(prognosticLayer); prognosticLayer = null; }
  if (tropicalLayer) { map.removeLayer(tropicalLayer); tropicalLayer = null; }
  if (arrowPrecipLayer) { map.removeLayer(arrowPrecipLayer); arrowPrecipLayer = null; }
  if (satelliteLayer) { map.removeLayer(satelliteLayer); satelliteLayer = null; }
  if (windSpeedLayer) { map.removeLayer(windSpeedLayer); windSpeedLayer = null; }
  clearAllRadarLayers();

  mapFrames = [];
  animationPosition = 0;

  if (!api) return;

  if (kind === 'combi') {
    if (api.radar && Array.isArray(api.radar.past)) {
      mapFrames = api.radar.past.concat(api.radar.nowcast || []);
      lastPastFramePosition = api.radar.past.length - 1;
      showFrame(lastPastFramePosition);

      if (kind === 'combi') {
  if (api.satellite && Array.isArray(api.satellite.infrared)) {
    satelliteFrames = api.satellite.infrared;
  }
}


      // Aplik√°cia ulo≈æen√©ho filtra pri inicializ√°cii
if (highlightIntenseButton.classList.contains('active')) {
applyFilterToAllTiles('highlight-intense', true);
}

      addLayer(mapFrames[animationPosition]);
    } else {
      console.warn("Radar data not available in API response");
    }



    
}



            // show the last "past" frame
            lastPastFramePosition = api.radar.past.length - 1;
            showFrame(lastPastFramePosition, true);


  if (kind === 'lightning') {
    addLightningLayer();
  }
  if (kind === 'satLayer') {
    addSatLayer();
  }
  if (kind === 'prognostic') {
    addPrognosticLayer();
  }
  if (kind === 'tropicalStorm') {
    addTropicalLayer();
  }
  
  if (kind === 'arrowWind') {
    arrowPrecip();
  } 
  
  if (kind === 'rainAccum') {
    addRainAccumLayer();
  }
  
if (kind === 'windSpeedLayer') {
    addWindLayer();
  }

}

const windMarkers = [];
const rainMarkers = [];
let rainAccumVisible = false;
let windSpeedVisible = false;

function toggleRainAccumLayer(button) {
  if (rainAccumVisible) {
    clearRainAccumLayer();
    button.classList.remove('active');
    rainAccumVisible = false;
  } else {
    addRainAccumLayer();
    button.classList.add('active');
    rainAccumVisible = true;
  } // Nastavenie poƒçiatoƒçn√Ωch hodn√¥t ovl√°dac√≠ch prvkov

if (savedHighlightIntense === 'true') { // Aplik√°cia filtra pri naƒç√≠tan√≠
highlightIntenseButton.classList.add('active');
}

  
}


function toggleWindSpeedLayer(button) {
  if (windSpeedVisible) {
    clearWindSpeedLayer();
    button.classList.remove('active');
    windSpeedVisible = false;
  } else {
    addWindLayer();
    button.classList.add('active');
    windSpeedVisible = true;
  } // Nastavenie poƒçiatoƒçn√Ωch hodn√¥t ovl√°dac√≠ch prvkov

if (savedHighlightIntense === 'true') { // Aplik√°cia filtra pri naƒç√≠tan√≠
highlightIntenseButton.classList.add('active');
}

  
}


function addRainAccumLayer() {
  
function getColor(mm) {
if (mm >= 125) return "purple";
if (mm >= 100) return "red";
if (mm >= 75) return "orange";
if (mm >= 50) return "yellow";
if (mm >= 25) return "green";
if (mm >= 10) return "blue";
return "white";
}

function getTextColor(bgColor) {
const darkColors = ["blue", "purple", "red","green"];
return darkColors.includes(bgColor) ? "white" : "black";
}


locations.forEach(city => {
fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${city.lat}&lon=${city.lon}&appid=${apiKey}&units=metric`)
.then(res => res.json())
.then(data => {
const rain1h = data.rain && data.rain["1h"] ? data.rain["1h"] : 0;
const color = getColor(rain1h);
const textColor = getTextColor(color);

const icon = L.divIcon({
className: '',
html: `<div class="rain-label" style="background:${color};color:${textColor};font-family:'Poppins', sans-serif;">${rain1h.toFixed(1)} mm</div>`
});

const marker = L.marker([city.lat, city.lon], { icon }).addTo(map)
        .bindPopup(`<div style="background: ${color}; padding: 5px; border-radius: 25px; width: 120px; text-align: center; font-family: 'Poppins', sans-serif; box-shadow: 0 0 4px #00000085;"><strong>${city.name}</strong><br>Zr√°≈æky (1h): ${rain1h} mm</div>`);

      rainMarkers.push(marker);  // ulo≈æ marker
    })

.catch(err => {
console.error("Chyba pri naƒç√≠tan√≠ √∫dajov:", err);
});
});
}

function clearRainAccumLayer() {
  rainMarkers.forEach(marker => map.removeLayer(marker));
  rainMarkers.length = 0; // vypr√°zdni pole
}

function clearWindSpeedLayer() {
  windMarkers.forEach(marker => map.removeLayer(marker));
  windMarkers.length = 0; // vypr√°zdni pole
}

let rainAccumActive = false;
let rainAccumLayer = null;
let windSpeedLayer = null;

let windSpeedActive = false;
let blitzLayer = null;


function addWindLayer() {
    // Function to interpolate colors for a gradient effect
    function interpolateColor(color1, color2, factor) {
      const result = color1.slice(); // Create a copy to avoid modifying original
      for (let i = 0; i < 3; i++) {
        result[i] = Math.round(result[i] + factor * (color2[i] - color1[i]));
      }
      return `rgb(${result[0]},${result[1]},${result[2]})`;
    }
    
    // Convert hex color to RGB array
    function hexToRgb(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return [r, g, b];
    }
    
    // Define color stops for the gradient (km/h and RGB color)
    const colorStops = [
      { kmh: 0, color: hexToRgb("#FFFFFF") }, // White
      { kmh: 10, color: hexToRgb("#ADD8E6") }, // Light Blue
      { kmh: 20, color: hexToRgb("#00FF00") }, // Green
      { kmh: 35, color: hexToRgb("#FFFF00") }, // Yellow
      { kmh: 55, color: hexToRgb("#FFA500") }, // Orange
      { kmh: 75, color: hexToRgb("#FF0000") }, // Red
      { kmh: 90, color: hexToRgb("#800080") } // Purple
    ];
    
    // Function to get color based on wind gust speed using gradient
    function getGradientColor(kmh) {
      if (kmh <= colorStops[0].kmh) return `rgb(${colorStops[0].color.join(',')})`;
      if (kmh >= colorStops[colorStops.length - 1].kmh) return `rgb(${colorStops[colorStops.length - 1].color.join(',')})`;
      
      for (let i = 0; i < colorStops.length - 1; i++) {
        const stop1 = colorStops[i];
        const stop2 = colorStops[i + 1];
        
        if (kmh >= stop1.kmh && kmh < stop2.kmh) {
          const factor = (kmh - stop1.kmh) / (stop2.kmh - stop1.kmh);
          return interpolateColor(stop1.color, stop2.color, factor);
        }
      }
      return `rgb(${colorStops[0].color.join(',')})`; // Fallback
    }
    
    // Function to determine text color based on background color for contrast
    function getTextColor(rgbColorString) {
      // Parse RGB string to get individual components
      const parts = rgbColorString.match(/\d+/g).map(Number);
      const r = parts[0];
      const g = parts[1];
      const b = parts[2];
      
      // Calculate luminance (Y = 0.299 R + 0.587 G + 0.114 B)
      const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
      
      // Use white text for dark backgrounds, black for light backgrounds
      return luminance > 0.5 ? "black" : "white";
    }
    
    // Function to convert degrees to cardinal direction (from where the wind is blowing)
    function getCardinalDirection(deg) {
      const directions = ["S", "SV", "V", "JV", "J", "JZ", "Z", "SZ"];
      // OpenWeatherMap's 'deg' is the direction FROM which the wind is blowing.
      // The index calculation maps 0 (North) to S, 45 to SV, etc.
      const index = Math.round((deg % 360) / 45);
      return directions[index % 8];
    }
    
    
    
    // Iterate over each city to fetch weather data and add markers
    locations.forEach(city => {
      fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${city.lat}&lon=${city.lon}&appid=${apiKey}&units=metric`)
        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          return res.json();
        })
        .then(data => {
          // Extract wind gust and direction
          const gust = data.wind?.gust || 0;
          const gustKmh = gust * 3.6; // Convert m/s to km/h
          // OpenWeatherMap's 'deg' is the direction FROM which the wind is blowing.
          // To make the arrow point TO where the wind is going, we add 180 degrees.
          const windDirectionDegFrom = data.wind?.deg || 0;
          const windDirectionDegTo = (windDirectionDegFrom + 180) % 360; // Arrow points TO this direction
          
          const backgroundColor = getGradientColor(gustKmh);
          const textColor = getTextColor(backgroundColor);
          const cardinalDirection = getCardinalDirection(windDirectionDegFrom); // Cardinal direction is FROM where
          
          // New, more prominent SVG arrow icon (solid, filled arrow shape)
          const arrowSvg = `
<svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
<path d="M12 0L0 12H7V24H17V12H24L12 0Z"/>
</svg>
`;
          
          // Create a custom div icon for the marker
          const icon = L.divIcon({
            className: '', // No default Leaflet class
            html: `
<div class="gust-label" style="background:${backgroundColor};color:${textColor}">
<span class="wind-arrow" style="transform: rotate(${windDirectionDegTo}deg);">${arrowSvg}</span>
<span class="wind-text">${cardinalDirection}</span>
<span>${gustKmh.toFixed(1)} km/h</span>
</div>
`
          });
          
const marker = L.marker([city.lat, city.lon], { icon }).addTo(map)
  .bindPopup(`<div style="width: auto; height: auto; padding: 8px 10px; border-radius: 25px; background: #002043; color: #fff; font-family: 'Poppins';"><center><strong style="text-align: center; font-size: 16px;">${city.name}</strong></center><p style="font-family: 'Poppins', sans-serif; font-weight: 500; padding-left: 5px;">N√°razy vetra: ${gustKmh.toFixed(1)} km/h<br>Smer vetra: ${cardinalDirection} (f√∫ka z ${windDirectionDegFrom}¬∞)</p></div>`);

windMarkers.push(marker); // <-- Pridaj sem
        })
        .catch(err => {
          console.error(`Chyba pri naƒç√≠tan√≠ √∫dajov pre ${city.name}:`, err);
          // Optionally, add a marker with an error message or default value
          const icon = L.divIcon({
            className: '',
            html: `<div class="gust-label" style="background:gray;color:white">N/A km/h</div>`
          });
const marker = L.marker([city.lat, city.lon], { icon }).addTo(map)
  .bindPopup(`<strong>${city.name}</strong><br>√ödaje o vetre nie s√∫ dostupn√©.`);

windMarkers.push(marker); // <-- aj sem

        });
    });
}




function addSatelliteLayer(position) {
  if (!satelliteFrames.length) return;

  while (position >= satelliteFrames.length) position -= satelliteFrames.length;
  while (position < 0) position += satelliteFrames.length;

  var frame = satelliteFrames[position];
  var tileUrl = apiData.host + frame.path + '/' + optionTileSize + '/{z}/{x}/{y}/0/0_0.png';

  if (satelliteLayer && map.hasLayer(satelliteLayer)) {
    map.removeLayer(satelliteLayer);
  }

  satelliteLayer = new L.TileLayer(tileUrl, {
    tileSize: 256,
    opacity: 0.5,  // nastav podƒæa potreby
    zIndex: 5
  });

  satelliteLayer.addTo(map);
}




function addLightningLayer() {
  setKind('combi');

  if (!lightningLayer) {
    const apiKey = "eyJvcmciOiI1ZTU1NGUxOTI3NGE5NjAwMDEyYTNlYjEiLCJpZCI6Ijc3OWRhYmI3OGUxNzRhYTE5NzAzNDFhNDQ3OTE2OTE5IiwiaCI6Im11cm11cjEyOCJ9";

    const FilteredLightningLayer = L.TileLayer.extend({
      createTile: function(coords, done) {
        const tile = document.createElement('canvas');
        tile.width = tile.height = 256;
        const ctx = tile.getContext('2d');

        const img = new Image();
        img.crossOrigin = 'anonymous';

        const url = this.getTileUrl(coords);

        img.onload = () => {
  ctx.drawImage(img, 0, 0);
  try {
    const imageData = ctx.getImageData(0, 0, 256, 256);
    const data = imageData.data;

    for (let y = 0; y < 256; y++) {
      for (let x = 0; x < 256; x++) {
        const i = (y * 256 + x) * 4;

        // Detekcia blesku (ƒçerven√Ω pixel)
        if (data[i] > 150 && data[i+1] < 50 && data[i+2] < 50) {
          ctx.beginPath();
          ctx.arc(x, y, 0.5, 0, 2 * Math.PI); // mal√Ω kruh s polomerom 1.8px
          ctx.fillStyle = 'white';           // v√Ωpl≈à biela
          ctx.strokeStyle = 'black';         // okraj ƒçierny
          ctx.lineWidth = 1.2;
          ctx.shadowBlur = 0;                // bez sveteln√©ho efektu
          ctx.fill();
          ctx.stroke();
        }
      }
    }
  } catch(e) {
    console.warn('Canvas error:', e);
  }
  done(null, tile);
};


        img.onerror = (e) => done(e, tile);

        img.src = url;

        return tile;
      },

      getTileUrl: function(coords) {
        const tileSize = 256;
        const crs = this._map.options.crs;
        const nwPoint = coords.multiplyBy(tileSize);
        const sePoint = nwPoint.add([tileSize, tileSize]);
        const nw = crs.project(this._map.unproject(nwPoint, coords.z));
        const se = crs.project(this._map.unproject(sePoint, coords.z));
        const bbox = [nw.x, se.y, se.x, nw.y].join(',');

        const baseUrl = "https://www.meteopocasie.sk/proxy/knmi_proxy.php";

        return (
          baseUrl +
          "?service=WMS" +
          "&version=1.3.0" +
          "&request=GetMap" +
          "&layers=dwd:NCEW_EU" +
          "&format=image/png" +
          "&transparent=true" +
          "&height=256" +
          "&width=256" +
          "&crs=EPSG:3857" +
          "&bbox=" + bbox +
          `&apikey=${apiKey}`
        );
      }
    });

    lightningLayer = new FilteredLightningLayer({
      opacity: 0.6,
      zIndex: 1000,  // v√§ƒç≈°√≠ ako radarov√© vrstvy
    });

    // Uisti sa, ≈æe radarLayers s√∫ u≈æ na mape
    // Sk√∫s nastavi≈• ich zIndex ni≈æ≈°ie, ak sa d√°
    

    lightningLayer.addTo(map);

    // Ak chce≈° anim√°ciu, dopl≈à ƒçasov√Ω parameter a met√≥du setTime(), ako som posielal predt√Ωm.
    
    const maxRadarZIndex = 5;

lightningLayer.bringToFront();
lightningLayer.setOpacity(0.6);

lightningLayer.setZIndex(maxRadarZIndex + 10);

  }
}

function addSatLayer(timeISO) {
  console.log("addSatLayer called with time:", timeISO);

  if (satLayer) {
    map.removeLayer(satLayer);
    satLayer = null;
  }

  const apiKey = "eyJvcmciOiI1ZTU1NGUxOTI3NGE5NjAwMDEyYTNlYjEiLCJpZCI6Ijc3OWRhYmI3OGUxNzRhYTE5NzAzNDFhNDQ3OTE2OTE5IiwiaCI6Im11cm11cjEyOCJ9";

  const FilteredSatLayer = L.TileLayer.extend({
    createTile: function(coords, done) {
      const tile = document.createElement('canvas');
      tile.width = tile.height = 256;
      const ctx = tile.getContext('2d');

      const img = new Image();
      img.crossOrigin = 'anonymous';

      const url = this.getTileUrl(coords);
      console.log("Loading tile URL:", url);

      img.onload = () => {
        ctx.drawImage(img, 0, 0);
        try {
          const imageData = ctx.getImageData(0, 0, 256, 256);
          const data = imageData.data;
          for (let i = 0; i < data.length; i += 4) {
            if (data[i] > 150 && data[i+1] < 50 && data[i+2] < 50) {
              data[i] = 0; data[i+1] = 0; data[i+2] = 0; data[i+3] = 255;
            }
          }
          ctx.putImageData(imageData, 0, 0);
        } catch(e) {
          console.warn('Canvas error:', e);
        }
        done(null, tile);
      };

      img.onerror = (e) => {
        console.error("Tile image failed to load", e);
        done(e, tile);
      };

      img.src = url;

      return tile;
    },

    getTileUrl: function(coords) {
  const tileSize = 256;
  const crs = this._map.options.crs;
  const nwPoint = coords.multiplyBy(tileSize);
  const sePoint = nwPoint.add([tileSize, tileSize]);
  const nw = crs.project(this._map.unproject(nwPoint, coords.z));
  const se = crs.project(this._map.unproject(sePoint, coords.z));
  const bbox = [nw.x, se.y, se.x, nw.y].join(',');

  const baseUrl = "https://www.meteopocasie.sk/proxy/knmi_proxy.php";

  const time = this.options.time ? `&TIME=${this.options.time}` : "";

  const url = (
    baseUrl +
    "?service=WMS" +
    "&version=1.3.0" +
    "&request=GetMap" +
    "&layers=dwd:Satellite_meteosat_1km_euat_rgb_day_hrv_and_night_ir108_3h" +
    "&format=image/png" +
    "&transparent=true" +
    "&height=256" +
    "&width=256" +
    "&crs=EPSG:3857" +
    "&bbox=" + bbox +
    `${time}` +
    `&apikey=${apiKey}`
  );
  return url;
}

  });

  satLayer = new FilteredSatLayer({
    opacity: 0.8,
    zIndex: 1,
  });
  
  satLayer.setZIndex(5); // alebo podƒæa potreby
satLayer.setOpacity(0.5); // nastav norm√°lnu hodnotu opacity

  satLayer.addTo(map);

  console.log("satLayer added to map");
}

let pressureLayer = null;

function addPressureLayer() {
  console.log("addPressureLayer called");

  if (pressureLayer) {
    console.log("Removing existing pressureLayer");
    map.removeLayer(pressureLayer);
    pressureLayer = null;
  }

  // API key podƒæa tvojho p√¥vodn√©ho k√≥du, ale DWD WMS ho NEPOU≈Ω√çVA
  // tak≈æe ho pou≈æijeme len pre proxy, pr√≠padne vyma≈æ, ak nie je potrebn√Ω
  const apiKey = "eyJvcmciOiI1ZTU1NGUxOTI3NGE5NjAwMDEyYTNlYjEiLCJpZCI6Ijc3OWRhYmI3OGUxNzRhYTE5NzAzNDFhNDQ3OTE2OTE5IiwiaCI6Im11cm11cjEyOCJ9";

  const FilteredPressureLayer = L.TileLayer.extend({
    createTile: function(coords, done) {
      const tile = document.createElement('canvas');
      tile.width = tile.height = 256;
      const ctx = tile.getContext('2d');

      const img = new Image();
      img.crossOrigin = 'anonymous';

      const url = this.getTileUrl(coords);
      console.log("Loading pressure tile URL:", url);

      img.onload = () => {
        ctx.drawImage(img, 0, 0);

        try {
          const imageData = ctx.getImageData(0, 0, 256, 256);
          const data = imageData.data;
          // Tu m√¥≈æe≈° prida≈• √∫pravu pixlov, ak chce≈° (moment√°lne sa nemen√≠)
          ctx.putImageData(imageData, 0, 0);
        } catch(e) {
          console.warn('Canvas error in pressureLayer:', e);
        }

        done(null, tile);
      };

      img.onerror = (e) => {
        console.error("Pressure tile image failed to load", e);
        done(e, tile);
      };

      img.src = url;
      return tile;
    },

    getTileUrl: function(coords) {
      const tileSize = 256;
      const crs = this._map.options.crs;
      const nwPoint = coords.multiplyBy(tileSize);
      const sePoint = nwPoint.add([tileSize, tileSize]);
      const nw = crs.project(this._map.unproject(nwPoint, coords.z));
      const se = crs.project(this._map.unproject(sePoint, coords.z));
      const bbox = [nw.x, se.y, se.x, nw.y].join(',');

      // Origin√°l WMS URL
      const originalUrl =
        "https://maps.dwd.de/geoserver/dwd/wms" +
        "?service=WMS" +
        "&version=1.3.0" +
        "&request=GetMap" +
        "&layers=dwd:Icon-eu_reg015-PMSL" +
        "&format=image/png" +
        "&transparent=true" +
        "&height=256" +
        "&width=256" +
        "&crs=EPSG:3857" +
        "&bbox=" + bbox;

      // Proxy URL + origin√°l URL zak√≥dovan√°
      const proxyBaseUrl = "https://www.meteopocasie.sk/proxy/knmi_proxy2.php?url=";

      return proxyBaseUrl + encodeURIComponent(originalUrl);
    }
  });

  pressureLayer = new FilteredPressureLayer({
    opacity: 0.6,
    zIndex: 1000,
    crossOrigin: true
  });

  pressureLayer.addTo(map);
  pressureLayer.bringToFront();

  console.log("pressureLayer added to map");
}


   

// Funkcia na pridanie prognostickej vrstvy
function addPrognosticLayer() {
    setKind('combi'); // zabezpeƒç√≠ zobrazenie z√°kladn√Ωch vrstiev
  if (!prognosticLayer) {
    var imageUrl = "https://www.meteopocasie.sk/centralEurope/data_services-image/transparent24.gif";
    var imageBounds = [[46.3, 16.3], [50.2, 22.9]];
    prognosticLayer = L.imageOverlay(imageUrl, imageBounds, {
      opacity: 0.7,
      crossOrigin: true, 
      attribution: 'Map data ¬© <a href="https://www.meteopocasie.sk">MeteoPoƒçasie.sk</a> contributors'
    });
    prognosticLayer.addTo(map);
  }
}

// Funkcia na pridanie tropickej b√∫rkovej vrstvy
function addTropicalLayer() {
    setKind('combi'); // zabezpeƒç√≠ zobrazenie z√°kladn√Ωch vrstiev
  if (!tropicalLayer) {
    tropicalLayer = L.tileLayer('https://maps.aerisapi.com/YOUR_API_KEY/tropical-cyclones,tropical-cyclones-names,tropical-cyclones-position-icons,tropical-cyclones-cones/{z}/{x}/{y}/current.png', {
  attribution: '¬© AerisWeather',
  zIndex: 900, 
  tileSize: 256,
  opacity: 0.8, 
  crossOrigin: true
});
tropicalLayer.addTo(map);

  }
}



function addBlitzLayer() {
  // cleanup
  initialize(); // tvoje existuj√∫ce
  if (blitzLayer) map.removeLayer(blitzLayer);

 

  blitzLayer = L.tileLayer.wms("https://maps.dwd.de/geoserver/dwd/ows", {
    layers: "dwd:Blitzdichte",
    format: "image/png",
    transparent: true,
    opacity: 0.6,
    version: "1.1.1",
    attribution: "¬© DWD",
    zIndex: 500, 
    crossOrigin: true
  }).addTo(map);
}



function arrowPrecip() {
    setKind('combi'); // zabezpeƒç√≠ zobrazenie z√°kladn√Ωch vrstiev
  if (!arrowPrecipLayer) {
    arrowPrecipLayer = L.tileLayer('https://maps.openweathermap.org/maps/2.0/weather/WND/{z}/{x}/{y}?appid=b1b15e88fa797225412429c1c50c122a1&fill_bound=true&opacity=0&palette=0:ffffffff;5:ffffffff;10:ffffffff;15:ffffffff;20:ffffffff;25:ffffffff;30:ffffffff;35:ffffffff;40:ffffffff', {
      attribution: 'Map data ¬© <a href="https://www.aerisweather.com">AerisWeather.com</a> contributors',
      tileSize: 256,
      opacity: 0.8,
      zIndex: 10, 
      crossOrigin: true

    });
    arrowPrecipLayer.addTo(map);
  }
}






// Nastavenie posuvn√≠ka ƒçasu po naƒç√≠tan√≠ d√°t
// timeSlider.max = mapFrames.length - 1;
// timeSlider.value = animationPosition;
// updateSliderBackground();


// function updateSliderBackground() {
// const value = (timeSlider.value - timeSlider.min) / (timeSlider.max - timeSlider.min) * 100;
// timeSlider.style.setProperty('--slider-fill', `${value}%`);
// } 

var timeSlider = document.getElementById('timeSlider');
timeSlider.style.zIndex = '1001';
var currentMarker = null; // Pre ulo≈æenie aktu√°lneho ≈°pendl√≠ka (st√°le ponechan√© pre pr√≠padn√© bud√∫ce pou≈æitie)



// Pomocn√° funkcia ‚Äî skryje v≈°etky star√© radar vrstvy okrem aktu√°lnej
function clearOldRadarLayers(currentFramePath) {
  for (var path in radarLayers) {
    if (path !== currentFramePath && map.hasLayer(radarLayers[path])) {
      radarLayers[path].setOpacity(0);
    }
  }
}





// RADAR LAYER ANIM√ÅCIA
function addLayer(frame) {
  if (!radarLayers[frame.path]) {
    var colorScheme = optionKind === 'satellite' ? 0 : optionColorScheme;
    var smooth = optionKind === 'satellite' ? 0 : optionSmoothData;
    var snow = optionKind === 'satellite' ? 0 : optionSnowColors;
    var blur = optionKind === 'satellite' ? 0 : optionBlurData;

    radarLayers[frame.path] = new L.TileLayer(
      apiData.host + frame.path + '/' + optionTileSize + '/{z}/{x}/{y}/' + colorScheme + '/' + smooth + '_' + snow + '.png',
      {
        tileSize: 256,
        opacity: 0, // Zaƒçne neviditeƒæn√Ω
        zIndex: 10, // Nad ostatn√Ωmi vrstvami
        crossOrigin: true, 
        className: 'radar-tile'

      }
      
    );
    
    radarLayers[frame.path].on('load', () => {
  const isActive = highlightIntenseButton.classList.contains('active');
  if (isActive) {
    applyFilterToAllTiles('highlight-intense', true);
  }
});

    
  }
  
  

  // Pridaj vrstvu do mapy ak tam e≈°te nie je
  if (!map.hasLayer(radarLayers[frame.path])) {
    map.addLayer(radarLayers[frame.path]);
  }

  // Nastav jej opacity na 1 (viditeƒæn√°)
  radarLayers[frame.path].setOpacity(0.7);

  // Skry ostatn√© vrstvy
  clearOldRadarLayers(frame.path);
  
  // Pridanie event listenera pre naƒç√≠tanie dla≈ædice, aby sa aplikovali filtre
radarLayers[frame.path].on('tileload', function(e) {
if (highlightIntenseButton.classList.contains('active')) { // Aplik√°cia filtra
e.tile.classList.add('highlight-intense');
}
});
}

function clearAllRadarLayers() {
  for (var path in radarLayers) {
    if (map.hasLayer(radarLayers[path])) {
      map.removeLayer(radarLayers[path]);
    }
  }
  radarLayers = {}; // Vyma≈æ v≈°etky z pam√§te
}











function changeRadarPosition(position, preloadOnly) {
  while (position >= mapFrames.length) {
    position -= mapFrames.length;
  }
  while (position < 0) {
    position += mapFrames.length;
  }
  
  var currentFrame = mapFrames[animationPosition];
var nextFrame = mapFrames[position];
  
  addLayer(nextFrame);
  
  if (preloadOnly || (isTilesLoading() && !force)) {
            return;
        }
  
  animationPosition = position;
  
  if (radarLayers[currentFrame.path]) {
    radarLayers[currentFrame.path].setOpacity(0);
  }
  // Nastavenie opacitu pre nov√∫ sn√≠mku na z√°klade currentRadarOpacity
  radarLayers[nextFrame.path].setOpacity(currentRadarOpacity);

  // Synchronizuj satelitn√∫ anim√°ciu podƒæa vybranej kombin√°cie
  if (optionKind === 'combi' && satelliteFrames.length > 0) {
    addSatelliteLayer(position);
    radarLayers.setOpacity(0.8);
  } else if (optionCombi === 'satDWD') {
    addSatelliteLayer(position);
  }
  
function preloadAllRadarFrames(callback) {
  playStop();
  
  let totalFrames = mapFrames.length;
  let loadedFrames = 0;

  mapFrames.forEach((frame, index) => {
    if (!radarLayers[frame.path]) {
      radarLayers[frame.path] = new L.TileLayer(
        apiData.host + frame.path + '/' + optionTileSize + '/{z}/{x}/{y}/' + optionColorScheme + '/' + optionSmoothData + '_' + optionSnowColors + '.png',
        {
          tileSize: 256,
          opacity: 0,
          zIndex: 10, 
          keepBuffer: 5
        }
      );
    }

    // Doƒçasne pridaj do mapy (ale neviditeƒæne)
    const layer = radarLayers[frame.path];
    if (!map.hasLayer(layer)) {
      map.addLayer(layer);
      console.log("Layer at position", layer);

    }

    // ƒåakaj k√Ωm sa naƒç√≠taj√∫ v≈°etky dla≈ædice v tejto vrstve
    layer.on('load', () => {
      loadedFrames++;
      if (loadedFrames === totalFrames) {
        console.log("‚úÖ All radar frames preloaded");
        callback(); // v≈°etky vrstvy naƒç√≠tan√©, spusti anim√°ciu
      }
    });
  });
}

let radarTilesReady = false;

map.on('tileload', () => {
  // ak sa naƒç√≠talo v≈°etko, m√¥≈æe≈° spusti≈• anim√°ciu
  if (!radarTilesReady) {
    radarTilesReady = true;
    startAnimation();  // napr. spustenie `setInterval()` anim√°cie
  }
});

map.on('tileerror', (e) => {
  console.warn("‚ö†Ô∏è Chyba naƒç√≠tania dla≈ædice:", e.tile);
});


var rainAccumLayer; // nov√° vrstva pre 1h √∫hrn zr√°≈æok

  
  // Synchronizuj satelitn√∫ anim√°ciu
  addSatelliteLayer(position);

  var pastOrForecast = nextFrame.time > Date.now() / 1000 ? ' Predpoveƒè: ' : ' ';
  var clock = new Date(nextFrame.time * 1000);
  
  // Pridanie event listenera pre naƒç√≠tanie dla≈ædice, aby sa aplikovali filtre
radarLayers[frame.path].on('tileload', function(e) {
if (highlightIntenseButton.classList.contains('active')) { // Aplik√°cia filtra
e.tile.classList.add('highlight-intense');
}
});
  
  
timeSlider.value = animationPosition;
updateSliderBackground(); 

  // Zobrazenie timestampu
  document.getElementById("timestamp").innerHTML = `<i class="fa-solid fa-clock"></i> ` + pastOrForecast + formatTime(clock);
  document.getElementById("timestamp").style.display = "block";
  document.getElementById("timestamp").style.marginLeft = "30%";
  document.getElementById("timestamp").style.width = "auto";
document.getElementById("timestamp").style.textAlign = "center";
document.getElementById("timestamp").style.fontSize = "12px";
  updatePlayPauseButton();
}

function setOptionCombi(newCombi) {
  if (optionCombi !== newCombi) {
    optionCombi = newCombi;
    initialize(apiData, 'combi');
  }
}


// Zobrazenie sn√≠mku
function showFrame(position) {
  if (!mapFrames.length) return;
  var preloadingDirection = position - animationPosition > 0 ? 1 : -1;

  animationPosition = position;

  // üîÅ Aktualizuj slider hodnotu a gradient
  const timeSlider = document.getElementById("timeSlider");
  if (timeSlider) {
    timeSlider.value = position;
    updateSlider(timeSlider); // ‚Üê toto oprav√≠ anim√°ciu gradientu
  }

  changeRadarPosition(position + preloadingDirection, true);

  clearAllRadarLayers();
  if (satelliteLayer) map.removeLayer(satelliteLayer);

  const layer = mapFrames[position];
  addLayer(layer);
  addSatelliteLayer(position);

  const time = layer.time || layer.options?.time;
  if (time) {
    const clock = new Date(time * 1000);
    const formatted = formatTime(clock);
    const ts = document.getElementById("timestamp");
    if (ts) ts.textContent = formatted;
  }
}




  
   

  


// Form√°tovanie ƒçasu a d√°tumu
function formatTime(date) {
  // Form√°tovanie ƒçasu
  var hours = date.getHours().toString().padStart(2, '0');
  var minutes = date.getMinutes().toString().padStart(2, '0');
  var seconds = date.getSeconds().toString().padStart(2, '0');
  var time = hours + ':' + minutes;

  // Form√°tovanie d√°tumu
  var days = ["NE", "PO", "UT", "ST", "≈†T", "PI", "SO"]; // Skratky dn√≠ v t√Ω≈ædni
  var day = days[date.getDay()]; // Z√≠skaj de≈à v t√Ω≈ædni
  var dayOfMonth = date.getDate().toString().padStart(2, '0'); // De≈à v mesiaci
  var month = (date.getMonth() + 1).toString().padStart(2, '0'); // Mesiac
  var year = date.getFullYear(); // Rok

  var dateString = day + " " + dayOfMonth + "." + month + "." + year + " o ";

  return dateString + " " + time; // Vr√°ti d√°tum a ƒças v po≈æadovanom form√°te
}


function setKind(kind) {
  console.log("setKind called with", kind);
  if (kind === 'satDWD') {
    console.log("Calling addSatLayer()");
    addSatLayer();
  } if (kind === 'blitzDWD') {
    addBlitzLayer(); 
    return;
  }  else if (kind === 'radar') {
    addRadarLayer();
  }
}


// Ovl√°danie kl√°vesnice
document.onkeydown = function(e) {
  e = e || window.event;
  switch (e.which || e.keyCode) {
    case 37: // ƒæav√° ≈°√≠pka
      stop();
      showFrame(animationPosition - 1);
      break;
    case 39: // prav√° ≈°√≠pka
      stop();
      showFrame(animationPosition + 1);
      break;
    default:
      return;
  }
  e.preventDefault();
};





function toggleWeatherReports() {
    const checkbox = document.getElementById('toggle-reports');
    reportsVisible = checkbox.checked;

    if (reportsVisible) {
        

        // nastav interval iba raz
        if (!reportsInterval) {
            reportsInterval = setInterval
           // ka≈æd√∫ min√∫tu
        }
    } else {
        if (layer) {
            map.removeLayer(layer);
        }

        // zastav opakovanie
        if (reportsInterval) {
            clearInterval(reportsInterval);
            reportsInterval = null;
        }


    }
}


/* ---- konfigur√°cia ---- */
const ICON_BASE = 'https://www.meteopocasie.sk/wp-content/themes/intentionally-blank/icons/';
const API_URL   = 'https://meteopocasie.sk/wp-json/wx/v1/reports';

/**
 * Form√°tuje ISO d√°tumov√Ω re≈•azec na slovensk√Ω form√°t.
 * @param {string} isoString - D√°tum v ISO form√°te (napr. "2025-06-21T23:02:00+00:00")
 * @returns {string} - Form√°tovan√Ω d√°tum (napr. "21.06.2025 o 23:02")
 */
function formatSkDate(isoString) {
    if (!isoString) return '';
    try {
        const date = new Date(isoString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${day}.${month}.${year} o ${hours}:${minutes}`;
    } catch (e) {
        console.error("Chyba pri form√°tovan√≠ d√°tumu:", e);
        return '';
    }
}

/**
 * Normalizuje kƒæ√∫ƒç udalosti pre vyhƒæadanie ikony.
 */
function normalizeKey(str='') {
  return str
    .toLowerCase()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9]+/g,'');
}

/**
 * Vr√°ti URL adresu ikony na z√°klade typu udalosti.
 */
function getIconUrl(event='') {
    const key = normalizeKey(event);
    const iconFile = eventIcons[key] || 'ostatne-rizika.png';
    return ICON_BASE + iconFile;
}



const eventTranslations = {
// Anglick√© n√°zvy javov (normalizovan√©) na slovensk√© preklady
'hail': 'Krupy',
'hail5': 'Krupy (>5mm)',
'hail10': 'Krupy (>10mm)',
'tornado': 'Torn√°do',
'torndao': 'Torn√°do', // P√¥vodn√Ω preklep, ponechan√© pre robustnos≈•
'tromba': 'Torn√°do',
'dustdevil': 'Prachov√Ω v√≠r',
'dustdevil2': 'Prachov√Ω v√≠r',
'funnel': 'Lievik',
'funnelcloud': 'Lievik',
'gustnado': 'Gustn√°do',
'gustnado2': 'Gustn√°do',
'hook': 'H√°ƒçikov√© echo',
'hookecho': 'H√°ƒçikov√© echo',
'supercell': 'Supercela',
'downburst': 'Downburst',
'microburst': 'Microburst',
'bow': 'Bow echo',
'bowecho': 'Bow echo',
'waterspout': 'Vodn√° smr≈°≈•',
'rainbow': 'D√∫ha',
'aurora': 'Pol√°rna ≈æiara',
'northernlights': 'Pol√°rna ≈æiara',
'halo': 'Halov√Ω jav',
'nlc': 'Noƒçn√© svietiace oblaky',
'noctilucent': 'Noƒçn√© svietiace oblaky',
'storm': 'B√∫rka',
'snowstorm': 'Snehov√° b√∫rka',
'wind': 'Vietor',
'strongwind': 'Siln√Ω vietor',
'extremewind': 'Extr√©mny vietor',
'highwind': 'Extr√©mny vietor',
'heat': 'Teplo',
'heatwave': 'Vlna hor√∫ƒçav',
'cold': 'Zima',
'severecold': 'Extr√©mna zima',
'blackice': 'Poƒæadovica',
'flood': 'Z√°plavy',
'flooding': 'Z√°plavy',
'earthquake': 'Zemetrasenie',
'strongearthquake': 'Siln√© zemetrasenie',
'extremequake': 'Extr√©mne zemetrasenie',
'fire': 'Po≈æiar',
'wildfire': 'Lesn√Ω po≈æiar',
'treesdown': 'Popadan√© stromy',
'fallentree': 'Spadnut√Ω strom',
'blackout': 'V√Ωpadok pr√∫du',
'poweroutage': 'V√Ωpadok pr√∫du',
'pollution': 'Zneƒçistenie',
'smog': 'Smog',
'other': 'Ostatn√© rizik√°',

// Slovensk√© n√°zvy javov (normalizovan√©) na slovensk√© preklady (pre konzistentnos≈•)
'krupy': 'Krupy',
'krupy5': 'Krupy (>5mm)',
'krupy10': 'Krupy (>10mm)',
'vsmrst': 'Vodn√° smr≈°≈•',
'duha': 'D√∫ha',
'polarnaziara': 'Pol√°rna ≈æiara',
'halovyjav': 'Halov√Ω jav',
'burka': 'B√∫rka',
'snehovaburka': 'Snehov√° b√∫rka',
'vietor': 'Vietor',
'silvietor': 'Siln√Ω vietor',
'extvietor': 'Extr√©mny vietor',
'teplo': 'Teplo',
'zima': 'Zima',
'poladovica': 'Poƒæadovica',
'zaplavy': 'Z√°plavy',
'zemetrasenie': 'Zemetrasenie',
'silzemetrasenie': 'Siln√© zemetrasenie',
'extzemetrasenie': 'Extr√©mne zemetrasenie',
'poziar': 'Po≈æiar',
'spadnutystrom': 'Spadnut√Ω strom',
'vypadokprudu': 'V√Ωpadok pr√∫du',
'znecistenie': 'Zneƒçistenie',
'ostatne': 'Ostatn√© rizik√°',
// Preklady pre nov√© mo≈ænosti vo formul√°ri
'shelf': 'Shelf cloud',
'sunny': 'Slneƒçno',
'mostlysunny': 'Polojasno',
'partlycloudy': 'Polooblaƒçno',
'cloudy': 'Oblaƒçno',
'overcast': 'Zamraƒçen√©',
'rain': 'D√°≈æƒè',
'shower': 'Preh√°nka',
'snow': 'Sne≈æenie',
'freezingrain': 'Mrzn√∫ci d√°≈æƒè',
'rainsnow': 'D√°≈æƒè so snehom',
'fog': 'Hmla',
'poweroutage': 'Preru≈°en√© dod√°vky elektriny',
'floodrain': 'Zaplavenie da≈æƒèom',
'damagerain': 'Po≈°kodenie da≈æƒèom',
'damagesnow': 'Po≈°kodenie snehom',
'damageice': 'Po≈°kodenie ƒæadom',
'damagewind': 'Po≈°kodenie vetrom',
'damagehail': 'Po≈°kodenie kr√∫pami',
'damagelighting': 'Po≈°kodenie bleskom',
'damagetornado': 'Po≈°kodenie torn√°dom',
'damagefrost': 'Po≈°kodenie mrazom',
'damageheat': 'Po≈°kodenie teplom',
'landslide': 'Zosuv/y p√¥dy',
'stormsys': 'B√∫rkov√Ω syst√©m',
'derecho': 'Derecho',
'mcs': 'MCS',
'frost': 'Mrazivo',
'ice': 'Poƒæadovica'
};


/* ---- dynamick√© naƒç√≠tanie hl√°sen√≠ ---- */
let layer;
async function loadReports() {
    try {
        const res = await fetch(API_URL + '?t=' + Date.now(), { cache: 'no-store' });
        if (!res.ok) {
            console.error('Nepodarilo sa naƒç√≠ta≈• reporty');
            document.getElementById('last-update-panel').textContent = 'Chyba pri naƒç√≠tan√≠ d√°t.';
            return;
        }
        
        
        

        const geo = await res.json();

        if (layer) map.removeLayer(layer);

        layer = L.geoJSON(geo, {
            pointToLayer: (f, latlng) => {
                const ev = f.properties.event || 'ostatne';
                return L.marker(latlng, {
                    icon: L.icon({
                        iconUrl: getIconUrl(ev),
                        iconSize: [64, 64],
                        iconAnchor: [32, 64],
                        popupAnchor: [0, -64],
                    }),
                });
            },
            onEachFeature: (f, l) => {
                const p = f.properties;
                const photoUrls = p.photos || [];
                // Form√°tovanie d√°tumu (bez relat√≠vneho ƒçasu)
const formattedTime = formatSkDate(p.time);

// Preklad n√°zvu javu
const normalizedEvent = normalizeKey(p.event);
const eventName = eventTranslations[normalizedEvent] || p.event || 'Nezn√°my jav';

                const content = `
                  <div class="wx-popup-header">${eventName || 'Nezn√°my jav'}</div>
                  <div class="wx-popup-body">
                    <div class="wx-popup-time">${formattedTime}</div>
                    ${ p.desc ? `<div class="wx-popup-desc">${p.desc}</div>` : ''}
                    <div class="wx-popup-gallery">
                      ${photoUrls.map(url => `<a href="${url}" target="_blank" rel="noopener noreferrer"><img class="wx-popup-image" src="${url}" alt="Foto javu"></a>`).join('')}
                    </div>
                  </div>
                `;
                const popup = L.popup({ className: 'modern-popup' }).setContent(content);
                l.bindPopup(popup);
            }
        }).addTo(map);

        const updatePanel = document.getElementById('last-update-panel');
        if (geo.features.length > 0) {
            const latestReportTime = geo.features[0].properties.time;
            updatePanel.textContent = `Posledn√° aktualiz√°cia: ${formatSkDate(latestReportTime)}`;
        } else {
            updatePanel.textContent = 'Za posledn√Ωch 24 hod√≠n ≈æiadne hl√°senia.';
        }
    } catch (error) {
        console.error("Z√°va≈æn√° chyba pri spracovan√≠ hl√°sen√≠:", error);
        document.getElementById('last-update-panel').textContent = 'Chyba pri spracovan√≠ d√°t.';
    }
}




/* ---- ak sa v URL nach√°dza ?report=ID, zameraj sa ---- */



/* ------ ikony javov + synonym√° ------ */
const eventIcons = {
  'krupy': 'hail.png', 'hail': 'hail.png', 'krupy5': 'hail-5.png', 'hail5': 'hail-5.png', 'krupy10': 'hail-10.png', 'hail10': 'hail-10.png',
  'tornado': 'tornado.png', 'torndao': 'tornado.png', 'tromba': 'tornado.png', 'dustdevil': 'dust-devil.png', 'dustdevil2': 'dust-devil.png',
  'funnel': 'funnel.png', 'funnelcloud': 'funnel.png', 'gustnado': 'gustnado.png', 'gustnado2': 'gustnado.png',
  'hook': 'hook-echo.png', 'hookecho': 'hook-echo.png',
  'sccloud': 'supercela.png', 'supercell': 'supercela.png', 'supercela': 'supercela.png',
  'downburst': 'downburst.png', 'microburst': 'downburst.png',
  'bow': 'bow-echo.png', 'bowecho2': 'bow-echo.png',
  'vsmrst': 'vodna-smrst.png', 'waterspout': 'vodna-smrst.png',
  'duha': 'duha.png', 'rainbow': 'duha.png',
  'aurora': 'aurora.png', 'northernlights': 'aurora.png', 'polarnaziara': 'aurora.png',
  'halo': 'halovy-jav.png', 'halovyjav': 'halovy-jav.png',
  'nlc': 'nlc.png', 'noctilucent': 'nlc.png',
  'storm': 'burka.png',
  'snowstorm': 'snehova-burka.png',
  'vietor': 'vietor.png', 'wind': 'vietor.png',
  'silvietor': 'silny-vietor.png', 'strongwind': 'silny-vietor.png',
  'extvietor': 'extremny-vietor.png', 'highwind': 'extremny-vietor.png',
  'teplo': 'teplo.png', 'heat': 'teplo.png', 'heatwave': 'teplo.png',
  'zima': 'zima.png', 'cold': 'zima.png', 'severecold': 'zima.png',
  'poladovica': 'poladovica.png', 'blackice': 'poladovica.png',
  'zaplavy': 'zaplavy.png', 'flood': 'zaplavy.png', 'flooding': 'zaplavy.png',
  'zemetrasenie': 'zemetrasenie.png', 'earthquake': 'zemetrasenie.png',
  'silzemetrasenie': 'silne-zemetrasenie.png', 'strongearthquake': 'silne-zemetrasenie.png',
  'extzemetrasenie': 'extremne-zemetrasenie.png', 'extremequake': 'extremne-zemetrasenie.png',
  'fire': 'fire.png', 'poziar': 'fire.png', 'wildfire': 'fire.png',
  'trees_down': 'spadnuty-strom.png', 'fallentree': 'spadnuty-strom.png',
  'vspr': 'vypadok-prudu.png', 'blackout': 'vypadok-prudu.png', 'poweroutage': 'vypadok-prudu.png',
  'znecistenie': 'znecistenie.png', 'pollution': 'znecistenie.png', 'smog': 'znecistenie.png',
  'ostatne': 'ostatne-rizika.png', 'other': 'ostatne-rizika.png'
};



// Prep√≠nanie legendy
function toggleLegend() {
  var legend = document.getElementById('legend');
  legend.classList.toggle('active');
}

function toggleLayer(layer) {
  if (layer === 'radar') {
    optionKind = 'radar';
    initialize(apiData, optionKind); // Zobraz√≠ len radarov√∫ vrstvu
  } else if (layer === 'cloud') {
    // Neodstr√°ni radarov√∫ vrstvu pri prepnut√≠ na oblaƒçnos≈•
    if (!mapFrames.length && apiData.radar && apiData.radar.past) {
      mapFrames = apiData.radar.past.concat(apiData.radar.nowcast || []);
      lastPastFramePosition = apiData.radar.past.length - 1;
    }
    
function preloadRadarTiles(frames) {
  frames.forEach(frame => {
    const urlTemplate = apiData.host + frame.path + '/' + optionTileSize + '/{z}/{x}/{y}/' + optionSmoothData + '/' + optionSnowColors + '_' + optionColorScheme + '.png';

    const bounds = map.getBounds();
    const zoom = map.getZoom();

    const tileBounds = L.TileLayer.prototype._tileCoordsToBounds.bind({
      _tileSize: L.point(optionTileSize, optionTileSize),
      _map: map,
      _crs: map.options.crs
    });

    const tileRange = getTileRange(bounds, zoom);

    for (let x = tileRange.min.x; x <= tileRange.max.x; x++) {
      for (let y = tileRange.min.y; y <= tileRange.max.y; y++) {
        const url = urlTemplate.replace('{z}', zoom).replace('{x}', x).replace('{y}', y);
        const img = new Image();
        img.src = url;
      }
    }
  });
}

// Pomocn√° funkcia na zistenie tile rozsahu pre dan√Ω zoom level
function getTileRange(bounds, zoom) {
  const tileSize = optionTileSize;
  const nw = map.project(bounds.getNorthWest(), zoom).divideBy(tileSize).floor();
  const se = map.project(bounds.getSouthEast(), zoom).divideBy(tileSize).floor();
  return {
    min: nw,
    max: se
  };
}


    // Pridanie radarovej vrstvy, ak e≈°te nie je pridan√°
    addLayer(mapFrames[animationPosition]);

    // Pridanie vrstvy oblaƒçnosti, ak je dostupn√°
    if (apiData.satellite && apiData.satellite.infrared) {
      var cloudLayer = apiData.satellite.infrared[animationPosition];
      addLayer(cloudLayer); // Prid√° satelitn√∫ vrstvu oblaƒçnosti nad radar
    }
  } else if (layer === 'satellite') {
    optionKind = 'satellite';
    initialize(apiData, optionKind);
  } else if (layer === 'prognostic') {
    optionKind = 'prognostic';
    initialize(apiData, optionKind);
  } else if (layer === 'tropicalStorm') {
    optionKind = 'tropicalStorm';
    initialize(apiData, optionKind);
  } else if (layer === 'resetTropicalStorm') {
    if (tropicalLayer) {
      map.removeLayer(tropicalLayer);
      tropicalLayer = null;
    }
    return;
  } else if (layer === 'lightning') {
    optionKind = 'lightning';
    initialize(apiData, optionKind);
  } else if (layer === 'resetLightning') {
    if (lightningLayer) {
      map.removeLayer(lightningLayer);
      lightningLayer = null;
    }
    return;
  } else if (layer === 'resetArrowPrecip') {
    if (arrowPrecipLayer) {
      map.removeLayer(arrowPrecipLayer);
      arrowPrecipLayer = null;
    }
    return;
  } else if (layer === 'resetSatLayer') {
    if (satLayer) {
  map.removeLayer(satLayer);
  satLayer = null;
}
    return;
  } 
  

  // Naƒç√≠ta≈• mapov√© vrstvy pre radar a blesky po kliknut√≠
  initialize(apiData, optionKind);
}
// Nastavenie intervalov na aktualiz√°ciu radarov√Ωch a bleskov√Ωch √∫dajov
setInterval(updateRadarData, 10 * 60 * 1000); // Aktualiz√°cia radarov√Ωch d√°t ka≈æd√Ωch 10 min√∫t
setInterval(updateLightningData, 60 * 1000); // Aktualiz√°cia d√°t bleskov ka≈æd√∫ min√∫tu


// Inicializ√°cia mapy s predvolenou voƒæbou
loadApiData(); // Zmena na volanie funkcie na naƒç√≠tanie API d√°t

// Funkcia na aktualiz√°ciu radarov√Ωch √∫dajov
function updateRadarData() {
    var apiRequest = new XMLHttpRequest();
    apiRequest.open("GET", "https://api.rainviewer.com/public/weather-maps.json", true);
    apiRequest.onload = function() {
        apiData = JSON.parse(apiRequest.response);
        if (optionKind === 'radar' || optionKind === 'satellite') {
            initialize(apiData, optionKind);
        }
    };
    apiRequest.send();
}

// Funkcia na aktualiz√°ciu bleskov√Ωch √∫dajov
function updateLightningData() {
    if (lightningLayer) {
        lightningLayer.setUrl('https://maps.aerisapi.com/LkEzJDiwL3OBAkDyTCaXI_2hsPGD3nQra8yJXhzE4jpqsWrgFLBG9ypRdSRiF3/lightning-strikes,lightning-all-5m/{z}/{x}/{y}/current.png');
    }
}

document.addEventListener('DOMContentLoaded', () => {
    toggleWeatherReports();  // nastav podƒæa checkboxu
});

    </script>
<div id="welcomeModal" class="welcome-overlay">
  <div class="welcome-box">
    <button class="theme-toggle" onclick="toggleDarkMode()">üåì</button>
    <h2>Vitaj na MeteoPoƒçasie!</h2>
    <p>üÜï <strong>Novinky:</strong></p>
    <ul class="welcome-list">
      <li>üì° Radar a oblaƒçnos≈• sa teraz zobrazuj√∫ <strong>s√∫ƒçasne</strong>.</li>
      <li>üå© Mo≈ænos≈• prid√°va≈• vrstvy ako blesky, vietor ƒçi tropick√© b√∫rky.</li>
      <li>üßπ Kliknut√≠m na <strong>‚ÄûVymaza≈•‚Äú</strong> sa v≈°etko resetuje na z√°kladn√© zobrazenie.</li>
      <li>Na <i class="fas fa-plus"></i> <!-- Font Awesome plus icon --> budete m√¥c≈• n√°m nahlasova≈• ak√Ωkoƒævek typ nebezpeƒçn√©ho javu, o ktor√Ω sa jedn√°, a to vo forme popisu, v√Ωberu a urƒçite aj s <strong>Foto dokument√°ciou</strong>!</li>
    </ul>
    <button onclick="closeWelcome()" class="welcome-close">Zaƒça≈•</button>
  </div>
</div>

<style>
  :root {
    --bg: #fff;
    --fg: #111;
    --accent: #2a72d4;
    --button-bg: #2a72d4;
    --button-hover: #1c54a1;
  }

  body.dark-mode {
    --bg: #121212;
    --fg: #eee;
    --accent: #6ca0ff;
    --button-bg: #444;
    --button-hover: #666;
  }

  .welcome-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    display: none;
  }

  .welcome-box {
    background: var(--bg);
    color: var(--fg);
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(0,0,0,0.4);
    max-width: 480px;
    width: 90%;
    text-align: center;
    position: relative;
    animation: fadeIn 0.4s ease-in-out;
    
  }

  .welcome-box h2 {
    font-size: 1.6rem;
    margin-bottom: 1rem;
    color: var(--accent);
  }

  .welcome-box p {
    font-size: 1rem;
    margin-bottom: 0.5rem;
  }

  .welcome-list {
    text-align: left;
    margin: 1rem 0;
    padding-left: 1.2rem;
  }

  .welcome-list li {
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }

  .welcome-close {
    background: var(--button-bg);
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    margin-top: 1rem;
    transition: background 0.3s;
  }

  .welcome-close:hover {
    background: var(--button-hover);
  }

  .theme-toggle {
    position: absolute;
    top: 12px;
    right: 16px;
    background: transparent;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    color: var(--fg);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
  }
  
  
.weather-bubble {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.66);
  text-align: center;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
  cursor: pointer;
  border: 2px solid transparent;
  transition: transform 0.2s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
}

.weather-bubble:hover {
  transform: scale(1.2);
  z-index: 1000;
}

.weather-bubble .temp {
  font-family: 'Poppins', sans-serif;
  font-weight: 990;
  font-size: 10px;
  color: #000;
  line-height: 0.5;
}

.weather-bubble .weather-icon {
  width: 20px;
  height: 20px;
  margin-top: 2px;
}

.weather-tooltip {
  position: absolute;
  bottom: 45px;
  left: 50%;
  transform: translateX(-50%);
  background: #002043;
  color: #fff;
  padding: 6px 10px;
  border-radius: 8px;
  font-size: 11px;
  font-family: 'Poppins', sans-serif;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.weather-bubble:hover .weather-tooltip {
  opacity: 1;
  transform: translateX(-50%) translateY(-5px);
}

</style>
<script>
  // Zatvorenie po 5 sekund√°ch automaticky
  window.addEventListener('load', function () {
    setTimeout(() => {
      closeWelcome();
    }, 5000);
  });

  // Manu√°lne zatvorenie
  function closeWelcome() {
    const modal = document.getElementById('welcomeModal');
    if (modal) {
      modal.style.display = 'none';
    }
  }

  // Tmav√Ω re≈æim
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
  }
</script>

</body>
</html>

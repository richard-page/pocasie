<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PredpoveÄ poÄasia</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{
    --glass: rgba(255,255,255,.08);
    --glass-b: rgba(255,255,255,.18);
    --hero-h: 34vh;
    --hero-icon: 76px;
    --hero-temp: 5.6rem;
    --hero-pad-t: 1.6rem;
    --hero-pad-b: 1.2rem;
  }
  @media (min-width:480px){
    :root{ --hero-h: 36vh; --hero-icon: 86px; --hero-temp: 6rem; }
  }
  @media (min-width:768px){
    :root{ --hero-h: 38vh; --hero-icon: 96px; --hero-temp: 6.2rem; }
  }

  *{ box-sizing:border-box }
  html,body{ width:100%; max-width:100%; overflow-x:hidden }
  body{
    margin:0; color:#fff;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:#0e4d73;
  }
  .glass{ background:var(--glass); border:1px solid var(--glass-b); backdrop-filter:blur(12px); border-radius:1rem }
  .mono{ font-feature-settings:"tnum" 1,"lnum" 1 }
  .hero{ position:relative; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:var(--hero-h); padding:var(--hero-pad-t) 1rem var(--hero-pad-b); text-align:center }
  body[data-mode="day"] .hero{ background:#176ea9 }
  body[data-mode="night"] .hero{ background:#08273b }
  #heroPlace{ font-size:1.18rem; font-weight:600; opacity:.95; letter-spacing:.2px }
  #heroIcon{ width:var(--hero-icon); height:var(--hero-icon); margin:.65rem auto .35rem; font-size:calc(var(--hero-icon) - 8px); line-height:var(--hero-icon) }
  #heroTemp{ font-size:var(--hero-temp); line-height:1; font-weight:700; letter-spacing:1px }
</style>
</head>
<body data-mode="day">

<section class="hero">
  <div id="heroPlace">ZisÅ¥ujem polohuâ€¦</div>
  <div id="heroIcon" aria-hidden="true">ğŸ“</div>
  <div id="heroTemp" class="mono">--Â°</div>
</section>

<header class="sticky-header w-full glass">
  <div class="w-full px-3 md:px-6 py-3 flex items-center gap-3">
    <div class="font-semibold">PredpoveÄ poÄasia</div>
    <div class="flex-1"></div>
    <div class="suggest-wrap w-full sm:w-[560px] max-w-full">
      <form id="searchForm" class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2" novalidate>
        <input id="cityInput" placeholder="Zadaj mesto (napr. Bratislava)" class="w-full px-4 py-2.5 rounded-lg bg-white/20 border border-white/20 placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50" autocomplete="off" inputmode="search" type="search" />
        <button id="searchBtn" type="submit" class="w-full sm:w-auto inline-flex items-center justify-center px-4 md:px-5 py-2.5 rounded-lg bg-white/30 hover:bg-white/40 text-white font-medium">HÄ¾adaÅ¥</button>
      </form>
      <div id="citySuggestions" class="suggest hidden"></div>
    </div>
  </div>
</header>

<main id="refreshContainer" class="w-full px-2 md:px-4 lg:px-6 py-4 space-y-4">
  <section class="cols">
    <div class="col-left glass overflow-visible lg:overflow-hidden lg:basis-7/12 flex flex-col min-h-0">
      <div class="flex items-center justify-between px-4 py-3 border-b border-white/20">
        <h2 class="text-lg font-semibold">24-hodinovÃ¡ predpoveÄ</h2>
      </div>
      <div class="hidden lg:block overflow-x-auto flex-1 min-h-0">
        <table class="tbl w-full h-full min-w-[900px] text-sm">
          <thead>
            <tr class="text-white/90">
              <th>ÄŒas</th><th>PoÄasie</th><th>Teplota</th><th>RosnÃ½ bod</th><th>ZrÃ¡Å¾ky</th><th>Vietor</th><th>OblaÄnosÅ¥</th><th>Tlak</th>
            </tr>
          </thead>
          <tbody id="hourRows" class="divide-y divide-white/10"></tbody>
        </table>
      </div>
      <div id="hourList" class="block lg:hidden p-2 space-y-2"></div>
    </div>

    <div class="col-right lg:basis-5/12 space-y-4">
      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">10-dÅˆovÃ¡ predpoveÄ</h2></div>
        <div id="dailyList" class="p-3 space-y-2"></div>
      </div>
      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">Presne pred rokom</h2></div>
        <div id="historyExact" class="p-4"></div>
      </div>
      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">UV index</h2></div>
        <div id="uvPanel" class="p-4">
          <div class="grid grid-cols-2 gap-3">
            <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">AktuÃ¡lne</div><div id="uvNow" class="mono font-semibold">â€”</div></div>
            <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">DneÅ¡nÃ© maximum</div><div id="uvMax" class="mono font-semibold">â€”</div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="loading" class="hidden text-center py-10">
    <div class="inline-block w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
    <p class="mt-2">NaÄÃ­tavamâ€¦</p>
  </div>
  <div id="err" class="hidden glass p-4 text-center text-red-200">Nepodarilo sa naÄÃ­taÅ¥ Ãºdaje.</div>
</main>

<script>
const API='https://api.open-meteo.com/v1';
const GEO='https://geocoding-api.open-meteo.com/v1';
const ARCH='https://archive-api.open-meteo.com/v1/era5';
const el={hourRows:document.getElementById('hourRows'),hourList:document.getElementById('hourList'),dailyList:document.getElementById('dailyList'),historyExact:document.getElementById('historyExact'),uvNow:document.getElementById('uvNow'),uvMax:document.getElementById('uvMax'),heroPlace:document.getElementById('heroPlace'),heroIcon:document.getElementById('heroIcon'),heroTemp:document.getElementById('heroTemp'),loading:document.getElementById('loading'),err:document.getElementById('err')};

function sanitizeCode(c){c=Number(c);return(c===45||c===48)?3:c;}
function iconFor(code){code=sanitizeCode(code);if([0,1].includes(code))return'â˜€ï¸';if(code===2)return'â›…';if(code===3)return'â˜ï¸';if([61,63,65,80,81,82].includes(code))return'ğŸŒ§ï¸';if([71,73,75].includes(code))return'ğŸŒ¨ï¸';if([95,96,99].includes(code))return'â›ˆï¸';return'ğŸŒ¤ï¸';}
function descFor(c){c=sanitizeCode(c);const d={0:'Jasno',1:'PrevaÅ¾ne jasno',2:'ÄŒiastoÄne oblaÄno',3:'ZamraÄenÃ©',61:'SlabÃ½ dÃ¡Å¾Ä',63:'Mierny dÃ¡Å¾Ä',65:'SilnÃ½ dÃ¡Å¾Ä',71:'SlabÃ© sneÅ¾enie',73:'Mierne sneÅ¾enie',75:'SilnÃ© sneÅ¾enie',95:'BÃºrka',96:'BÃºrka s krÃºpami',99:'SilnÃ¡ bÃºrka s krÃºpami'};return d[c]||'â€”';}
function dd2dir(dd){if(dd==null||isNaN(dd))return'â€”';const deg=((dd%360)+360)%360;const dirs=['S','SV','V','JV','J','JZ','Z','SZ'];return dirs[Math.floor((deg+22.5)/45)%8];}
function fmtTime(iso){const d=new Date(iso);return d.getHours().toString().padStart(2,'0')+':00';}
async function reverseGeo(lat,lon){const r=await fetch(`${GEO}/reverse?latitude=${lat}&longitude=${lon}&language=sk&format=json`);const j=await r.json();return j.results?.[0]||{name:'NeznÃ¡me miesto'};}
async function fetchWx(lat,lon){const u=`${API}/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,is_day,weather_code&hourly=temperature_2m,dew_point_2m,surface_pressure,weather_code,precipitation_probability,precipitation,wind_speed_10m,wind_direction_10m,cloud_cover,uv_index&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max&timezone=auto&forecast_days=16`;const r=await fetch(u);if(!r.ok)throw new Error('api');return await r.json();}
async function fetchHistoryExact(lat,lon){const d=new Date();d.setFullYear(d.getFullYear()-1);const date=d.toISOString().slice(0,10);const u=`${ARCH}?latitude=${lat}&longitude=${lon}&start_date=${date}&end_date=${date}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode&timezone=auto`;const r=await fetch(u);if(!r.ok)throw new Error('arch');return await r.json();}
function renderHero(city,wx){document.body.setAttribute('data-mode',wx.current.is_day?'day':'night');el.heroPlace.textContent=city.name;el.heroTemp.textContent=Math.round(wx.current.temperature_2m)+'Â°';el.heroIcon.textContent=iconFor(wx.current.weather_code);}
function renderHourly(wx){const H=wx.hourly;el.hourRows.innerHTML='';const now=new Date();let s=0;for(let i=0;i<H.time.length;i++){if(new Date(H.time[i])>=now){s=i;break;}}const e=Math.min(s+24,H.time.length);for(let i=s;i<e;i++){const tr=document.createElement('tr');tr.innerHTML=`<td>${fmtTime(H.time[i])}</td><td>${descFor(H.weather_code[i])}</td><td>${Math.round(H.temperature_2m[i])}Â°</td><td>${Math.round(H.dew_point_2m[i])}Â°</td><td>${H.precipitation[i].toFixed(1)} mm</td><td>${Math.round(H.wind_speed_10m[i])} km/h (${dd2dir(H.wind_direction_10m[i])})</td><td>${H.cloud_cover[i]}%</td><td>${Math.round(H.surface_pressure[i])} hPa</td>`;el.hourRows.appendChild(tr);}}
function renderDaily(wx){const D=wx.daily;el.dailyList.innerHTML='';for(let i=0;i<10&&i<D.time.length;i++){const d=new Date(D.time[i]);const card=document.createElement('div');card.innerHTML=`<div class="flex justify-between"><div>${d.getDate()}.${d.getMonth()+1}. ${descFor(D.weather_code[i])}</div><div>${Math.round(D.temperature_2m_max[i])}Â° / ${Math.round(D.temperature_2m_min[i])}Â°</div></div>`;el.dailyList.appendChild(card);}}
function renderHistoryExact(h){const H=h.daily;const d=new Date(H.time[0]);el.historyExact.innerHTML=`<div>${d.getDate()}.${d.getMonth()+1}.${d.getFullYear()} â€“ ${descFor(H.weathercode[0])}, ${Math.round(H.temperature_2m_min[0])}Â° / ${Math.round(H.temperature_2m_max[0])}Â°, ${H.precipitation_sum[0].toFixed(1)} mm</div>`;}
function renderUV(wx){const H=wx.hourly;let uvNow=null;const now=new Date();for(let i=0;i<H.time.length;i++){if(new Date(H.time[i])>=now){uvNow=H.uv_index?.[i];break;}}el.uvNow.textContent=uvNow!=null?uvNow.toFixed(1):'â€”';el.uvMax.textContent=wx.daily.uv_index_max?.[0]?.toFixed(1)||'â€”';}
async function run(city){el.loading.classList.remove('hidden');el.err.classList.add('hidden');try{const wx=await fetchWx(city.latitude,city.longitude);const hist=await fetchHistoryExact(city.latitude,city.longitude);renderHero(city,wx);renderHourly(wx);renderDaily(wx);renderHistoryExact(hist);renderUV(wx);}catch(e){el.err.classList.remove('hidden');}finally{el.loading.classList.add('hidden');}}

/* === GeolokÃ¡cia cez Median === */
async function handlePosition(lat,lon){
  if(!lat||!lon){run({name:'Bratislava',latitude:48.1486,longitude:17.1077});return;}
  const city=await reverseGeo(lat,lon);
  run(city);
}
async function median_geolocation_ready(){
  try{
    if(typeof median_geolocation_request==='function'){
      const res=await median_geolocation_request();
      if(res){
        let lat,resLat,resLon;
        if(typeof res==='object'){lat=res.latitude;resLon=res.longitude;}
        else if(typeof res==='string'){const j=JSON.parse(res);lat=j.latitude;resLon=j.longitude;}
        handlePosition(lat,resLon);
      }else run({name:'Bratislava',latitude:48.1486,longitude:17.1077});
    }else run({name:'Bratislava',latitude:48.1486,longitude:17.1077});
  }catch(e){run({name:'Bratislava',latitude:48.1486,longitude:17.1077});}
}
window.addEventListener('load',()=>{if(typeof median_geolocation_request!=='function'){run({name:'Bratislava',latitude:48.1486,longitude:17.1077});}});
</script>
</body>
</html>

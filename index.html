<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Predpoveď počasia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --glass: rgba(255,255,255,.08);
      --glass-b: rgba(255,255,255,.18);
      --hero-h: 34vh;
      --hero-icon: 76px;
      --hero-temp: 5.6rem;
      --hero-pad-t: 1.6rem;
      --hero-pad-b: 1.2rem;
    }
    @media (min-width:480px){
      :root{ --hero-h: 36vh; --hero-icon: 86px; --hero-temp: 6rem; }
    }
    @media (min-width:768px){
      :root{ --hero-h: 38vh; --hero-icon: 96px; --hero-temp: 6.2rem; }
    }

    *{ box-sizing:border-box }
    html,body{ width:100%; max-width:100%; overflow-x:hidden }
    body{ margin:0; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:#0e4d73; }
    .glass{ background:var(--glass); border:1px solid var(--glass-b); backdrop-filter:blur(12px); border-radius:1rem }
    .mono{ font-feature-settings:"tnum" 1,"lnum" 1 }

    .hero{ position:relative; isolation:isolate; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:var(--hero-h); width:100%; padding:var(--hero-pad-t) 1rem var(--hero-pad-b); text-align:center; overflow:hidden }
    body[data-mode="day"] .hero{ background:#176ea9 }
    body[data-mode="night"] .hero{ background:#08273b }
    body[data-mode="night"] .hero::after{
      content:""; position:absolute; inset:0; z-index:-1; pointer-events:none; opacity:.45;
      background:radial-gradient(2px 2px at 12% 18%, #fff 40%, transparent 42%), radial-gradient(1.5px 1.5px at 35% 28%, #fff 45%, transparent 47%);
    }
    #heroPlace{ font-size:1.18rem; font-weight:600; opacity:.95; letter-spacing:.2px }
    #heroIcon{ width:var(--hero-icon); height:var(--hero-icon); margin:.65rem auto .35rem; font-size:calc(var(--hero-icon) - 8px); line-height:var(--hero-icon) }
    #heroTemp{ font-size:var(--hero-temp); line-height:1; font-weight:700; letter-spacing:1px }

    .sticky-header{ position:sticky; top:0; z-index:40 }
    .tbl th,.tbl td{ padding:.65rem .75rem; white-space:nowrap }
    .tbl thead th{ position:sticky; top:0; background:rgba(0,0,0,.15); backdrop-filter:blur(6px) }
    .val-bold{ font-weight:600; color:#fff }

    .cols{ display:grid; grid-template-columns:1fr; gap:1rem }
    @media (min-width:1024px){ .cols{ display:flex; gap:1rem } .col-left,.col-right{ align-self:stretch } }

    /* Návrhy miest */
    .suggest-wrap{ position:relative; }
    .suggest{
      position:absolute; top:100%; left:0; right:0; margin-top:.35rem;
      background:#fff; color:#0b1720; border-radius:.75rem; border:1px solid rgba(0,0,0,.08);
      box-shadow:0 10px 25px rgba(0,0,0,.25); overflow:auto; max-height:18rem; z-index:50;
    }
    .suggest.hidden{ display:none }
    .suggest-item{ display:flex; align-items:center; gap:.6rem; padding:.55rem .75rem; cursor:pointer }
    .suggest-item:hover,.suggest-item[aria-selected="true"]{ background:#eef6ff }
    .flag{ width:18px; flex:0 0 18px }
    .s-meta{ font-size:.82rem; color:#425466 }
    .s-name{ font-weight:600 }

    /* Pull-to-refresh */
    #ptr{ position:sticky; top:0; height:0; overflow:visible; z-index:45; }
    #ptr .spinner{
      margin:.35rem auto 0; width:34px; height:34px; border-radius:9999px;
      border:4px solid rgba(255,255,255,.28); border-top-color:#fff;
      animation:spin 1s linear infinite; opacity:0; transform:scale(.8); transition:opacity .15s ease, transform .15s ease;
    }
    #ptr.active .spinner{ opacity:1; transform:scale(1) }
    @keyframes spin{ to{ transform:rotate(360deg) } }
  </style>
</head>
<body data-mode="day">

<!-- HERO -->
<section class="hero">
  <div id="heroPlace">—</div>
  <div id="heroIcon" aria-hidden="true"></div>
  <div id="heroTemp" class="mono">--°</div>
</section>

<header class="sticky-header w-full glass">
  <div class="w-full px-3 md:px-6 py-3 flex items-center gap-3">
    <div class="font-semibold">Predpoveď počasia</div>
    <div class="flex-1"></div>

    <!-- vyhľadávanie + návrhy -->
    <div class="suggest-wrap w-full sm:w-[560px] max-w-full">
      <form id="searchForm" class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-2" novalidate>
        <input id="cityInput" placeholder="Zadaj mesto (napr. Bratislava)"
               class="w-full px-4 py-2.5 rounded-lg bg-white/20 border border-white/20 placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50"
               autocomplete="off" inputmode="search" type="search" />
        <button id="searchBtn" type="submit"
                class="w-full sm:w-auto inline-flex items-center justify-center px-4 md:px-5 py-2.5 rounded-lg bg-white/30 hover:bg-white/40 text-white font-medium">
          Hľadať
        </button>
      </form>
      <div id="citySuggestions" class="suggest hidden"></div>
    </div>
  </div>
</header>

<!-- Pull-to-refresh indikátor -->
<div id="ptr"><div class="spinner"></div></div>

<main id="refreshContainer" class="w-full px-2 md:px-4 lg:px-6 py-4 space-y-4">

  <section class="cols">
    <!-- 24h -->
    <div class="col-left glass overflow-visible lg:overflow-hidden lg:basis-7/12 flex flex-col min-h-0">
      <div class="flex items-center justify-between px-4 py-3 border-b border-white/20">
        <h2 class="text-lg font-semibold">24-hodinová predpoveď</h2>
      </div>
      <div class="hidden lg:block overflow-x-auto flex-1 min-h-0">
        <table class="tbl w-full h-full min-w-[900px] text-sm">
          <thead>
            <tr class="text-white/90">
              <th>Čas</th><th>Počasie</th><th>Teplota</th><th>Rosný bod</th>
              <th>Zrážky</th><th>Vietor</th><th>Oblačnosť</th><th>Tlak</th>
            </tr>
          </thead>
          <tbody id="hourRows" class="divide-y divide-white/10"></tbody>
        </table>
      </div>
      <div id="hourList" class="block lg:hidden p-2 space-y-2"></div>
    </div>

    <div class="col-right lg:basis-5/12 space-y-4">
      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">10-dňová predpoveď</h2></div>
        <div id="dailyList" class="p-3 space-y-2"></div>
      </div>

      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">Presne pred rokom</h2></div>
        <div id="historyExact" class="p-4"></div>
      </div>

      <div class="glass">
        <div class="px-4 py-3 border-b border-white/20"><h2 class="text-lg font-semibold">UV index</h2></div>
        <div id="uvPanel" class="p-4">
          <div class="grid grid-cols-2 gap-3">
            <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Aktuálne</div><div id="uvNow" class="mono font-semibold">—</div></div>
            <div class="glass p-2 rounded-lg"><div class="text-white/70 text-sm">Dnešné maximum</div><div id="uvMax" class="mono font-semibold">—</div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="loading" class="hidden text-center py-10">
    <div class="inline-block w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
    <p class="mt-2">Načítavam…</p>
  </div>
  <div id="err" class="hidden glass p-4">
    <div class="text-center text-red-200">Nepodarilo sa načítať údaje. Skús iné mesto.</div>
  </div>
</main>

<script>
// Funkcia na požiadanie o povolenie na geolokáciu
function requestAndroidLocationPermission() {
  median.android.geoLocation.promptLocationServices();
}

// Funkcia na kontrolu, či sú služby polohy povolené
function checkAndroidLocationEnabled() {
  median.android.geoLocation.isLocationServicesEnabled({
    callback: function(result) {
      if (result.enabled) {
        console.log("Geolokačné služby sú povolené.");
        // Ak sú služby povolené, môžeme získať polohu
        getCurrentLocation();
      } else {
        console.log("Geolokačné služby nie sú povolené.");
        // Tu môžeme pridať logiku, aby sme upozornili užívateľa, že musí povoliť geolokáciu
      }
    }
  });
}

// Funkcia na získanie aktuálnej polohy
function getCurrentLocation() {
  navigator.geolocation.getCurrentPosition(locationSuccess, locationError, locationOptions);
}

// Callback pri úspešnom získaní polohy
function locationSuccess(position) {
  const latitude = position.coords.latitude;
  const longitude = position.coords.longitude;
  console.log(`Aktuálna poloha: Latitude = ${latitude}, Longitude = ${longitude}`);
  // Tu môžeš zavolať funkciu, ktorá získa predpoveď počasia na základe tejto polohy
}

// Callback pri chybe pri získavaní polohy
function locationError(error) {
  console.error(`Chyba pri získavaní polohy: ${error.message}`);
}

// Funkcia na načítanie údajov o počasí podľa aktuálnej polohy
function loadWeatherData(latitude, longitude) {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`;
  fetch(url)
    .then(response => response.json())
    .then(data => {
      console.log(data);
      // Tu môžeš spracovať dáta a zobraziť predpoveď počasia
    })
    .catch(error => console.error('Chyba pri načítaní údajov o počasí:', error));
}

// Spustenie požiadania o povolenie na geolokáciu pri načítaní stránky
window.onload = function() {
  checkAndroidLocationEnabled();
  // Po zistení polohy sa predvolená hodnota mesta nezobrazí
  // Ak polohu získame, mesto nebude prednastavené na "Bratislava"
};
</script>
</body>
</html>
